<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>115、稀土掘金小册-记账本（六）账单列表</title><meta name="description" content="呦呦鹿鸣，食野之苹"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="

前言上一章节介绍的登录注册是整个项目的根基，没有拿到 token，将无法进行后续的各种操作，如账单的增删改查。所以务必将上一章节好好地阅读与揣摩，为后面的学习做好铺垫。我们直接进入本次前端实战项目的主题，账单的增删改查之列表页。

本教程已有线上地址在线地址，同学们可以在实战部分，对照着线上页面进行学习。

知识点
单项组件抽离
列表页无限滚动
下拉刷新列表
弹窗组件封装

我们先来欣赏一下最终的页面效果：

列表页编写（静态部分）按照正常的开发流程，我们先将静态页面切出来，再填入数据使其动态化。在此之前，我们已经新建好了 Home 目录，该目录便是用于放置账单列表，所以我们直接在 Home/index.jsx 新增代码。
头部统计实现列表的头部展示的内容为当月的收入和支出汇总，并且有两个列表条件过滤项.."><meta name="generator" content="Hexo 4.2.1"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Jude's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">115、稀土掘金小册-记账本（六）账单列表</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点"><span class="toc-text">知识点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#列表页编写（静态部分）"><span class="toc-text">列表页编写（静态部分）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#头部统计实现"><span class="toc-text">头部统计实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#列表页面实现"><span class="toc-text">列表页面实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下拉刷新、上滑无限加载"><span class="toc-text">下拉刷新、上滑无限加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加筛选条件"><span class="toc-text">添加筛选条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/react"><i class="tag post-item-tag">react</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">115、稀土掘金小册-记账本（六）账单列表</h1><time class="has-text-grey" datetime="2023-01-11T12:00:00.000Z">2023-01-11</time><article class="mt-2 post-content"><a id="more"></a>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>上一章节介绍的登录注册是整个项目的根基，没有拿到 <code>token</code>，将无法进行后续的各种操作，如账单的增删改查。所以务必将上一章节好好地阅读与揣摩，为后面的学习做好铺垫。我们直接进入本次前端实战项目的主题，账单的增删改查之列表页。</p>
<blockquote>
<p>本教程已有线上地址<a href="https://link.juejin.cn/?target=http://cost.chennick.wang">在线地址</a>，同学们可以在实战部分，对照着线上页面进行学习。</p>
</blockquote>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>单项组件抽离</li>
<li>列表页无限滚动</li>
<li>下拉刷新列表</li>
<li>弹窗组件封装</li>
</ul>
<p>我们先来欣赏一下最终的页面效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fc0196a649c41cb8fe73dafe50233b0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="列表页编写（静态部分）"><a href="#列表页编写（静态部分）" class="headerlink" title="列表页编写（静态部分）"></a>列表页编写（静态部分）</h2><p>按照正常的开发流程，我们先将静态页面切出来，再填入数据使其动态化。在此之前，我们已经新建好了 <code>Home</code> 目录，该目录便是用于放置账单列表，所以我们直接在 <code>Home/index.jsx</code> 新增代码。</p>
<h3 id="头部统计实现"><a href="#头部统计实现" class="headerlink" title="头部统计实现"></a>头部统计实现</h3><p>列表的头部展示的内容为当月的收入和支出汇总，并且有两个列表条件过滤项，分别是类型过滤和时间过滤。</p>
<p>我们新增代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">import</span> &#123; Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"zarm"</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">"./style.module.less"</span>;<br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    &lt;div className=&#123;s.home&#125;&gt;<br>      &lt;div className=&#123;s.header&#125;&gt;<br>        &lt;div className=&#123;s.dataWrap&#125;&gt;<br>          &lt;span className=&#123;s.expense&#125;&gt;<br>            总支出：&lt;b&gt;¥ <span class="hljs-number">200</span>&lt;<span class="hljs-regexp">/b&gt;</span><br><span class="hljs-regexp">          &lt;/</span>span&gt;<br>          &lt;span className=&#123;s.income&#125;&gt;<br>            总收入：&lt;b&gt;¥ <span class="hljs-number">500</span>&lt;<span class="hljs-regexp">/b&gt;</span><br><span class="hljs-regexp">          &lt;/</span>span&gt;<br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">        &lt;div className=&#123;s.typeWrap&#125;&gt;</span><br><span class="hljs-regexp">          &lt;div className=&#123;s.left&#125;&gt;</span><br><span class="hljs-regexp">            &lt;span className=&#123;s.title&#125;&gt;</span><br><span class="hljs-regexp">              类型 &lt;Icon className=&#123;s.arrow&#125; type="arrow-bottom" /</span>&gt;<br>            &lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">          &lt;/</span>div&gt;<br>          &lt;div className=&#123;s.right&#125;&gt;<br>            &lt;span className=&#123;s.time&#125;&gt;<br>              <span class="hljs-number">2022</span><span class="hljs-number">-06</span><br>              &lt;Icon className=&#123;s.arrow&#125; type=<span class="hljs-string">"arrow-bottom"</span> /&gt;<br>            &lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">          &lt;/</span>div&gt;<br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;/</span>div&gt;<br>    &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">  );</span><br><span class="hljs-regexp">&#125;;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">export default Home;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>代码分析：</p>
<p><code>header</code> 采用 <code>fixed</code> 固定定位，将整个汇总信息固定在页面的顶部位置，这样后续列表滚动的时候，你可以方便查看当月的收入汇总，以及筛选当月消费类型和时间段的筛选。每个列表展示的是当月的收入与支出明细，比如 <code>2021-06</code> 的收入明细。</p>
<p>本次项目全程采用的是 <code>Flex</code> 弹性布局，这种布局形式在当下的开发生产环境已经非常成熟，同学们如果还有不熟悉的，请实现对 <code>Flex</code> 布局做一个简单的学习，这边推荐一个学习网站：</p>
<blockquote>
<p><a href="https://link.juejin.cn/?target=http://flexboxfroggy.com/%23zh-cn">flexboxfroggy.com&#x2F;#zh-cn</a></p>
</blockquote>
<p>笔者当初也是通过这个网站的学习，入门的 <code>Flex</code>。</p>
<p>完成上述布局之后，页面如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b4da908ba7d412ea25d6b925006f163~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="列表页面实现"><a href="#列表页面实现" class="headerlink" title="列表页面实现"></a>列表页面实现</h3><p>列表页面会用到 <code>Zarm</code> 组件库为我们提供的 <a href="https://link.juejin.cn/?target=https://zarm.gitee.io/%23/components/pull">Pull</a> 组件，来实现下拉刷新以及无限滚动，我们先来将基础布局实现，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Home/index.jsx</span><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [list, setList] = useState([<br>    &#123;<br>      bills: [<br>        &#123;<br>          amount: <span class="hljs-string">"25.00"</span>,<br>          date: <span class="hljs-string">"1623390740000"</span>,<br>          id: <span class="hljs-number">911</span>,<br>          pay_type: <span class="hljs-number">1</span>,<br>          remark: <span class="hljs-string">""</span>,<br>          type_id: <span class="hljs-number">1</span>,<br>          type_name: <span class="hljs-string">"餐饮"</span>,<br>        &#125;,<br>      ],<br>      date: <span class="hljs-string">"2021-06-11"</span>,<br>    &#125;,<br>  ]); <span class="hljs-comment">// 账单列表</span><br>  <span class="hljs-keyword">return</span> (<br>    &lt;div className=&#123;s.home&#125;&gt;<br>      &lt;div className=&#123;s.header&#125;&gt;...&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;div className=&#123;s.contentWrap&#125;&gt;</span><br><span class="hljs-regexp">        &#123;list.map((item, index) =&gt; (</span><br><span class="hljs-regexp">          &lt;BillItem /</span>&gt;<br>        ))&#125;<br>      &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">    &lt;/</span>div&gt;<br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>上述我们添加 <code>list</code> 为列表假数据，<code>BillItem</code> 组件为账单单项组件，我们将其抽离到 <code>components</code> 组件库，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// components/BillItem/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">"prop-types"</span>;<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">"dayjs"</span>;<br><span class="hljs-keyword">import</span> &#123; Cell &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"zarm"</span>;<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;<br><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">"../CustomIcon"</span>;<br><span class="hljs-keyword">import</span> &#123; typeMap &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils"</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">"./style.module.less"</span>;<br><br><span class="hljs-keyword">const</span> BillItem = <span class="hljs-function">(<span class="hljs-params">&#123; bill &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [income, setIncome] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 收入</span><br>  <span class="hljs-keyword">const</span> [expense, setExpense] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 支出</span><br>  <span class="hljs-keyword">const</span> navigateTo = useNavigate(); <span class="hljs-comment">// 路由实例</span><br><br>  <span class="hljs-comment">// 当添加账单是，bill.bills 长度变化，触发当日收支总和计算。</span><br>  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// 初始化将传入的 bill 内的 bills 数组内数据项，过滤出支出和收入。</span><br>    <span class="hljs-comment">// pay_type：1 为支出；2 为收入</span><br>    <span class="hljs-comment">// 通过 reduce 累加</span><br>    <span class="hljs-keyword">const</span> _income = bill.bills<br>      .filter(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.pay_type == <span class="hljs-number">2</span>)<br>      .reduce(<span class="hljs-function">(<span class="hljs-params">curr, item</span>) =&gt;</span> &#123;<br>        curr += <span class="hljs-built_in">Number</span>(item.amount);<br>        <span class="hljs-keyword">return</span> curr;<br>      &#125;, <span class="hljs-number">0</span>);<br>    setIncome(_income);<br>    <span class="hljs-keyword">const</span> _expense = bill.bills<br>      .filter(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.pay_type == <span class="hljs-number">1</span>)<br>      .reduce(<span class="hljs-function">(<span class="hljs-params">curr, item</span>) =&gt;</span> &#123;<br>        curr += <span class="hljs-built_in">Number</span>(item.amount);<br>        <span class="hljs-keyword">return</span> curr;<br>      &#125;, <span class="hljs-number">0</span>);<br>    setExpense(_expense);<br>  &#125;, [bill.bills]);<br><br>  <span class="hljs-comment">// 前往账单详情</span><br>  <span class="hljs-keyword">const</span> goToDetail = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    navigateTo(<span class="hljs-string">`/detail?id=<span class="hljs-subst">$&#123;item.id&#125;</span>`</span>);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    &lt;div className=&#123;s.item&#125;&gt;<br>      &lt;div className=&#123;s.headerDate&#125;&gt;<br>        &lt;div className=&#123;s.date&#125;&gt;&#123;bill.date&#125;&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">        &lt;div className=&#123;s.money&#125;&gt;</span><br><span class="hljs-regexp">          &lt;span&gt;</span><br><span class="hljs-regexp">            &lt;img src="/</span><span class="hljs-regexp">/s.yezgea02.com/</span><span class="hljs-number">1615953405599</span>/zhi%<span class="hljs-number">402</span>x.png<span class="hljs-string">" alt="</span>支<span class="hljs-string">" /&gt;</span><br><span class="hljs-string">            &lt;span&gt;¥&#123;expense.toFixed(2)&#125;&lt;/span&gt;</span><br><span class="hljs-string">          &lt;/span&gt;</span><br><span class="hljs-string">          &lt;span&gt;</span><br><span class="hljs-string">            &lt;img src="</span><span class="hljs-comment">//s.yezgea02.com/1615953405599/shou%402x.png" alt="收" /&gt;</span><br>            &lt;span&gt;¥&#123;income.toFixed(<span class="hljs-number">2</span>)&#125;&lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">          &lt;/</span>span&gt;<br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;/</span>div&gt;<br>      &#123;bill &amp;&amp;<br>        bill.bills.map(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> (<br>          &lt;Cell<br>            className=&#123;s.bill&#125;<br>            key=&#123;item.id&#125;<br>            onClick=&#123;() =&gt; goToDetail(item)&#125;<br>            title=&#123;<br>              &lt;&gt;<br>                &lt;CustomIcon<br>                  className=&#123;s.itemIcon&#125;<br>                  type=&#123;item.type_id ? typeMap[item.type_id].icon : <span class="hljs-number">1</span>&#125;<br>                /&gt;<br>                &lt;span&gt;&#123;item.type_name&#125;&lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">              &lt;/</span>&gt;<br>            &#125;<br>            description=&#123;<br>              &lt;span<br>                style=&#123;&#123; <span class="hljs-attr">color</span>: item.pay_type == <span class="hljs-number">2</span> ? <span class="hljs-string">"red"</span> : <span class="hljs-string">"#39be77"</span> &#125;&#125;<br>              &gt;&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;item.pay_type == <span class="hljs-number">1</span> ? <span class="hljs-string">"-"</span> : <span class="hljs-string">"+"</span>&#125;</span><span class="hljs-subst">$&#123;item.amount&#125;</span>`</span>&#125;&lt;<span class="hljs-regexp">/span&gt;</span><br><span class="hljs-regexp">            &#125;</span><br><span class="hljs-regexp">            help=&#123;</span><br><span class="hljs-regexp">              &lt;div&gt;</span><br><span class="hljs-regexp">                &#123;dayjs(Number(item.date)).format("HH:mm")&#125;&#123;" "&#125;</span><br><span class="hljs-regexp">                &#123;item.remark ? `| $&#123;item.remark&#125;` : ""&#125;</span><br><span class="hljs-regexp">              &lt;/</span>div&gt;<br>            &#125;<br>          &gt;&lt;<span class="hljs-regexp">/Cell&gt;</span><br><span class="hljs-regexp">        ))&#125;</span><br><span class="hljs-regexp">    &lt;/</span>div&gt;<br>  );<br>&#125;;<br><br>BillItem.propTypes = &#123;<br>  bill: PropTypes.object,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> BillItem;<br></code></pre></td></tr></table></figure>

<p>通过 <code>npm i dayjs -S</code> 添加日期操作工具，移动端建议使用 <code>dayjs</code>，因为它相比 <code>moment</code>，体积小很多。</p>
<p>上述代码中，<code>typeMap</code> 为我们自定义的属性，它是一个简直对，<code>key</code> 为消费类型 <code>icon</code> 的 <code>id</code>，<code>value</code> 为消费类型的 <code>iconfont</code> 的值，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// utils/index.js</span><br>...<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> typeMap = &#123;<br>  <span class="hljs-number">1</span>: &#123;<br>    icon: <span class="hljs-string">'canyin'</span><br>  &#125;,<br>  <span class="hljs-number">2</span>: &#123;<br>    icon: <span class="hljs-string">'fushi'</span><br>  &#125;,<br>  <span class="hljs-number">3</span>: &#123;<br>    icon: <span class="hljs-string">'jiaotong'</span><br>  &#125;,<br>  <span class="hljs-number">4</span>: &#123;<br>    icon: <span class="hljs-string">'riyong'</span><br>  &#125;,<br>  <span class="hljs-number">5</span>: &#123;<br>    icon: <span class="hljs-string">'gouwu'</span><br>  &#125;,<br>  <span class="hljs-number">6</span>: &#123;<br>    icon: <span class="hljs-string">'xuexi'</span><br>  &#125;,<br>  <span class="hljs-number">7</span>: &#123;<br>    icon: <span class="hljs-string">'yiliao'</span><br>  &#125;,<br>  <span class="hljs-number">8</span>: &#123;<br>    icon: <span class="hljs-string">'lvxing'</span><br>  &#125;,<br>  <span class="hljs-number">9</span>: &#123;<br>    icon: <span class="hljs-string">'renqing'</span><br>  &#125;,<br>  <span class="hljs-number">10</span>: &#123;<br>    icon: <span class="hljs-string">'qita'</span><br>  &#125;,<br>  <span class="hljs-number">11</span>: &#123;<br>    icon: <span class="hljs-string">'gongzi'</span><br>  &#125;,<br>  <span class="hljs-number">12</span>: &#123;<br>    icon: <span class="hljs-string">'jiangjin'</span><br>  &#125;,<br>  <span class="hljs-number">13</span>: &#123;<br>    icon: <span class="hljs-string">'zhuanzhang'</span><br>  &#125;,<br>  <span class="hljs-number">14</span>: &#123;<br>    icon: <span class="hljs-string">'licai'</span><br>  &#125;,<br>  <span class="hljs-number">15</span>: &#123;<br>    icon: <span class="hljs-string">'tuikuang'</span><br>  &#125;,<br>  <span class="hljs-number">16</span>: &#123;<br>    icon: <span class="hljs-string">'qita'</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>完成上述操作之后，我们重启浏览器，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2eb308feee24749a7ce4cd0d00a9645~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>样式部分大家可以根据自己的喜好进行微调，不一定要一模一样，仁者见仁。</p>
<h3 id="下拉刷新、上滑无限加载"><a href="#下拉刷新、上滑无限加载" class="headerlink" title="下拉刷新、上滑无限加载"></a>下拉刷新、上滑无限加载</h3><p>我们修改 <code>Home/index.jsx</code> 如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span><br><span class="hljs-keyword">import</span> &#123; Icon, Pull &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'zarm'</span><br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">'dayjs'</span><br><span class="hljs-keyword">import</span> BillItem <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/BillItem'</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">get</span>, REFRESH_STATE, LOAD_STATE &#125; from '@/utils' // Pull 组件需要的一些常量<br><br>import s from './style.module.less'<br><br>const Home = () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [currentTime, setCurrentTime] = useState(dayjs().format(<span class="hljs-string">'YYYY-MM'</span>)); <span class="hljs-comment">// 当前筛选时间</span><br>  <span class="hljs-keyword">const</span> [page, setPage] = useState(<span class="hljs-number">1</span>); <span class="hljs-comment">// 分页</span><br>  <span class="hljs-keyword">const</span> [list, setList] = useState([]); <span class="hljs-comment">// 账单列表</span><br>  <span class="hljs-keyword">const</span> [totalPage, setTotalPage] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 分页总数</span><br>  <span class="hljs-keyword">const</span> [refreshing, setRefreshing] = useState(REFRESH_STATE.normal); <span class="hljs-comment">// 下拉刷新状态</span><br>  <span class="hljs-keyword">const</span> [loading, setLoading] = useState(LOAD_STATE.normal); <span class="hljs-comment">// 上拉加载状态</span><br><br>  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    getBillList() <span class="hljs-comment">// 初始化</span><br>  &#125;, [page])<br><br>  <span class="hljs-comment">// 获取账单方法</span><br>  <span class="hljs-keyword">const</span> getBillList = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> <span class="hljs-keyword">get</span>(`/api/bill/list?page=$&#123;page&#125;&amp;page_size=<span class="hljs-number">5</span>&amp;date=$&#123;currentTime&#125;<span class="hljs-string">`);</span><br><span class="hljs-string">    // 下拉刷新，重制数据</span><br><span class="hljs-string">    if (page == 1) &#123;</span><br><span class="hljs-string">      setList(data.list);</span><br><span class="hljs-string">    &#125; else &#123;</span><br><span class="hljs-string">      setList(list.concat(data.list));</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    setTotalPage(data.totalPage);</span><br><span class="hljs-string">    // 上滑加载状态</span><br><span class="hljs-string">    setLoading(LOAD_STATE.success);</span><br><span class="hljs-string">    setRefreshing(REFRESH_STATE.success);</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  // 请求列表数据</span><br><span class="hljs-string">  const refreshData = () =&gt; &#123;</span><br><span class="hljs-string">    setRefreshing(REFRESH_STATE.loading);</span><br><span class="hljs-string">    if (page != 1) &#123;</span><br><span class="hljs-string">      setPage(1);</span><br><span class="hljs-string">    &#125; else &#123;</span><br><span class="hljs-string">      getBillList();</span><br><span class="hljs-string">    &#125;;</span><br><span class="hljs-string">  &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  const loadData = () =&gt; &#123;</span><br><span class="hljs-string">    if (page &lt; totalPage) &#123;</span><br><span class="hljs-string">      setLoading(LOAD_STATE.loading);</span><br><span class="hljs-string">      setPage(page + 1);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  return &lt;div className=&#123;s.home&#125;&gt;</span><br><span class="hljs-string">    &lt;div className=&#123;s.header&#125;&gt;</span><br><span class="hljs-string">      &lt;div className=&#123;s.dataWrap&#125;&gt;</span><br><span class="hljs-string">        &lt;span className=&#123;s.expense&#125;&gt;总支出：&lt;b&gt;¥ 200&lt;/b&gt;&lt;/span&gt;</span><br><span class="hljs-string">        &lt;span className=&#123;s.income&#125;&gt;总收入：&lt;b&gt;¥ 500&lt;/b&gt;&lt;/span&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">      &lt;div className=&#123;s.typeWrap&#125;&gt;</span><br><span class="hljs-string">        &lt;div className=&#123;s.left&#125;&gt;</span><br><span class="hljs-string">          &lt;span className=&#123;s.title&#125;&gt;类型 &lt;Icon className=&#123;s.arrow&#125; type="arrow-bottom" /&gt;&lt;/span&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div className=&#123;s.right&#125;&gt;</span><br><span class="hljs-string">          &lt;span className=&#123;s.time&#125;&gt;2022-06&lt;Icon className=&#123;s.arrow&#125; type="arrow-bottom" /&gt;&lt;/span&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">    &lt;div className=&#123;s.contentWrap&#125;&gt;</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        list.length ? &lt;Pull</span><br><span class="hljs-string">          animationDuration=&#123;200&#125;</span><br><span class="hljs-string">          stayTime=&#123;400&#125;</span><br><span class="hljs-string">          refresh=&#123;&#123;</span><br><span class="hljs-string">            state: refreshing,</span><br><span class="hljs-string">            handler: refreshData</span><br><span class="hljs-string">          &#125;&#125;</span><br><span class="hljs-string">          load=&#123;&#123;</span><br><span class="hljs-string">            state: loading,</span><br><span class="hljs-string">            distance: 200,</span><br><span class="hljs-string">            handler: loadData</span><br><span class="hljs-string">          &#125;&#125;</span><br><span class="hljs-string">        &gt;</span><br><span class="hljs-string">          &#123;</span><br><span class="hljs-string">            list.map((item, index) =&gt; &lt;BillItem</span><br><span class="hljs-string">              bill=&#123;item&#125;</span><br><span class="hljs-string">              key=&#123;index&#125;</span><br><span class="hljs-string">            /&gt;)</span><br><span class="hljs-string">          &#125;</span><br><span class="hljs-string">        &lt;/Pull&gt; : null</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">  &lt;/div&gt;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">export default Home</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p>在 <code>utils/index.js</code> 中添加一些 <code>Pull</code> 组件需要用到的常量，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// utils/index.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> REFRESH_STATE = &#123;<br>  normal: <span class="hljs-number">0</span>, <span class="hljs-comment">// 普通</span><br>  pull: <span class="hljs-number">1</span>, <span class="hljs-comment">// 下拉刷新（未满足刷新条件）</span><br>  drop: <span class="hljs-number">2</span>, <span class="hljs-comment">// 释放立即刷新（满足刷新条件）</span><br>  loading: <span class="hljs-number">3</span>, <span class="hljs-comment">// 加载中</span><br>  success: <span class="hljs-number">4</span>, <span class="hljs-comment">// 加载成功</span><br>  failure: <span class="hljs-number">5</span>, <span class="hljs-comment">// 加载失败</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> LOAD_STATE = &#123;<br>  normal: <span class="hljs-number">0</span>, <span class="hljs-comment">// 普通</span><br>  abort: <span class="hljs-number">1</span>, <span class="hljs-comment">// 中止</span><br>  loading: <span class="hljs-number">2</span>, <span class="hljs-comment">// 加载中</span><br>  success: <span class="hljs-number">3</span>, <span class="hljs-comment">// 加载成功</span><br>  failure: <span class="hljs-number">4</span>, <span class="hljs-comment">// 加载失败</span><br>  complete: <span class="hljs-number">5</span>, <span class="hljs-comment">// 加载完成（无新数据）</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>代码中，已经为大家整理了详细的注释。无限滚动在移动端的应用随处可见，所以这块内容大家尽量能做到烂熟于心。如果有可能的话，希望你也能将其二次封装，便于多个地方的复用。我们打开浏览器查看效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b1408791dbd457f9a68abd898f6bb74~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>同学们注意一下上述动图中的细节，滑到底部的时候，有一部分内容被遮挡住了，此时我们需要添加下列样式，进行修复：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.home</span> &#123;<br>  ... .content-wrap &#123;<br>    <span class="hljs-selector-tag">height</span>: <span class="hljs-selector-tag">calc</span>(~"(100% <span class="hljs-selector-tag">-</span> 50<span class="hljs-selector-tag">px</span>)");<br>    <span class="hljs-selector-tag">overflow</span>: <span class="hljs-selector-tag">hidden</span>;<br>    <span class="hljs-selector-tag">overflow-y</span>: <span class="hljs-selector-tag">scroll</span>;<br>    <span class="hljs-selector-tag">background-color</span>: <span class="hljs-selector-id">#f5f5f5</span>;<br>    <span class="hljs-selector-tag">padding</span>: 10<span class="hljs-selector-tag">px</span>;<br>    <span class="hljs-selector-pseudo">:global</span> &#123;<br>      .za-pull &#123;<br>        <span class="hljs-selector-tag">overflow</span>: <span class="hljs-selector-tag">unset</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>给 <code>content-wrap</code> 对应的标签一个高度，并且减去 <code>50px</code> 的高度，这样就不会被遮挡住下面一点的部分。</p>
<p>还有一个很关键的步骤，给 <code>src</code> 目录下的的 <code>index.css</code> 添加初始化高度和样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">"Segoe UI"</span>, <span class="hljs-string">"Roboto"</span>,<br>    <span class="hljs-string">"Oxygen"</span>, <span class="hljs-string">"Ubuntu"</span>, <span class="hljs-string">"Cantarell"</span>, <span class="hljs-string">"Fira Sans"</span>, <span class="hljs-string">"Droid Sans"</span>,<br>    <span class="hljs-string">"Helvetica Neue"</span>, sans-serif;<br>  <span class="hljs-attribute">-webkit-font-smoothing</span>: antialiased;<br>  <span class="hljs-attribute">-moz-osx-font-smoothing</span>: grayscale;<br>&#125;<br><br><span class="hljs-selector-tag">body</span>,<br><span class="hljs-selector-tag">html</span>,<br><span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><br>* &#123;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br><br><span class="hljs-selector-id">#root</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><br><span class="hljs-selector-class">.text-deep</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.9</span>);<br>&#125;<br><br><span class="hljs-selector-class">.text-light</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.6</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>至此，滚动加载基本上就完成了。</p>
<h3 id="添加筛选条件"><a href="#添加筛选条件" class="headerlink" title="添加筛选条件"></a>添加筛选条件</h3><p>最后我们需要添加两个筛选条件，类型选择和日期选择。</p>
<p>我们先来实现类型选择弹窗，我们采用的形式如下，底部弹出的弹窗形式，大致如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a334aa0eee1451fbb268f3b2e70a67c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>想要实现上述形式，我们需要借助 <code>Zarm</code> 组件库为我们提供的 <a href="https://link.juejin.cn/?target=https://zarm.gitee.io/%23/components/popup">Popup</a> 组件，它的作用就是从不同方向弹出一个脱离文档流的弹出层。同样，我们使用组件的形式将其放置于 <code>components</code> 文件夹内实现，这样便于后续其他地方的使用。</p>
<p>新建 <code>components/PopupType</code>，在其内部新建 <code>index.jsx</code> 和 <code>style.module.less</code> 内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// PopupType/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; forwardRef, useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">"prop-types"</span>;<br><span class="hljs-keyword">import</span> &#123; Popup, Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"zarm"</span>;<br><span class="hljs-keyword">import</span> cx <span class="hljs-keyword">from</span> <span class="hljs-string">"classnames"</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">get</span> &#125; from "@/utils";<br><br>import s from "./style.module.less";<br><br>// forwardRef 用于拿到父组件传入的 ref 属性，这样在父组件便能通过 ref 控制子组件。<br>const PopupType = forwardRef((&#123; onSelect &#125;, ref) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = useState(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 组件的显示和隐藏</span><br>  <span class="hljs-keyword">const</span> [active, setActive] = useState(<span class="hljs-string">"all"</span>); <span class="hljs-comment">// 激活的 type</span><br>  <span class="hljs-keyword">const</span> [expense, setExpense] = useState([]); <span class="hljs-comment">// 支出类型标签</span><br>  <span class="hljs-keyword">const</span> [income, setIncome] = useState([]); <span class="hljs-comment">// 收入类型标签</span><br><br>  useEffect(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-comment">// 请求标签接口放在弹窗内，这个弹窗可能会被复用，所以请求如果放在外面，会造成代码冗余。</span><br>    <span class="hljs-keyword">const</span> &#123;<br>      data: &#123; list &#125;,<br>    &#125; = <span class="hljs-keyword">await</span> <span class="hljs-keyword">get</span>("/api/type/list");<br>    setExpense(list.filter((i) =&gt; i.type == 1));<br>    setIncome(list.filter((i) =&gt; i.type == 2));<br>  &#125;, []);<br><br>  if (ref) &#123;<br>    ref.current = &#123;<br>      <span class="hljs-comment">// 外部可以通过 ref.current.show 来控制组件的显示</span><br>      show: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">true</span>);<br>      &#125;,<br>      <span class="hljs-comment">// 外部可以通过 ref.current.close 来控制组件的显示</span><br>      close: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">false</span>);<br>      &#125;,<br>    &#125;;<br>  &#125;<br><br>  <span class="hljs-comment">// 选择类型回调</span><br>  <span class="hljs-keyword">const</span> choseType = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setActive(item.id);<br>    setShow(<span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">// 父组件传入的 onSelect，为了获取类型</span><br>    onSelect(item);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    &lt;Popup<br>      visible=&#123;show&#125;<br>      direction=<span class="hljs-string">"bottom"</span><br>      onMaskClick=&#123;() =&gt; setShow(<span class="hljs-literal">false</span>)&#125;<br>      destroy=&#123;<span class="hljs-literal">false</span>&#125;<br>      mountContainer=&#123;() =&gt; <span class="hljs-built_in">document</span>.body&#125;<br>    &gt;<br>      &lt;div className=&#123;s.popupType&#125;&gt;<br>        &lt;div className=&#123;s.header&#125;&gt;<br>          请选择类型<br>          &lt;Icon<br>            type=<span class="hljs-string">"wrong"</span><br>            className=&#123;s.cross&#125;<br>            onClick=&#123;() =&gt; setShow(<span class="hljs-literal">false</span>)&#125;<br>          /&gt;<br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">        &lt;div className=&#123;s.content&#125;&gt;</span><br><span class="hljs-regexp">          &lt;div</span><br><span class="hljs-regexp">            onClick=&#123;() =&gt; choseType(&#123; id: "all" &#125;)&#125;</span><br><span class="hljs-regexp">            className=&#123;cx(&#123; [s.all]: true, [s.active]: active == "all" &#125;)&#125;</span><br><span class="hljs-regexp">          &gt;</span><br><span class="hljs-regexp">            全部类型</span><br><span class="hljs-regexp">          &lt;/</span>div&gt;<br>          &lt;div className=&#123;s.title&#125;&gt;支出&lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">          &lt;div className=&#123;s.expenseWrap&#125;&gt;</span><br><span class="hljs-regexp">            &#123;expense.map((item, index) =&gt; (</span><br><span class="hljs-regexp">              &lt;p</span><br><span class="hljs-regexp">                key=&#123;index&#125;</span><br><span class="hljs-regexp">                onClick=&#123;() =&gt; choseType(item)&#125;</span><br><span class="hljs-regexp">                className=&#123;cx(&#123; [s.active]: active == item.id &#125;)&#125;</span><br><span class="hljs-regexp">              &gt;</span><br><span class="hljs-regexp">                &#123;item.name&#125;</span><br><span class="hljs-regexp">              &lt;/</span>p&gt;<br>            ))&#125;<br>          &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">          &lt;div className=&#123;s.title&#125;&gt;收入&lt;/</span>div&gt;<br>          &lt;div className=&#123;s.incomeWrap&#125;&gt;<br>            &#123;income.map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> (<br>              &lt;p<br>                key=&#123;index&#125;<br>                onClick=&#123;() =&gt; choseType(item)&#125;<br>                className=&#123;cx(&#123; [s.active]: active == item.id &#125;)&#125;<br>              &gt;<br>                &#123;item.name&#125;<br>              &lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp">            ))&#125;</span><br><span class="hljs-regexp">          &lt;/</span>div&gt;<br>        &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">      &lt;/</span>div&gt;<br>    &lt;<span class="hljs-regexp">/Popup&gt;</span><br><span class="hljs-regexp">  );</span><br><span class="hljs-regexp">&#125;);</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">PopupType.propTypes = &#123;</span><br><span class="hljs-regexp">  onSelect: PropTypes.func,</span><br><span class="hljs-regexp">&#125;;</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">export default PopupType;</span><br></code></pre></td></tr></table></figure>

<p>老规矩，代码逻辑注释我都写在代码中，我坚持不把注释和逻辑分开，是因为我自己在看其他教程的时候，遇到代码中没写逻辑的文章，来回看下边的注释和上边的代码，有点乱，如果同学们有疑问，可以进群截图咨询，我在群里看到的话，随时进行解答。</p>
<p>类型弹窗组件写完之后，我们在 <code>Home/index.jsx</code> 内尝试调用它，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> PopupType <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/PopupType'</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> typeRef = useRef(); <span class="hljs-comment">// 账单类型 ref</span><br>  <span class="hljs-keyword">const</span> [currentSelect, setCurrentSelect] = useState(&#123;&#125;); <span class="hljs-comment">// 当前筛选类型</span><br>  ...<br><br>  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    getBillList() <span class="hljs-comment">// 初始化</span><br>  &#125;, [page, currentSelect])<br><br>  <span class="hljs-keyword">const</span> getBillList = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> <span class="hljs-keyword">get</span>(`/api/bill/list?page=$&#123;page&#125;&amp;page_size=<span class="hljs-number">5</span>&amp;date=$&#123;currentTime&#125;&amp;type_id=$&#123;currentSelect.id || <span class="hljs-string">'all'</span>&#125;<span class="hljs-string">`);</span><br><span class="hljs-string">    // 下拉刷新，重制数据</span><br><span class="hljs-string">    if (page == 1) &#123;</span><br><span class="hljs-string">      setList(data.list);</span><br><span class="hljs-string">    &#125; else &#123;</span><br><span class="hljs-string">      setList(list.concat(data.list));</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    setTotalPage(data.totalPage);</span><br><span class="hljs-string">    // 上滑加载状态</span><br><span class="hljs-string">    setLoading(LOAD_STATE.success);</span><br><span class="hljs-string">    setRefreshing(REFRESH_STATE.success);</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  ...</span><br><span class="hljs-string"></span><br><span class="hljs-string">  // 添加账单弹窗</span><br><span class="hljs-string">  const toggle = () =&gt; &#123;</span><br><span class="hljs-string">    typeRef.current &amp;&amp; typeRef.current.show()</span><br><span class="hljs-string">  &#125;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  // 筛选类型</span><br><span class="hljs-string">  const select = (item) =&gt; &#123;</span><br><span class="hljs-string">    setRefreshing(REFRESH_STATE.loading);</span><br><span class="hljs-string">    // 触发刷新列表，将分页重制为 1</span><br><span class="hljs-string">    setPage(1);</span><br><span class="hljs-string">    setCurrentSelect(item)</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  return &lt;div className=&#123;s.home&#125;&gt;</span><br><span class="hljs-string">    &lt;div className=&#123;s.header&#125;&gt;</span><br><span class="hljs-string">      &lt;div className=&#123;s.dataWrap&#125;&gt;</span><br><span class="hljs-string">        &lt;span className=&#123;s.expense&#125;&gt;总支出：&lt;b&gt;¥ 200&lt;/b&gt;&lt;/span&gt;</span><br><span class="hljs-string">        &lt;span className=&#123;s.income&#125;&gt;总收入：&lt;b&gt;¥ 500&lt;/b&gt;&lt;/span&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">      &lt;div className=&#123;s.typeWrap&#125;&gt;</span><br><span class="hljs-string">        &lt;div className=&#123;s.left&#125; onClick=&#123;toggle&#125;&gt;</span><br><span class="hljs-string">          &lt;span className=&#123;s.title&#125;&gt;&#123; currentSelect.name || '全部类型' &#125; &lt;Icon className=&#123;s.arrow&#125; type="arrow-bottom" /&gt;&lt;/span&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div className=&#123;s.right&#125;&gt;</span><br><span class="hljs-string">          &lt;span className=&#123;s.time&#125;&gt;2022-06&lt;Icon className=&#123;s.arrow&#125; type="arrow-bottom" /&gt;&lt;/span&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">      &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">    &lt;div className=&#123;s.contentWrap&#125;&gt;</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        list.length ? &lt;Pull</span><br><span class="hljs-string">          animationDuration=&#123;200&#125;</span><br><span class="hljs-string">          stayTime=&#123;400&#125;</span><br><span class="hljs-string">          refresh=&#123;&#123;</span><br><span class="hljs-string">            state: refreshing,</span><br><span class="hljs-string">            handler: refreshData</span><br><span class="hljs-string">          &#125;&#125;</span><br><span class="hljs-string">          load=&#123;&#123;</span><br><span class="hljs-string">            state: loading,</span><br><span class="hljs-string">            distance: 200,</span><br><span class="hljs-string">            handler: loadData</span><br><span class="hljs-string">          &#125;&#125;</span><br><span class="hljs-string">        &gt;</span><br><span class="hljs-string">          &#123;</span><br><span class="hljs-string">            list.map((item, index) =&gt; &lt;BillItem</span><br><span class="hljs-string">              bill=&#123;item&#125;</span><br><span class="hljs-string">              key=&#123;index&#125;</span><br><span class="hljs-string">            /&gt;)</span><br><span class="hljs-string">          &#125;</span><br><span class="hljs-string">        &lt;/Pull&gt; : null</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">    &lt;PopupType ref=&#123;typeRef&#125; onSelect=&#123;select&#125; /&gt;</span><br><span class="hljs-string">  &lt;/div&gt;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p>添加类型选择弹窗注意几个点：</p>
<p>1、使用 <code>useState</code> 声明好类型字段。 2、通过 <code>useRef</code> 声明的 ref 给到 <code>PopupType</code> 组件，便于控制内部的方法。 3、传递 <code>onSelect</code> 方法，获取到弹窗内部选择的类型。 4、<code>useEffect</code> 第二个参数，添加一个 <code>currentSelect</code> 以来，便于修改的时候，触发列表的重新渲染。</p>
<p>有一个有趣的知识点，这里和大家分享一下，你尝试去打印 <code>typeRef</code> 变量，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c7b0f79094c436d8ee0d089b35acc46~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>可以看到，在 <code>PopupType</code> 组件内挂载的方法，可以在父组件内获取到，那么我们便可以直接把弹窗的显示隐藏参数放在子组件内维护，而不用每次都去在父组件声明 <code>show</code> 或 <code>hide</code>。</p>
<p>加完类型筛选之后，我们再将时间筛选加上，同样将时间筛选添加至 <code>components</code> 目录下，便于后续数据页面的时间筛选。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// PopupDate/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; forwardRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">"prop-types"</span>;<br><span class="hljs-keyword">import</span> &#123; Popup, DatePicker &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"zarm"</span>;<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">"dayjs"</span>;<br><br><span class="hljs-keyword">const</span> PopupDate = forwardRef(<span class="hljs-function">(<span class="hljs-params">&#123; onSelect, mode = <span class="hljs-string">"date"</span> &#125;, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = useState(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [now, setNow] = useState(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<br><br>  <span class="hljs-keyword">const</span> choseMonth = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setNow(item);<br>    setShow(<span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">if</span> (mode == <span class="hljs-string">"month"</span>) &#123;<br>      onSelect(dayjs(item).format(<span class="hljs-string">"YYYY-MM"</span>));<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mode == <span class="hljs-string">"date"</span>) &#123;<br>      onSelect(dayjs(item).format(<span class="hljs-string">"YYYY-MM-DD"</span>));<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-keyword">if</span> (ref) &#123;<br>    ref.current = &#123;<br>      show: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">true</span>);<br>      &#125;,<br>      close: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">false</span>);<br>      &#125;,<br>    &#125;;<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    &lt;Popup<br>      visible=&#123;show&#125;<br>      direction=<span class="hljs-string">"bottom"</span><br>      onMaskClick=&#123;() =&gt; setShow(<span class="hljs-literal">false</span>)&#125;<br>      destroy=&#123;<span class="hljs-literal">false</span>&#125;<br>      mountContainer=&#123;() =&gt; <span class="hljs-built_in">document</span>.body&#125;<br>    &gt;<br>      &lt;div&gt;<br>        &lt;DatePicker<br>          visible=&#123;show&#125;<br>          value=&#123;now&#125;<br>          mode=&#123;mode&#125;<br>          onOk=&#123;choseMonth&#125;<br>          onCancel=&#123;() =&gt; setShow(<span class="hljs-literal">false</span>)&#125;<br>        /&gt;<br>      &lt;<span class="hljs-regexp">/div&gt;</span><br><span class="hljs-regexp">    &lt;/</span>Popup&gt;<br>  );<br>&#125;);<br><br>PopupDate.propTypes = &#123;<br>  mode: PropTypes.string, <span class="hljs-comment">// 日期模式</span><br>  onSelect: PropTypes.func, <span class="hljs-comment">// 选择后的回调</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> PopupDate;<br></code></pre></td></tr></table></figure>

<p>底部时间弹窗逻辑和类型选择的逻辑相似，这里不做赘述，直接在 <code>Home/index.jsx</code> 中引入时间筛选框：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Home/index.jsx</span><br>...<br><span class="hljs-keyword">import</span> PopupDate <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/PopupDate'</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> monthRef = useRef(); <span class="hljs-comment">// 月份筛选 ref</span><br><br>  useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    getBillList() <span class="hljs-comment">// 初始化</span><br>  &#125;, [page, currentSelect, currentTime])<br><br>  ...<br><br>  <span class="hljs-comment">// 选择月份弹窗</span><br>  <span class="hljs-keyword">const</span> monthToggle = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    monthRef.current &amp;&amp; monthRef.current.show()<br>  &#125;;<br><br>  <span class="hljs-comment">// 筛选月份</span><br>  <span class="hljs-keyword">const</span> selectMonth = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setRefreshing(REFRESH_STATE.loading);<br>    setPage(<span class="hljs-number">1</span>);<br>    setCurrentTime(item)<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br>    &lt;div className=&#123;s.right&#125;&gt;<br>      &lt;span className=&#123;s.time&#125; onClick=&#123;monthToggle&#125;&gt;&#123; currentTime &#125;&lt;Icon className=&#123;s.arrow&#125; type="arrow-bottom" /&gt;&lt;/span&gt;<br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    ...</span><br><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">PopupDate</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;monthRef&#125;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"month"</span> <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;selectMonth&#125;</span> /&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>刷新浏览器如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/847ab58538134cdcb8d819d61823a5a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>最后不要忘记计算当前月份的收入和支出汇总数据，放置于头部，修改 <code>Home/index.jsx</code> 内的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">const</span> Home = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> [totalExpense, setTotalExpense] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 总支出</span><br>  <span class="hljs-keyword">const</span> [totalIncome, setTotalIncome] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 总收入</span><br><br>  <span class="hljs-keyword">const</span> getBillList = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> <span class="hljs-keyword">get</span>(`/api/bill/list?page=$&#123;page&#125;&amp;page_size=<span class="hljs-number">5</span>&amp;date=$&#123;currentTime&#125;&amp;type_id=$&#123;currentSelect.id || <span class="hljs-string">'all'</span>&#125;<span class="hljs-string">`);</span><br><span class="hljs-string">    // 下拉刷新，重制数据</span><br><span class="hljs-string">    if (page == 1) &#123;</span><br><span class="hljs-string">      setList(data.list);</span><br><span class="hljs-string">    &#125; else &#123;</span><br><span class="hljs-string">      setList(list.concat(data.list));</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    setTotalExpense(data.totalExpense.toFixed(2));</span><br><span class="hljs-string">    setTotalIncome(data.totalIncome.toFixed(2));</span><br><span class="hljs-string">    setTotalPage(data.totalPage);</span><br><span class="hljs-string">    // 上滑加载状态</span><br><span class="hljs-string">    setLoading(LOAD_STATE.success);</span><br><span class="hljs-string">    setRefreshing(REFRESH_STATE.success);</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  return &lt;div className=&#123;s.home&#125;&gt;</span><br><span class="hljs-string">    ...</span><br><span class="hljs-string">    &lt;div className=&#123;s.dataWrap&#125;&gt;</span><br><span class="hljs-string">      &lt;span className=&#123;s.expense&#125;&gt;总支出：&lt;b&gt;¥ &#123; totalExpense &#125;&lt;/b&gt;&lt;/span&gt;</span><br><span class="hljs-string">      &lt;span className=&#123;s.income&#125;&gt;总收入：&lt;b&gt;¥ &#123; totalIncome &#125;&lt;/b&gt;&lt;/span&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">    ...</span><br><span class="hljs-string">  &lt;div&gt;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<p>最终展示效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17747f5d0d7b41eabcbe47e8dc633de7~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本章节的内容，偏向实战，而实战部分代码在文章的重复率不可避免，这里大家把握好本章节两个重要知识点：</p>
<p>1、无限加载、下拉刷新。</p>
<p>2、公用组件提取，如弹窗组件、账单组件。</p>
<p>这两个知识点在实战中，用到的非常多，希望同学们能重视。</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/01/18/116-react/" title="116、稀土掘金小册-记账本（七）新增账单弹窗封装"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: 116、稀土掘金小册-记账本（七）新增账单弹窗封装</span></a><a class="button is-default" href="/2023/01/08/114-react/" title="114、稀土掘金小册-记账本（五）登录注册"><span class="has-text-weight-semibold">下一页: 114、稀土掘金小册-记账本（五）登录注册</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Jude"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><a title="zhihu" target="_blank" rel="noopener nofollow" href="//zhihu.com/https://www.zhihu.com/hot"><i class="iconfont icon-zhihu"></i></a><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Jude 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen" target="_blank" rel="noopener">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span>记住昨日的美好，过好今日的生活，憧憬明天的到来</span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>