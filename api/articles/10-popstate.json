{"title":"10、微信公众号网页使用popstate事件","uid":"a02ddc5c71902c14b366a37989f821e2","slug":"10-popstate","date":"2019-12-23T12:00:00.000Z","updated":"2022-09-05T07:33:29.000Z","comments":true,"path":"api/articles/10-popstate.json","keywords":null,"cover":null,"content":"<p>如何在h5移动端禁止某一些页面使用虚拟返回键。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"1、popstate事件\"><a href=\"#1、popstate事件\" class=\"headerlink\" title=\"1、popstate事件\"></a>1、popstate事件</h3><p>MDN上是这样介绍popstate的：<br>    当活动历史记录条目更改时，将触发popstate事件。如果被激活的历史记录条目是通过对history.pushState（）的调用创建的，或者受到对history.replaceState（）的调用的影响，popstate事件的state属性包含历史条目的状态对象的副本。<br>    需要注意的是调用history.pushState()或history.replaceState()不会触发popstate事件。只有在做出浏览器动作时，才会触发该事件，如用户点击浏览器的回退按钮（或者在Javascript代码中调用history.back()或者history.forward()方法）<br>    不同的浏览器在加载页面时处理popstate事件的形式存在差异。页面加载时Chrome和Safari通常会触发(emit )popstate事件，但Firefox则不会。<br>    我负责的一个项目中，在微信公众号网页的某一个页面需要禁止使用微信浏览器的返回键。</p>\n<h3 id=\"2、解决方式：\"><a href=\"#2、解决方式：\" class=\"headerlink\" title=\"2、解决方式：\"></a>2、解决方式：</h3><details>\n<summary>点我展示代码</summary>\n\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 在禁止返回的组件的methods中写一个方法forbidBack</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">forbidBack</span><span style=\"color: #BABED8\">()</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">history</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">pushState</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">forward</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,null,</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">#</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">history</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">forward</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">// 监听返回键，禁止返回之前的路由</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\">(window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">history </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">history</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">pushState)</span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">addEventListener</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">popstate</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,this.</span><span style=\"color: #BABED8\">forbidBack</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #FF9CAC\">false</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">this.</span><span style=\"color: #82AAFF\">forbidBack</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">//离开页面需要销毁监听</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">window</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">removeEventListener</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">popstate</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,this.</span><span style=\"color: #BABED8\">forbidBack</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">fasle)</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div></details>","text":"如何在h5移动端禁止某一些页面使用虚拟返回键。 1、popstate事件MDN上是这样介绍popstate的： 当活动历史记录条目更改时，将触发popstate...","permalink":"/post/10-popstate","photos":[],"count_time":{"symbolsCount":938,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"dev","slug":"dev","count":15,"path":"api/tags/dev.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1%E3%80%81popstate%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">1、popstate事件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F%EF%BC%9A\"><span class=\"toc-text\">2、解决方式：</span></a></li></ol>","author":{"name":"Jude","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"11、二维码的生成","uid":"305474c5192f2cb44a35555f258cd08e","slug":"11-qrcode","date":"2019-12-28T12:00:00.000Z","updated":"2022-09-05T07:33:58.000Z","comments":true,"path":"api/articles/11-qrcode.json","keywords":null,"cover":null,"text":"使用 qrcode 生成二维码 一、下载插件 qrcode 插件 js npm install qrcode --save二、在 main.js 中引用 jsi...","permalink":"/post/11-qrcode","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"dev","slug":"dev","count":15,"path":"api/tags/dev.json"}],"author":{"name":"Jude","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"9、h5扫码功能的实现","uid":"66b773f5ea2d0fd7877b90a347385c98","slug":"9-h5-scan","date":"2019-12-20T12:00:00.000Z","updated":"2022-09-05T07:32:57.000Z","comments":true,"path":"api/articles/9-h5-scan.json","keywords":null,"cover":null,"text":"使用H5 API barcode实现扫码。 html&lt;template&gt; &lt;div&gt; &lt;div @click=&quot;hand...","permalink":"/post/9-h5-scan","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"h5","slug":"h5","count":1,"path":"api/tags/h5.json"}],"author":{"name":"Jude","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}