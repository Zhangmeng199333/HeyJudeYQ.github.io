{"title":"31、解决点击手机虚拟返回键退出应用","uid":"f18cc13b06f49583aa6612c15444224c","slug":"31-back","date":"2021-03-23T12:00:00.000Z","updated":"2022-09-05T07:44:37.000Z","comments":true,"path":"api/articles/31-back.json","keywords":null,"cover":null,"content":"<p>如何解决安卓手机点击虚拟返回键退出当前应用。</p>\n<span id=\"more\"></span>\n\n<p>一、问题描述：</p>\n<p>最近的项目是使用Vue全家桶+HBuilder打包开发一个移动端APP。<br>在测试的时候发现，当安卓手机使用虚拟按钮的时候，点击虚拟按钮的返回键，APP会直接退出。<br>这是因为安卓手机自带back虚拟按键，如果不修改其默认事件，点一下app就退出了，<br>所以需要修改这个按键默认事件事件的代码。</p>\n<p>二、解决办法：</p>\n<p>在index.html中加入一个script，加上如下代码：</p>\n<details>\n<summary>点我展示代码</summary>\n\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\">script</span><span style=\"color: #89DDFF\">&gt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    document.addEventListener(&#39;plusready&#39;, function () </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        var first </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">null</span><span style=\"color: #BABED8\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        var webview </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> plus</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">webview</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">currentWebview</span><span style=\"color: #BABED8\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        plus</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">key</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">addEventListener</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">backbutton</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">            </span><span style=\"color: #BABED8\">webview</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">canBack</span><span style=\"color: #F07178\">(</span><span style=\"color: #C792EA\">function</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">e</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #BABED8\">e</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">canBack</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                    </span><span style=\"color: #BABED8\">webview</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">back</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">//这里不建议修改自己跳转的路径  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">                    </span><span style=\"color: #676E95; font-style: italic\">//首次按键，提示‘再按一次退出应用’  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #89DDFF\">!</span><span style=\"color: #BABED8\">first</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                      </span><span style=\"color: #BABED8\">first</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">new</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">Date</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getTime</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">//获取第一次点击的时间戳  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                      </span><span style=\"color: #BABED8\">plus</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">nativeUI</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">toast</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">再按一次退出应用</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                        duration</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">short</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                      </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">//通过H5+ API 调用Android 上的toast 提示框  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                      </span><span style=\"color: #82AAFF\">setTimeout</span><span style=\"color: #F07178\">(</span><span style=\"color: #C792EA\">function</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                        </span><span style=\"color: #BABED8\">first</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">null;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                      </span><span style=\"color: #89DDFF\">&#125;,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1000</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">                        </span><span style=\"color: #676E95; font-style: italic\">// 获取第二次点击的时间戳, 两次之差 小于 1000ms 说明1s点击了两次, </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                      </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #89DDFF\">new</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">Date</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getTime</span><span style=\"color: #F07178\">() </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">first</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1000</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #F07178\">  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                        </span><span style=\"color: #BABED8\">plus</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">runtime</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">quit</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95; font-style: italic\">//退出应用  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">              </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">          </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&lt;/</span><span style=\"color: #F07178\">script</span><span style=\"color: #89DDFF\">&gt;</span></span></code></pre></div></details>","text":"如何解决安卓手机点击虚拟返回键退出当前应用。 一、问题描述： 最近的项目是使用Vue全家桶+HBuilder打包开发一个移动端APP。在测试的时候发现，当安卓手...","permalink":"/post/31-back","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"dev","slug":"dev","count":15,"path":"api/tags/dev.json"}],"toc":"","author":{"name":"Jude","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"32、javascript -- 对象","uid":"3d946e8b4b11c3d4e608423cd2c6cf9c","slug":"32-javascript-simple3","date":"2021-04-13T16:00:00.000Z","updated":"2022-11-08T07:47:19.000Z","comments":true,"path":"api/articles/32-javascript-simple3.json","keywords":null,"cover":null,"text":"对象类型和原始类型的不同之处？函数参数是对象会发生什么问题？ 在 JS 中，除了原始类型那么其他的都是对象类型了。对象类型和原始类型不同的是：原始类型存储的是值...","permalink":"/post/32-javascript-simple3","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"13 mins."},"categories":[],"tags":[{"name":"js","slug":"js","count":11,"path":"api/tags/js.json"}],"author":{"name":"Jude","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"30、v-for 和 v-if 优先级","uid":"411f39ec2fc2f918d06983313497452a","slug":"30-v-for-v-if","date":"2021-03-15T16:00:00.000Z","updated":"2022-09-05T07:44:24.000Z","comments":true,"path":"api/articles/30-v-for-v-if.json","keywords":null,"cover":null,"text":"v-for 和 v-if 优先级在vue2.x和vue3.x是相反的。 1、实践中，不应该将v-for和v-if放在一起 2、Vue2中，v-for的优先级是高...","permalink":"/post/30-v-for-v-if","photos":[],"count_time":{"symbolsCount":548,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"vue","slug":"vue","count":17,"path":"api/tags/vue.json"}],"author":{"name":"Jude","slug":"blog-author","avatar":"","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}