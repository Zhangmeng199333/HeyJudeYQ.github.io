<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>如何使用canvas压缩图片？</title><meta name="description" content="May the Force be with you"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
canvas 是 HTML5 的新特性，它允许我们使用 canvas 元素在网页上通过 JavaScript 绘制图像 （可以在 HTML 页面使用多个 canvas 元素）






1、绘图流程:
// 1、编写canvas标签，指定宽高（注意）；
&amp;lt;canvas id=&amp;quot;canvas&amp;quot; width=&amp;quot;800&amp;quot; height=&amp;quot;800&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;;
// 2、获取canvas DOM对象；
const canvas = document.getElementById(&amp;quot;canvas&amp;quot;);
// 3、获取Canvas对象；
const ctx = canvas.getContext(&amp;qu.."><meta name="generator" content="Hexo 6.0.0"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">HeyJudeYQ's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">如何使用canvas压缩图片？</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile is-hidden"></div><div class="column is-9"><header class="my-4"><a href="/tags/canvas"><i class="tag post-item-tag">canvas</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">如何使用canvas压缩图片？</h1><time class="has-text-grey" datetime="2020-04-10T12:00:00.000Z">2020-04-10</time><article class="mt-2 post-content"><blockquote>
<p>canvas 是 HTML5 的新特性，它允许我们使用 canvas 元素在网页上通过 JavaScript 绘制图像 （可以在 HTML 页面使用多个 canvas 元素）</p>
</blockquote>
<span id="more"></span>




<p><strong>1、绘图流程:</strong></p>
<pre><code class="js">// 1、编写canvas标签，指定宽高（注意）；
&lt;canvas id=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;;
// 2、获取canvas DOM对象；
const canvas = document.getElementById(&quot;canvas&quot;);
// 3、获取Canvas对象；
const ctx = canvas.getContext(&quot;2d&quot;); // 拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法
// 4、设置绘图属性；
ctx.fillStyle = &quot;red&quot;; //设置填充色
// 5、调用绘图API。
ctx.fillRect(0, 0, 50, 50); // 绘制矩形
</code></pre>
<p><strong>2、canvas 路径</strong></p>
<p>常用的方法：</p>
<p>（1）moveTo(x,y)–定义线条开始坐标</p>
<p>（2）lineTo(x,y)–定义线条结束坐标</p>
<p>示例 1、绘制线段</p>
<pre><code class="js">&lt;canvas id=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;;
var canvas = document.getElementById(&quot;canvas&quot;);
var ctx = canvas.getContext(&quot;2d&quot;);
ctx.beginPath(); // 开始绘制路径
ctx.lineWidth = 1; // 线条宽度
ctx.strokeStyle = &quot;green&quot;; // 线条填充色
ctx.moveTo(0, 0);
ctx.lineTo(200, 100);
ctx.stroke(); // 绘制线段
</code></pre>
<p>示例 2、绘制圆形</p>
<p>arc(x,y,r,start,stop) x 轴 y 轴 r 半径</p>
<pre><code class="js">&lt;canvas id=&quot;canvas&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;;
var canvas = document.getElementById(&quot;canvas&quot;);
var ctx = canvas.getContext(&quot;2d&quot;);
ctx.beginPath();
ctx.lineWidth = 2;
ctx.strokeStyle = &quot;green&quot;; // 圆形边框色
ctx.fillStyle = &quot;red&quot;; // 圆形填充色
ctx.arc(95, 50, 40, 0, 2 * Math.PI);
ctx.stroke();
</code></pre>
<p>示例 3、绘制矩形 （代码见绘图流程）</p>
<p><strong>3、使用 canvas 压缩图片</strong></p>
<pre><code class="html">&lt;!--编写input标签 指定type类型为file--&gt;
&lt;input type=&quot;file&quot; id=&quot;upload&quot; /&gt;
</code></pre>
<details>
<summary>压缩图片js代码(点击展开)</summary>

<pre><code class="js">// 设置上传图片类型  上传图片的容量大小
const ACCEPT = [&quot;image/jpg&quot;, &quot;image/png&quot;, &quot;image/jpeg&quot;]; // 限定图片文件类型
const MAXSIZE = 1024 * 1024 * 3; // 限定图片最大容量
const MAXSIZE_STR = &quot;3MB&quot;;

function convertImageToBase64(file, cb) &#123;
  let reader = new FileReader();
  reader.addEventListener(&quot;load&quot;, function (e) &#123;
    const base64Image = e.target.result; // 获取文件内容，等同于 reader.result
    cb(base64Image);
    reader = null;
  &#125;);
  reader.readAsDataURL(file); // 读取 file 对象中的内容
&#125;
// 图片是否压缩的判断
function compress(base64Image, cb) &#123;
  let maxW = 1024;
  let maxH = 1024;
  const image = new Image();
  image.addEventListener(&quot;load&quot;, function () &#123;
    let ratio; // 压缩比
    let needCompress = false; // 是否需要压缩
    if (maxW &lt; image.naturalWidth) &#123;
      needCompress = true;
      ratio = image.naturalWidth / maxW;
      maxH = image.naturalHeight / ratio;
    &#125;
    if (maxH &lt; image.naturalHeight) &#123;
      needCompress = true;
      ratio = image.naturalHeight / maxH;
      maxW = image.naturalWidth / ratio;
    &#125;
    if (!needCompress) &#123;
      maxW = image.naturalWidth;
      maxH = image.naturalHeight;
    &#125;
    const canvas = document.createElement(&quot;canvas&quot;);
    canvas.setAttribute(&quot;id&quot;, &quot;__compress__&quot;);
    canvas.width = maxW;
    canvas.height = maxH;
    canvas.style.visibility = &quot;hidden&quot;;
    document.body.append(canvas);
    // canvas画布
    const ctx = canvas.getContext(&quot;2d&quot;);
    ctx.clearRect(0, 0, maxW, maxH);
    ctx.drawImage(image, 0, 0, maxW, maxH); // 渲染图片
    const compressImage = canvas.toDataURL(&quot;image/jpeg&quot;, 0.9); // 压缩图片
    cb(compressImage);
    const _image = new Image();
    _image.src = compressImage;
    document.body.appendChild(_image);
    canvas.remove(); // 移除 canvas
  &#125;);
  image.src = base64Image; // 将图片设置到 image 的 src 属性中
  document.body.appendChild(image);
&#125;
// 上传给服务端
function uploadImage(compressImage) &#123;
  console.log(&quot;upload image to server...&quot;, compressImage);
&#125;

const upload = document.getElementById(&quot;upload&quot;);
upload.addEventListener(&quot;change&quot;, function (e) &#123;
  const file = e.target.files[0];
  console.log(file);
  if (!file) &#123;
    return;
  &#125;
  const &#123; type: fileType, size: fileSize &#125; = file;
  // 图片类型检查
  if (!ACCEPT.includes(fileType)) &#123;
    alert(&quot;不支持上传该格式文件！&quot;);
    upload.value = &quot;&quot;;
    return;
  &#125;
  // 图片大小检查
  if (fileSize &gt; MAXSIZE) &#123;
    alert(&quot;文件超出&quot; + MAXSIZE_STR + &quot;！&quot;);
    upload.value = &quot;&quot;;
    return;
  &#125;
  // 压缩文件
  convertImageToBase64(file, (base64Image) =&gt;
    compress(base64Image, uploadImage)
  );
&#125;);
</code></pre>
</details></article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2020/04/20/echarts/" title="关于echarts官方的一个bug -- sublink跳转问题"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: 关于echarts官方的一个bug -- sublink跳转问题</span></a><a class="button is-default" href="/2019/08/22/hello-world/" title="Hexo"><span class="has-text-weight-semibold">下一页: Hexo</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/HeyJudeYQ"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> HeyJudeYQ 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>