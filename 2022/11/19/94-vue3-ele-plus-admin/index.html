<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>94、使用vue3+element-plus写后台管理系统：（四）</title><meta name="description" content="呦呦鹿鸣，食野之苹"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="包括后台项目 layout 基础架构、用户主动和被动退出、动态 menu 菜单、结构路由表、侧边菜单栏的收缩、组件状态驱动的动态 CSS 值


layout 基础架构布局
layout 基本布局结构包括：Menu 菜单栏、NavBar 顶部导航栏（包含个人信息）、Main（页面主要展示区域）
1、登录成功进入首页之后，整个首页也就是上面说的分为三个部分创建三个对应的组件

layout/components/Sidebar/index.vuelayout/components/Navbar.vuelayout/components/AppMain.vue

2、在layout/index引入创建的三个组件import Navbar from &amp;quot;./components/Navbar.vue&amp;qu.."><meta name="generator" content="Hexo 5.4.1"></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Jude's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">94、使用vue3+element-plus写后台管理系统：（四）</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E8%BF%9B%E5%85%A5%E9%A6%96%E9%A1%B5%E4%B9%8B%E5%90%8E%EF%BC%8C%E6%95%B4%E4%B8%AA%E9%A6%96%E9%A1%B5%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%B8%8A%E9%9D%A2%E8%AF%B4%E7%9A%84%E5%88%86%E4%B8%BA%E4%B8%89%E4%B8%AA%E9%83%A8%E5%88%86"><span class="toc-text">1、登录成功进入首页之后，整个首页也就是上面说的分为三个部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%9C%A8layout-index%E5%BC%95%E5%85%A5%E5%88%9B%E5%BB%BA%E7%9A%84%E4%B8%89%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="toc-text">2、在layout&#x2F;index引入创建的三个组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81layout-index%E5%AF%B9%E5%BA%94%E7%9A%84%E5%B8%83%E5%B1%80"><span class="toc-text">3、layout&#x2F;index对应的布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%9C%A8-styles-%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E5%AE%9A%E4%B9%89-3-%E4%B8%AA-scss-%E6%96%87%E4%BB%B6"><span class="toc-text">4、在 styles 文件夹下定义 3 个 scss 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E5%88%9B%E5%BB%BA%E7%9A%84%E4%B8%89%E4%B8%AA-scss-%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5%E5%88%B0-styles-index-scss"><span class="toc-text">5、创建的三个 scss 文件导入到 styles&#x2F;index.scss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E4%BE%A7%E8%BE%B9%E6%A0%8F%E8%A6%81%E5%AE%9E%E7%8E%B0%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2%E5%8A%9F%E8%83%BD%EF%BC%8Csidebar-%E8%B5%8B%E5%80%BC%E5%8A%A8%E6%80%81%E8%83%8C%E6%99%AF%E9%A2%9C%E8%89%B2"><span class="toc-text">6、侧边栏要实现主题更换功能，sidebar 赋值动态背景颜色</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81Navbar%E3%80%81Sidebar%E3%80%81AppMain-%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%A3%E7%A0%81%E5%8D%A0%E4%BD%8D%E5%8F%8A%E6%A0%B7%E5%BC%8F%E4%BF%AE%E6%94%B9"><span class="toc-text">7、Navbar、Sidebar、AppMain 组件初始化代码占位及样式修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E7%94%A8%E6%88%B7%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF"><span class="toc-text">8、用户个人信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81element-plus-%E7%9A%84-dropdown-avatar-%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E5%A4%B4%E5%83%8F%E4%BF%A1%E6%81%AF%E5%8F%8A%E7%94%A8%E6%88%B7%E4%B8%BB%E5%8A%A8%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="toc-text">9、element-plus 的 dropdown avatar 组件实现用户头像信息及用户主动退出功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E3%80%81%E4%B8%BB%E5%8A%A8%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD-%E5%9C%A8-store-moduels-user-js-%E4%B8%AD%EF%BC%8C%E6%B8%85%E9%99%A4%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE%E3%80%81%E6%B8%85%E9%99%A4%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E3%80%81%E8%BF%94%E5%9B%9E%E5%88%B0%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="toc-text">10、主动退出功能:在 store&#x2F;moduels&#x2F;user.js 中，清除当前用户缓存数据、清除用户权限相关配置、返回到登录页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11%E3%80%81%E8%A2%AB%E5%8A%A8%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD%EF%BC%9Atoken-%E8%BF%87%E6%9C%9F%E3%80%81%E5%8D%95%E4%B8%80%E8%B4%A6%E6%88%B7%E5%90%8C%E6%97%B6%E7%99%BB%E5%BD%95"><span class="toc-text">11、被动退出功能：token 过期、单一账户同时登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12%E3%80%81%E4%B8%B4%E6%97%B6menu%E8%8F%9C%E5%8D%95"><span class="toc-text">12、临时menu菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13%E3%80%81%E5%8A%A8%E6%80%81-menu-%E8%8F%9C%E5%8D%95%E5%A4%84%E7%90%86"><span class="toc-text">13、动态 menu 菜单处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14%E3%80%81%E5%88%9B%E5%BB%BA%E9%A1%B5%E9%9D%A2%E7%BB%84%E4%BB%B6"><span class="toc-text">14、创建页面组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15%E3%80%81%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E5%A4%84%E7%90%86"><span class="toc-text">15、用户权限处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16%E3%80%81%E8%A7%A3%E6%9E%90%E8%B7%AF%E7%94%B1%E8%A1%A8%EF%BC%8C%E8%8E%B7%E5%8F%96%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-text">16、解析路由表，获取结构化数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17%E3%80%81%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%97%AE%E9%A2%98"><span class="toc-text">17、处理数据结构问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18%E3%80%81SidebarMenu-%E8%B0%83%E7%94%A8-filterRouters%E3%80%81generateMenus-%E6%96%B9%E6%B3%95"><span class="toc-text">18、SidebarMenu 调用 filterRouters、generateMenus 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19%E3%80%81%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81-menu-%E8%8F%9C%E5%8D%95"><span class="toc-text">19、生成动态 menu 菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20%E3%80%81%E8%8F%9C%E5%8D%95%E7%9A%84%E4%BC%B8%E7%BC%A9%E5%8A%9F%E8%83%BD"><span class="toc-text">20、菜单的伸缩功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#21%E3%80%81%E5%88%9B%E5%BB%BA%E6%94%B6%E7%BC%A9-icon-%E7%BB%84%E4%BB%B6-hamburger"><span class="toc-text">21、创建收缩 icon 组件 hamburger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22%E3%80%81SidebarHeader-%E5%A4%84%E7%90%86"><span class="toc-text">22、SidebarHeader 处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23%E3%80%81%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%8A%A8%E6%80%81-CSS-%E5%80%BC"><span class="toc-text">23、组件状态驱动的动态 CSS 值</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/vue3"><i class="tag post-item-tag">vue3</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">94、使用vue3+element-plus写后台管理系统：（四）</h1><time class="has-text-grey" datetime="2022-11-19T12:00:00.000Z">2022-11-19</time><article class="mt-2 post-content"><p>包括后台项目 layout 基础架构、用户主动和被动退出、动态 menu 菜单、结构路由表、侧边菜单栏的收缩、组件状态驱动的动态 CSS 值</p>
<span id="more"></span>

<p>layout 基础架构布局</p>
<p>layout 基本布局结构包括：Menu 菜单栏、NavBar 顶部导航栏（包含个人信息）、Main（页面主要展示区域）</p>
<h4 id="1、登录成功进入首页之后，整个首页也就是上面说的分为三个部分"><a href="#1、登录成功进入首页之后，整个首页也就是上面说的分为三个部分" class="headerlink" title="1、登录成功进入首页之后，整个首页也就是上面说的分为三个部分"></a>1、登录成功进入首页之后，整个首页也就是上面说的分为三个部分</h4><p>创建三个对应的组件</p>
<blockquote>
<p>layout/components/Sidebar/index.vue<br>layout/components/Navbar.vue<br>layout/components/AppMain.vue</p>
</blockquote>
<h4 id="2、在layout-index引入创建的三个组件"><a href="#2、在layout-index引入创建的三个组件" class="headerlink" title="2、在layout/index引入创建的三个组件"></a>2、在<code>layout/index</code>引入创建的三个组件</h4><pre><code class="js">import Navbar from &quot;./components/Navbar.vue&quot;;
import Sidebar from &quot;./components/Sidebar/index.vue&quot;;
import AppMain from &quot;./components/AppMain&quot;;
</code></pre>
<h4 id="3、layout-index对应的布局"><a href="#3、layout-index对应的布局" class="headerlink" title="3、layout/index对应的布局"></a>3、<code>layout/index</code>对应的布局</h4><pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;app-wrapper&quot;&gt;
    &lt;!-- 左侧 menu --&gt;
    &lt;sidebar class=&quot;sidebar-container&quot; /&gt;
    &lt;div class=&quot;main-container&quot;&gt;
      &lt;div class=&quot;fixed-header&quot;&gt;
        &lt;!-- 顶部的 navbar --&gt;
        &lt;navbar /&gt;
      &lt;/div&gt;
      &lt;!-- 内容区 --&gt;
      &lt;app-main /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 id="4、在-styles-文件夹下定义-3-个-scss-文件"><a href="#4、在-styles-文件夹下定义-3-个-scss-文件" class="headerlink" title="4、在 styles 文件夹下定义 3 个 scss 文件"></a>4、在 styles 文件夹下定义 3 个 scss 文件</h4><blockquote>
<p>variables.scss 定义常量<br>mixin.scss 定义通用的 css<br>sidebar.scss 处理 menu 菜单的样式</p>
</blockquote>
<pre><code class="css">// variables.scss
// sidebar的样式  定义如下常量将其导出
$menuText: #bfcbd9;
$menuActiveText: #ffffff;
$subMenuActiveText: #f4f4f5;

$menuBg: #304156;
$menuHover: #263445;

$subMenuBg: #1f2d3d;
$subMenuHover: #001528;

$sideBarWidth: 210px;

// JS 与 scss 共享变量，在 scss 中通过 :export 进行导出，在 js 中可通过 ESM 进行导入
:export &#123;
  menuText: $menuText;
  menuActiveText: $menuActiveText;
  subMenuActiveText: $subMenuActiveText;
  menuBg: $menuBg;
  menuHover: $menuHover;
  subMenuBg: $subMenuBg;
  subMenuHover: $subMenuHover;
  sideBarWidth: $sideBarWidth;
&#125;
</code></pre>
<blockquote>
<p><code>注意</code>:这里是使用 :export{ } 方法将 css 常量导出</p>
</blockquote>
<p><code>mixin.scss</code></p>
<pre><code class="css">// mixin.scss
@mixin clearfix &#123;
  &amp;:after &#123;
    content: &quot;&quot;;
    display: table;
    clear: both;
  &#125;
&#125;

@mixin scrollBar &#123;
  &amp;::-webkit-scrollbar-track-piece &#123;
    background: #d3dce6;
  &#125;

  &amp;::-webkit-scrollbar &#123;
    width: 6px;
  &#125;

  &amp;::-webkit-scrollbar-thumb &#123;
    background: #99a9bf;
    border-radius: 20px;
  &#125;
&#125;

@mixin relative &#123;
  position: relative;
  width: 100%;
  height: 100%;
&#125;
</code></pre>
<p><code>sidebar.scss</code></p>
<details>
<summary>点我展示代码</summary>

<pre><code class="css">// sidebar.scss
#app &#123;
  .main-container &#123;
    min-height: 100%;
    transition: margin-left 0.28s;
    margin-left: $sideBarWidth;
    position: relative;
  &#125;

  .sidebar-container &#123;
    transition: width 0.28s;
    width: $sideBarWidth !important;
    height: 100%;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 1001;
    overflow: hidden;

    // 重置 element-plus 的css
    .horizontal-collapse-transition &#123;
      transition: 0s width ease-in-out, 0s padding-left ease-in-out,
        0s padding-right ease-in-out;
    &#125;

    .scrollbar-wrapper &#123;
      overflow-x: hidden !important;
    &#125;

    .el-scrollbar__bar.is-vertical &#123;
      right: 0px;
    &#125;

    .el-scrollbar &#123;
      height: 100%;
    &#125;

    &amp;.has-logo &#123;
      .el-scrollbar &#123;
        height: calc(100% - 50px);
      &#125;
    &#125;

    .is-horizontal &#123;
      display: none;
    &#125;

    a &#123;
      display: inline-block;
      width: 100%;
      overflow: hidden;
    &#125;

    .svg-icon &#123;
      margin-right: 16px;
    &#125;

    .sub-el-icon &#123;
      margin-right: 12px;
      margin-left: -2px;
    &#125;

    .el-menu &#123;
      border: none;
      height: 100%;
      width: 100% !important;
    &#125;

    .is-active &gt; .el-submenu__title &#123;
      color: $subMenuActiveText !important;
    &#125;

    &amp; .nest-menu .el-submenu &gt; .el-submenu__title,
    &amp; .el-submenu .el-menu-item &#123;
      min-width: $sideBarWidth !important;
    &#125;
  &#125;

  .hideSidebar &#123;
    .sidebar-container &#123;
      width: 54px !important;
    &#125;

    .main-container &#123;
      margin-left: 54px;
    &#125;

    .submenu-title-noDropdown &#123;
      padding: 0 !important;
      position: relative;

      .el-tooltip &#123;
        padding: 0 !important;

        .svg-icon &#123;
          margin-left: 20px;
        &#125;

        .sub-el-icon &#123;
          margin-left: 19px;
        &#125;
      &#125;
    &#125;

    .el-submenu &#123;
      overflow: hidden;

      &amp; &gt; .el-submenu__title &#123;
        padding: 0 !important;

        .svg-icon &#123;
          margin-left: 20px;
        &#125;

        .sub-el-icon &#123;
          margin-left: 19px;
        &#125;

        .el-submenu__icon-arrow &#123;
          display: none;
        &#125;
      &#125;
    &#125;

    .el-menu--collapse &#123;
      .el-submenu &#123;
        &amp; &gt; .el-submenu__title &#123;
          &amp; &gt; span &#123;
            height: 0;
            width: 0;
            overflow: hidden;
            visibility: hidden;
            display: inline-block;
          &#125;
        &#125;
      &#125;
    &#125;
  &#125;

  .el-menu--collapse .el-menu .el-submenu &#123;
    min-width: $sideBarWidth !important;
  &#125;

  .withoutAnimation &#123;
    .main-container,
    .sidebar-container &#123;
      transition: none;
    &#125;
  &#125;
&#125;

.el-menu--vertical &#123;
  &amp; &gt; .el-menu &#123;
    .svg-icon &#123;
      margin-right: 16px;
    &#125;
    .sub-el-icon &#123;
      margin-right: 12px;
      margin-left: -2px;
    &#125;
  &#125;

  // 菜单项过长时

  &gt; .el-menu--popup &#123;
    max-height: 100vh;
    overflow-y: auto;

    &amp;::-webkit-scrollbar-track-piece &#123;
      background: #d3dce6;
    &#125;

    &amp;::-webkit-scrollbar &#123;
      width: 6px;
    &#125;

    &amp;::-webkit-scrollbar-thumb &#123;
      background: #99a9bf;
      border-radius: 20px;
    &#125;
  &#125;
&#125;
</code></pre>
</details>

<h4 id="5、创建的三个-scss-文件导入到-styles-index-scss"><a href="#5、创建的三个-scss-文件导入到-styles-index-scss" class="headerlink" title="5、创建的三个 scss 文件导入到 styles/index.scss"></a>5、创建的三个 scss 文件导入到 styles/index.scss</h4><pre><code class="css">// index.scss
@import &quot;./variables.scss&quot;;
@import &quot;./mixin.scss&quot;;
@import &quot;./sidebar.scss&quot;;
</code></pre>
<p><code>layout/index.vue</code>写入样式</p>
<pre><code class="css">&lt;style lang=&quot;scss&quot; scoped&gt;
@import &#39;@/styles/mixin.scss&#39;;
@import &#39;@/styles/variables.scss&#39;;

.app-wrapper &#123;
  @include clearfix;
  position: relative;
  height: 100%;
  width: 100%;
&#125;

.fixed-header &#123;
  position: fixed;
  top: 0;
  right: 0;
  z-index: 9;
  width: calc(100% - #&#123;$sideBarWidth&#125;);
&#125;
&lt;/style&gt;
</code></pre>
<h4 id="6、侧边栏要实现主题更换功能，sidebar-赋值动态背景颜色"><a href="#6、侧边栏要实现主题更换功能，sidebar-赋值动态背景颜色" class="headerlink" title="6、侧边栏要实现主题更换功能，sidebar 赋值动态背景颜色"></a>6、<code>侧边栏</code>要实现<code>主题更换</code>功能，sidebar 赋值动态背景颜色</h4><pre><code class="html">&lt;template&gt;
  ...
  &lt;!-- 左侧 menu --&gt;
  &lt;sidebar
    class=&quot;sidebar-container&quot;
    :style=&quot;&#123; backgroundColor: variables.menuBg &#125;&quot;
  /&gt;
  ...
&lt;/template&gt;

&lt;script setup&gt;
  import variables from &quot;@/styles/variables.scss&quot;;
&lt;/script&gt;
</code></pre>
<h4 id="7、Navbar、Sidebar、AppMain-组件初始化代码占位及样式修改"><a href="#7、Navbar、Sidebar、AppMain-组件初始化代码占位及样式修改" class="headerlink" title="7、Navbar、Sidebar、AppMain 组件初始化代码占位及样式修改"></a>7、Navbar、Sidebar、AppMain 组件初始化代码占位及样式修改</h4><p>需要处理 AppMain 组件和 Navbar 组件重叠问题</p>
<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;app-main&quot;&gt;AppMain&lt;/div&gt;
&lt;/template&gt;
&lt;style lang=&quot;scss&quot; scoped&gt;
  .app-main &#123;
    min-height: calc(100vh - 50px);
    width: 100%;
    position: relative;
    overflow: hidden;
    padding: 61px 20px 20px 20px;
    box-sizing: border-box;
  &#125;
&lt;/style&gt;
</code></pre>
<h4 id="8、用户个人信息"><a href="#8、用户个人信息" class="headerlink" title="8、用户个人信息"></a>8、用户个人信息</h4><p>这里需要处理一下用户个人信息展示</p>
<p><code>api/sys.js</code>文件定义方法、axios 请求拦截器对 token 进行 header 注入</p>
<pre><code class="js">/**
 * 获取用户信息
 */
export const getUserInfo = () =&gt; &#123;
  return request(&#123;
    url: &quot;/sys/profile&quot;,
  &#125;);
&#125;;

// utils/request.js
import store from &quot;@/store&quot;;
// 请求拦截器
service.interceptors.request.use(
  (config) =&gt; &#123;
    // 在这个位置需要统一的去注入token
    if (store.getters.token) &#123;
      // 如果token存在 注入token
      config.headers.Authorization = `Bearer $&#123;store.getters.token&#125;`;
    &#125;
    return config; // 必须返回配置
  &#125;,
  (error) =&gt; &#123;
    return Promise.reject(error);
  &#125;
);
</code></pre>
<p>定义调用接口的动作<code>store/modules/user.js</code></p>
<pre><code class="js">import &#123; login, getUserInfo &#125; from &#39;@/api/sys&#39;
...
export default &#123;
  namespaced: true,
  state: () =&gt; (&#123;
    ...
    userInfo: &#123;&#125;
  &#125;),
  mutations: &#123;
    ...
    setUserInfo(state, userInfo) &#123;
      state.userInfo = userInfo
    &#125;
  &#125;,
  actions: &#123;
    ...
    async getUserInfo(context) &#123;
      const res = await getUserInfo()
      this.commit(&#39;user/setUserInfo&#39;, res)
      return res
    &#125;
  &#125;
&#125;
</code></pre>
<p>在权限拦截时触发的动作<code>permission.js</code></p>
<pre><code class="js">    if (to.path === &#39;/login&#39;) &#123;
      ...
    &#125; else &#123;
      // 判断用户资料是否获取
      // 若不存在用户信息，则需要获取用户信息
      if (!store.getters.hasUserInfo) &#123;
        // 触发获取用户信息的 action
        await store.dispatch(&#39;user/getUserInfo&#39;)
      &#125;
      next()
    &#125;
  &#125;
</code></pre>
<p>写入判断用户信息<code>store/getters.js</code></p>
<pre><code class="js">const getters = &#123;
  ...
  userInfo: state =&gt; state.user.userInfo,
  /**
   * @returns true 表示已存在用户信息
   */
  hasUserInfo: state =&gt; &#123;
    return JSON.stringify(state.user.userInfo) !== &#39;&#123;&#125;&#39;
  &#125;
&#125;
</code></pre>
<h4 id="9、element-plus-的-dropdown-avatar-组件实现用户头像信息及用户主动退出功能"><a href="#9、element-plus-的-dropdown-avatar-组件实现用户头像信息及用户主动退出功能" class="headerlink" title="9、element-plus 的 dropdown avatar 组件实现用户头像信息及用户主动退出功能"></a>9、element-plus 的 dropdown avatar 组件实现用户头像信息及用户主动退出功能</h4><p><code>用户头像功能及下拉菜单栏</code></p>
<details>
<summary>点我展示代码</summary>

<pre><code class="html">// layout/components/navbar.vue
&lt;template&gt;
  &lt;div class=&quot;navbar&quot;&gt;
    &lt;div class=&quot;right-menu&quot;&gt;
      &lt;!-- 头像 --&gt;
      &lt;el-dropdown class=&quot;avatar-container&quot; trigger=&quot;click&quot;&gt;
        &lt;div class=&quot;avatar-wrapper&quot;&gt;
          &lt;el-avatar
            shape=&quot;square&quot;
            :size=&quot;40&quot;
            :src=&quot;$store.getters.userInfo.avatar&quot;
          &gt;&lt;/el-avatar&gt;
        &lt;/div&gt;
        &lt;template #dropdown&gt;
          &lt;el-dropdown-menu class=&quot;user-dropdown&quot;&gt;
            &lt;router-link to=&quot;/&quot;&gt;
              &lt;el-dropdown-item&gt; 首页 &lt;/el-dropdown-item&gt;
            &lt;/router-link&gt;
            &lt;el-dropdown-item divided&gt; 退出登录 &lt;/el-dropdown-item&gt;
          &lt;/el-dropdown-menu&gt;
        &lt;/template&gt;
      &lt;/el-dropdown&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
  import &#123;&#125; from &quot;vue&quot;;
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
  .navbar &#123;
    height: 50px;
    overflow: hidden;
    position: relative;
    background: #fff;
    box-shadow: 0 1px 4px rgba(0, 21, 41, 0.08);

    .right-menu &#123;
      display: flex;
      align-items: center;
      float: right;
      padding-right: 16px;

      ::v-deep .avatar-container &#123;
        cursor: pointer;
        .avatar-wrapper &#123;
          margin-top: 5px;
          position: relative;
          n .el-avatar &#123;
            --el-avatar-background-color: none;
            margin-right: 12px;
          &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&lt;/style&gt;
</code></pre>
</details>

<h4 id="10、主动退出功能-在-store-moduels-user-js-中，清除当前用户缓存数据、清除用户权限相关配置、返回到登录页"><a href="#10、主动退出功能-在-store-moduels-user-js-中，清除当前用户缓存数据、清除用户权限相关配置、返回到登录页" class="headerlink" title="10、主动退出功能:在 store/moduels/user.js 中，清除当前用户缓存数据、清除用户权限相关配置、返回到登录页"></a>10、<code>主动退出功能</code>:在 store/moduels/user.js 中，清除当前用户缓存数据、清除用户权限相关配置、返回到登录页</h4><pre><code class="js">import router from &#39;@/router&#39;

logout() &#123;
    this.commit(&#39;user/setToken&#39;, &#39;&#39;)
    this.commit(&#39;user/setUserInfo&#39;, &#123;&#125;)
    removeAllItem()
    router.push(&#39;/login&#39;)
&#125;
</code></pre>
<p>退出按钮点击事件，触发 logout 的 action</p>
<pre><code class="js">import &#123; useStore &#125; from &quot;vuex&quot;;

const store = useStore();
const logout = () =&gt; &#123;
  store.dispatch(&quot;user/logout&quot;);
&#125;;
</code></pre>
<h4 id="11、被动退出功能：token-过期、单一账户同时登录"><a href="#11、被动退出功能：token-过期、单一账户同时登录" class="headerlink" title="11、被动退出功能：token 过期、单一账户同时登录"></a>11、<code>被动退出功能</code>：token 过期、单一账户同时登录</h4><p>token 表示一个用户的身份令牌，对服务端而言，只认令牌不认人，所以说一旦其他人获取了你的 token，那么可以伪装成你，来获取对应的敏感数据。</p>
<p>为了保证用户的信息安全，那么对于 token 而言就被制定了很多安全策略。<br>token 的安全策略：动态 token、刷新 token、失效 token</p>
<p>选择时效 token：服务端处理 token 时效的同时，在前端主动介入 token 时效的处理中，从而保证用户信息的安全性。</p>
<p>实现方案：</p>
<blockquote>
<p>1、在用户登录时，记录当前登录时间<br>2、制定失效时长<br>3、接口调用时，根据当前时间对比登录时间，看是否超过了时效时长。如果未超过，则正常进行后续操作；如果超过，则进行退出登录操作</p>
</blockquote>
<pre><code class="js">// utils/auth.js
import &#123; TIME_STAMP, TOKEN_TIMEOUT_VALUE &#125; from &quot;@/constant&quot;;
import &#123; setItem, getItem &#125; from &quot;@/utils/storage&quot;;
/**
 * 获取时间戳
 */
export function getTimeStamp() &#123;
  return getItem(TIME_STAMP);
&#125;
/**
 * 设置时间戳
 */
export function setTimeStamp() &#123;
  setItem(TIME_STAMP, Date.now());
&#125;
/**
 * 是否超时
 */
export function isCheckTimeout() &#123;
  // 当前时间戳
  var currentTime = Date.now();
  // 缓存时间戳
  var timeStamp = getTimeStamp();
  return currentTime - timeStamp &gt; TOKEN_TIMEOUT_VALUE;
&#125;

// token时间戳
export const TIME_STAMP = &quot;timeStamp&quot;;
// 超时时长(毫秒) 两小时
export const TOKEN_TIMEOUT_VALUE = 2 * 3600 * 1000;
</code></pre>
<p>用户登录成功之后设置时间，到 store/user.js 的 login 中：</p>
<pre><code class="js">import &#123; setTimeStamp &#125; from &#39;@/utils/auth&#39;

login(context, userInfo) &#123;
      ...
      return new Promise((resolve, reject) =&gt; &#123;
        ...
          .then(data =&gt; &#123;
            ...
            // 保存登录时间
            setTimeStamp()
            resolve()
          &#125;)
      &#125;)
    &#125;,
</code></pre>
<p>在<code>utils/request</code>对应的请求拦截器中进行主动介入</p>
<pre><code class="js">import &#123; isCheckTimeout &#125; from &#39;@/utils/auth&#39;

if (store.getters.token) &#123;
      if (isCheckTimeout()) &#123;
        // 登出操作
        store.dispatch(&#39;user/logout&#39;)
        return Promise.reject(new Error(&#39;token 失效&#39;))
      &#125;
      ...
    &#125;

// 响应拦截器
service.interceptors.response.use(
  response =&gt; &#123;
    ...
  &#125;,
  error =&gt; &#123;
    // 处理 token 超时问题
    if (
      error.response &amp;&amp;
      error.response.data &amp;&amp;
      error.response.data.code === 401
    ) &#123;
      // token超时
      store.dispatch(&#39;user/logout&#39;)
    &#125;
    ElMessage.error(error.message) // 提示错误信息
    return Promise.reject(error)
  &#125;
)
</code></pre>
<h4 id="12、临时menu菜单"><a href="#12、临时menu菜单" class="headerlink" title="12、临时menu菜单"></a>12、<code>临时menu菜单</code></h4><p>layout/Sidebar/SidebarMenu.vue</p>
<pre><code class="html">&lt;template&gt;
  &lt;!-- 一级 menu 菜单 --&gt;
  &lt;el-menu
    :uniqueOpened=&quot;true&quot;
    default-active=&quot;2&quot;
    background-color=&quot;#545c64&quot;
    text-color=&quot;#fff&quot;
    active-text-color=&quot;#ffd04b&quot;
  &gt;
    &lt;!-- 子集 menu 菜单 --&gt;
    &lt;el-submenu index=&quot;1&quot;&gt;
      &lt;template #title&gt;
        &lt;i class=&quot;el-icon-location&quot;&gt;&lt;/i&gt;
        &lt;span&gt;导航一&lt;/span&gt;
      &lt;/template&gt;
      &lt;el-menu-item index=&quot;1-1&quot;&gt;选项1&lt;/el-menu-item&gt;
      &lt;el-menu-item index=&quot;1-2&quot;&gt;选项2&lt;/el-menu-item&gt;
    &lt;/el-submenu&gt;
    &lt;!-- 具体菜单项 --&gt;
    &lt;el-menu-item index=&quot;4&quot;&gt;
      &lt;i class=&quot;el-icon-setting&quot;&gt;&lt;/i&gt;
      &lt;template #title&gt;导航四&lt;/template&gt;
    &lt;/el-menu-item&gt;
  &lt;/el-menu&gt;
&lt;/template&gt;
</code></pre>
<p>layout/Sidebar/index 导入该组件</p>
<pre><code class="js">&lt;template&gt;
  &lt;div class=&quot;&quot;&gt;
    &lt;h1&gt;Admin&lt;/h1&gt;
    &lt;el-scrollbar&gt;
      &lt;sidebar-menu&gt;&lt;/sidebar-menu&gt;
    &lt;/el-scrollbar&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import SidebarMenu from &#39;./SidebarMenu&#39;
import &#123;&#125; from &#39;vue&#39;
&lt;/script&gt;
</code></pre>
<p>生成一个临时的 menu 菜单，从这个临时的 menu 菜单可以看出，el-menu 分为三部分：</p>
<blockquote>
<p><code>el-menu</code>：整个 menu 菜单<br><code>el-sub-menu</code>:子集 menu 菜单<br><code>el-menu-item</code>:具体菜单项</p>
</blockquote>
<h4 id="13、动态-menu-菜单处理"><a href="#13、动态-menu-菜单处理" class="headerlink" title="13、动态 menu 菜单处理"></a>13、动态 menu 菜单处理</h4><blockquote>
<p>动态 menu 菜单主要和动态路由表配合来实现用户权限的（后续需要完成用户权限）。动态 menu 菜单指的是：根据路由表的配置，自动生成对应的 menu 菜单，当路由表发生变化时，menu 菜单自动发生变化。</p>
</blockquote>
<p>实现步骤：</p>
<blockquote>
<p>1、定义路由表对应的 menu 菜单规则（核心步骤）<br>2、根据规则制定路由表<br>3、根据规则，一路路由表生成 menu 菜单</p>
</blockquote>
<p>上面步骤 1 的菜单规则制定：</p>
<blockquote>
<p>1、如果<code>meta &amp;&amp; meta.title &amp;&amp; meta.icon</code> ：则显示在 <code>menu</code> 菜单中，其中 <code>title</code> 为显示的内容，<code>icon</code> 为显示的图标。如果存在 children：则展示子菜单 el-sub-menu；否则展示 el-menu-item。<br>2、不显示在 menu 中</p>
</blockquote>
<h4 id="14、创建页面组件"><a href="#14、创建页面组件" class="headerlink" title="14、创建页面组件"></a>14、<code>创建页面组件</code></h4><p>views 文件夹下创建页面：<br>（1）、创建文章:article-create<br>（2）、文章详情:article-detail<br>（3）、文章列表:article-ranking<br>（4）、401 和 404 页面:error-page/401.vue 404.vue<br>（5）、导入:import<br>（6）、权限列表:permission-list<br>（7）、个人中心:profile<br>（8）、角色列表:role-list<br>（9）、用户信息:user-info<br>（10）、用户管理:user-manage</p>
<h4 id="15、用户权限处理"><a href="#15、用户权限处理" class="headerlink" title="15、用户权限处理"></a>15、用户权限处理</h4><p>需要先对路由表进行划分：私有路由表 privateRoutes(权限路由)、公有路由表 publicRoutes(非权限路由)</p>
<p><code>router/index.js</code></p>
<details>
<summary>显示详细代码</summary>

<pre><code class="js">// 私有路由表
const privateRoutes = [
  &#123;
    path: &quot;/user&quot;,
    component: layout,
    redirect: &quot;/user/manage&quot;,
    meta: &#123;
      title: &quot;user&quot;,
      icon: &quot;personnel&quot;,
    &#125;,
    children: [
      &#123;
        path: &quot;/user/manage&quot;,
        component: () =&gt; import(&quot;@/views/user-manage/index&quot;),
        meta: &#123;
          title: &quot;userManage&quot;,
          icon: &quot;personnel-manage&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/user/role&quot;,
        component: () =&gt; import(&quot;@/views/role-list/index&quot;),
        meta: &#123;
          title: &quot;roleList&quot;,
          icon: &quot;role&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/user/permission&quot;,
        component: () =&gt; import(&quot;@/views/permission-list/index&quot;),
        meta: &#123;
          title: &quot;permissionList&quot;,
          icon: &quot;permission&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/user/info/:id&quot;,
        name: &quot;userInfo&quot;,
        component: () =&gt; import(&quot;@/views/user-info/index&quot;),
        meta: &#123;
          title: &quot;userInfo&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/user/import&quot;,
        name: &quot;import&quot;,
        component: () =&gt; import(&quot;@/views/import/index&quot;),
        meta: &#123;
          title: &quot;excelImport&quot;,
        &#125;,
      &#125;,
    ],
  &#125;,
  &#123;
    path: &quot;/article&quot;,
    component: layout,
    redirect: &quot;/article/ranking&quot;,
    meta: &#123;
      title: &quot;article&quot;,
      icon: &quot;article&quot;,
    &#125;,
    children: [
      &#123;
        path: &quot;/article/ranking&quot;,
        component: () =&gt; import(&quot;@/views/article-ranking/index&quot;),
        meta: &#123;
          title: &quot;articleRanking&quot;,
          icon: &quot;article-ranking&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/article/:id&quot;,
        component: () =&gt; import(&quot;@/views/article-detail/index&quot;),
        meta: &#123;
          title: &quot;articleDetail&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/article/create&quot;,
        component: () =&gt; import(&quot;@/views/article-create/index&quot;),
        meta: &#123;
          title: &quot;articleCreate&quot;,
          icon: &quot;article-create&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/article/editor/:id&quot;,
        component: () =&gt; import(&quot;@/views/article-create/index&quot;),
        meta: &#123;
          title: &quot;articleEditor&quot;,
        &#125;,
      &#125;,
    ],
  &#125;,
];
// 公开路由表
const publicRoutes = [
  &#123;
    path: &quot;/login&quot;,
    component: () =&gt; import(&quot;@/views/login/index&quot;),
  &#125;,
  &#123;
    path: &quot;/&quot;,
    // 注意：带有路径“/”的记录中的组件“默认”是一个不返回 Promise 的函数
    component: layout,
    redirect: &quot;/profile&quot;,
    children: [
      &#123;
        path: &quot;/profile&quot;,
        name: &quot;profile&quot;,
        component: () =&gt; import(&quot;@/views/profile/index&quot;),
        meta: &#123;
          title: &quot;profile&quot;,
          icon: &quot;el-icon-user&quot;,
        &#125;,
      &#125;,
      &#123;
        path: &quot;/404&quot;,
        name: &quot;404&quot;,
        component: () =&gt; import(&quot;@/views/error-page/404&quot;),
      &#125;,
      &#123;
        path: &quot;/401&quot;,
        name: &quot;401&quot;,
        component: () =&gt; import(&quot;@/views/error-page/401&quot;),
      &#125;,
    ],
  &#125;,
];

const router = createRouter(&#123;
  history: createWebHashHistory(),
  routes: [...publicRoutes, ...privateRoutes],
&#125;);
</code></pre>
</details>

<blockquote>
<p>注意：要在 <code>layout/AppMain.vue 中设置路由出口</code></p>
</blockquote>
<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;app-main&quot;&gt;
    &lt;router-view&gt;&lt;/router-view&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 id="16、解析路由表，获取结构化数据"><a href="#16、解析路由表，获取结构化数据" class="headerlink" title="16、解析路由表，获取结构化数据"></a>16、解析路由表，获取结构化数据</h4><p>数据结构为</p>
<details>
<summary>显示详细代码</summary>

<pre><code class="json">[
  &#123;
    &quot;title&quot;: &quot;个人中心&quot;,
    &quot;path&quot;: &quot;&quot;
  &#125;,
  &#123;
    &quot;title&quot;: &quot;用户&quot;,
    &quot;children&quot;: [
      &#123;
        &quot;title&quot;: &quot;员工管理&quot;,
        &quot;path&quot;: &quot;&quot;
      &#125;,
      &#123;
        &quot;title&quot;: &quot;角色列表&quot;,
        &quot;path&quot;: &quot;&quot;
      &#125;,
      &#123;
        &quot;title&quot;: &quot;权限列表&quot;,
        &quot;path&quot;: &quot;&quot;
      &#125;
    ]
  &#125;,
  &#123;
    &quot;title&quot;: &quot;文章&quot;,
    &quot;children&quot;: [
      &#123;
        &quot;title&quot;: &quot;文章排名&quot;,
        &quot;path&quot;: &quot;&quot;
      &#125;,
      &#123;
        &quot;title&quot;: &quot;创建文章&quot;,
        &quot;path&quot;: &quot;&quot;
      &#125;
    ]
  &#125;
]
</code></pre>
</details>

<p>获取路由表数据的 2 中方式：</p>
<blockquote>
<p>1、router.options.routes:初始路由列表<br>2、router.getRoutes()：获取所有路由记录的完整列表（选择此种方法）</p>
</blockquote>
<p>在 layout/components/Sidebar/SidebarMenu 中</p>
<pre><code class="js">&lt;script setup&gt;
  import &#123;useRouter&#125; from &#39;vue-router&#39; const router = useRouter()
  console.log(router.getRoutes()) // 这里返回的是一个完整的路由表
&lt;/script&gt;
</code></pre>
<p>打印的结果是一个完整的路由表，里面存在一些问题：</p>
<blockquote>
<p>存在重复的路由数据<br>不满足该条件 meta &amp;&amp; meta.title &amp;&amp; meta.icon 的数据不应该存在</p>
</blockquote>
<h4 id="17、处理数据结构问题"><a href="#17、处理数据结构问题" class="headerlink" title="17、处理数据结构问题"></a>17、处理数据结构问题</h4><p>创建<code>utils/route.js</code>，里面 2 个函数方法：filterRouters()/generateMenus()很重要</p>
<details>
<summary>显示完整代码</summary>

<pre><code class="js">import path from &quot;path&quot;;

/**
 * 返回所有子路由
 */
const getChildrenRoutes = (routes) =&gt; &#123;
  const result = [];
  routes.forEach((route) =&gt; &#123;
    if (route.children &amp;&amp; route.children.length &gt; 0) &#123;
      result.push(...route.children);
    &#125;
  &#125;);
  return result;
&#125;;
/**
 * 处理脱离层级的路由：某个一级路由为其他子路由，则剔除该一级路由，保留路由层级
 * @param &#123;*&#125; routes router.getRoutes()
 */
export const filterRouters = (routes) =&gt; &#123;
  const childrenRoutes = getChildrenRoutes(routes);
  return routes.filter((route) =&gt; &#123;
    return !childrenRoutes.find((childrenRoute) =&gt; &#123;
      return childrenRoute.path === route.path;
    &#125;);
  &#125;);
&#125;;

/**
 * 判断数据是否为空值
 */
function isNull(data) &#123;
  if (!data) return true;
  if (JSON.stringify(data) === &quot;&#123;&#125;&quot;) return true;
  if (JSON.stringify(data) === &quot;[]&quot;) return true;
  return false;
&#125;
/**
 * 根据 routes 数据，返回对应 menu 规则数组
 */
export function generateMenus(routes, basePath = &quot;&quot;) &#123;
  const result = [];
  // 遍历路由表
  routes.forEach((item) =&gt; &#123;
    // 不存在 children &amp;&amp; 不存在 meta 直接 return
    if (isNull(item.meta) &amp;&amp; isNull(item.children)) return;
    // 存在 children 不存在 meta，进入迭代
    if (isNull(item.meta) &amp;&amp; !isNull(item.children)) &#123;
      result.push(...generateMenus(item.children));
      return;
    &#125;
    // 合并 path 作为跳转路径
    const routePath = path.resolve(basePath, item.path);
    // 路由分离之后，存在同名父路由的情况，需要单独处理
    let route = result.find((item) =&gt; item.path === routePath);
    if (!route) &#123;
      route = &#123;
        ...item,
        path: routePath,
        children: [],
      &#125;;

      // icon 与 title 必须全部存在
      if (route.meta.icon &amp;&amp; route.meta.title) &#123;
        // meta 存在生成 route 对象，放入 arr
        result.push(route);
      &#125;
    &#125;

    // 存在 children 进入迭代到children
    if (item.children) &#123;
      route.children.push(...generateMenus(item.children, route.path));
    &#125;
  &#125;);
  return result;
&#125;
</code></pre>
</details>

<h4 id="18、SidebarMenu-调用-filterRouters、generateMenus-方法"><a href="#18、SidebarMenu-调用-filterRouters、generateMenus-方法" class="headerlink" title="18、SidebarMenu 调用 filterRouters、generateMenus 方法"></a>18、SidebarMenu 调用 filterRouters、generateMenus 方法</h4><pre><code class="js">&lt;script setup&gt;
import &#123; computed &#125; from &#39;vue&#39;
import &#123; useRouter &#125; from &#39;vue-router&#39;
import &#123; filterRouters, generateMenus &#125; from &#39;@/utils/route&#39;

const router = useRouter()
const routes = computed(() =&gt; &#123;
  const filterRoutes = filterRouters(router.getRoutes())
  return generateMenus(filterRoutes)
&#125;)
console.log(JSON.stringify(routes.value))
&lt;/script&gt;
</code></pre>
<h4 id="19、生成动态-menu-菜单"><a href="#19、生成动态-menu-菜单" class="headerlink" title="19、生成动态 menu 菜单"></a>19、生成动态 menu 菜单</h4><p>整个 menu 菜单，分为 3 个组件来进行处理</p>
<blockquote>
<p>1、SidebarMenu:处理数据，作为最顶层 menu 载体</p>
</blockquote>
<pre><code class="html">&lt;template&gt;
  &lt;!-- 一级 menu 菜单 --&gt;
  &lt;el-menu ...&gt;
    &lt;sidebar-item
      v-for=&quot;item in routes&quot;
      :key=&quot;item.path&quot;
      :route=&quot;item&quot;
    &gt;&lt;/sidebar-item&gt;
  &lt;/el-menu&gt;
&lt;/template&gt;
</code></pre>
<blockquote>
<p>2、SidebarItem：根据数据处理当前项为 el-sub-menu || el-menu-item</p>
</blockquote>
<pre><code class="html">&lt;template&gt;
  &lt;!-- 支持渲染多级 menu 菜单 --&gt;
  &lt;el-submenu v-if=&quot;route.children.length &gt; 0&quot; :index=&quot;route.path&quot;&gt;
    &lt;template #title&gt;
      &lt;menu-item :title=&quot;route.meta.title&quot; :icon=&quot;route.meta.icon&quot;&gt;&lt;/menu-item&gt;
    &lt;/template&gt;
    &lt;!-- 循环渲染 --&gt;
    &lt;sidebar-item
      v-for=&quot;item in route.children&quot;
      :key=&quot;item.path&quot;
      :route=&quot;item&quot;
    &gt;&lt;/sidebar-item&gt;
  &lt;/el-submenu&gt;
  &lt;!-- 渲染 item 项 --&gt;
  &lt;el-menu-item v-else :index=&quot;route.path&quot;&gt;
    &lt;menu-item :title=&quot;route.meta.title&quot; :icon=&quot;route.meta.icon&quot;&gt;&lt;/menu-item&gt;
  &lt;/el-menu-item&gt;
&lt;/template&gt;

&lt;script setup&gt;
  import MenuItem from &quot;./MenuItem&quot;;
  import &#123; defineProps &#125; from &quot;vue&quot;;
  // 定义 props
  defineProps(&#123;
    route: &#123;
      type: Object,
      required: true,
    &#125;,
  &#125;);
&lt;/script&gt;
</code></pre>
<blockquote>
<p>3、MenuItem:处理 el-menu-item 样式</p>
</blockquote>
<pre><code class="html">&lt;template&gt;
  &lt;i v-if=&quot;icon.includes(&#39;el-icon&#39;)&quot; class=&quot;sub-el-icon&quot; :class=&quot;icon&quot;&gt;&lt;/i&gt;
  &lt;svg-icon v-else :icon=&quot;icon&quot;&gt;&lt;/svg-icon&gt;
  &lt;span&gt;&#123;&#123; title &#125;&#125;&lt;/span&gt;
&lt;/template&gt;

&lt;script setup&gt;
  import &#123; defineProps &#125; from &quot;vue&quot;;
  defineProps(&#123;
    title: &#123;
      type: String,
      required: true,
    &#125;,
    icon: &#123;
      type: String,
      required: true,
    &#125;,
  &#125;);
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;
</code></pre>
<p>menu 菜单完成，还需解决样式问题、菜单路由跳转问题、默认激活项</p>
<p><code>样式修改</code>：store/getters 创建快捷访问（后续加入主题更换功能，样式不能写死）</p>
<pre><code class="js">import variables from &#39;@/styles/variables.scss&#39;
const getters = &#123;
  ...
  cssVar: state =&gt; variables
&#125;
export default getters
</code></pre>
<p><code>SidebarMenu</code>写入样式（el-menu 里的 router 是指定路由跳转， activeMenu 为默认激活项）</p>
<pre><code class="html">// template
&lt;el-menu
  :background-color=&quot;$store.getters.cssVar.menuBg&quot;
  :text-color=&quot;$store.getters.cssVar.menuText&quot;
  :active-text-color=&quot;$store.getters.cssVar.menuActiveText&quot;
  :default-active=&quot;activeMenu&quot;
  :unique-opened=&quot;true&quot;
  router
&gt;&lt;/el-menu&gt;

// js
&lt;script setup&gt;
  ...

  // 计算高亮 menu 的方法
  const route = useRoute()
  const activeMenu = computed(() =&gt; &#123;
    const &#123; path &#125; = route
    return path
  &#125;)
&lt;/script&gt;
</code></pre>
<h4 id="20、菜单的伸缩功能"><a href="#20、菜单的伸缩功能" class="headerlink" title="20、菜单的伸缩功能"></a>20、菜单的伸缩功能</h4><p>创建<code>store/modules/app.js</code></p>
<pre><code class="js">export default &#123;
  namespaced: true,
  state: () =&gt; (&#123;
    sidebarOpened: true,
  &#125;),
  mutations: &#123;
    triggerSidebarOpened(state) &#123;
      state.sidebarOpened = !state.sidebarOpened;
    &#125;,
  &#125;,
  actions: &#123;&#125;,
&#125;;
</code></pre>
<p>在<code>store/index.js</code>中引入上面的 app.js</p>
<pre><code class="js">import app from &quot;./modules/app&quot;;
export default createStore(&#123;
  getters,
  modules: &#123;
    user,
    app,
  &#125;,
&#125;);
</code></pre>
<p>在 <code>store/getters</code> 中创建快捷访问</p>
<pre><code class="js">sidebarOpened: (state) =&gt; state.app.sidebarOpened;
</code></pre>
<h4 id="21、创建收缩-icon-组件-hamburger"><a href="#21、创建收缩-icon-组件-hamburger" class="headerlink" title="21、创建收缩 icon 组件 hamburger"></a>21、创建收缩 icon 组件 hamburger</h4><p>创建<code>src/components/Hamburger/index.vue</code></p>
<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;hamburger-container&quot; @click=&quot;toggleClick&quot;&gt;
    &lt;svg-icon class=&quot;hamburger&quot; :icon=&quot;icon&quot;&gt;&lt;/svg-icon&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
  import &#123; computed &#125; from &quot;vue&quot;;
  import &#123; useStore &#125; from &quot;vuex&quot;;

  const store = useStore();
  const toggleClick = () =&gt; &#123;
    store.commit(&quot;app/triggerSidebarOpened&quot;);
  &#125;;

  const icon = computed(() =&gt;
    store.getters.sidebarOpened ? &quot;hamburger-opened&quot; : &quot;hamburger-closed&quot;
  );
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
  .hamburger-container &#123;
    padding: 0 16px;
    .hamburger &#123;
      display: inline-block;
      vertical-align: middle;
      width: 20px;
      height: 20px;
    &#125;
  &#125;
&lt;/style&gt;
</code></pre>
<p>在<code>layout/components/Navbar.vue</code>中使用 Hamburger 组件</p>
<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;navbar&quot;&gt;
    &lt;hamburger class=&quot;hamburger-container&quot; /&gt;
    ...
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
  import Hamburger from &#39;@/components/Hamburger&#39;
  ...
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
  .navbar &#123;
    ...

    .hamburger-container &#123;
      line-height: 46px;
      height: 100%;
      float: left;
      cursor: pointer;
      // hover 动画
      transition: background 0.5s;

      &amp;:hover &#123;
        background: rgba(0, 0, 0, 0.1);
      &#125;
    &#125;

   ...
  &#125;
&lt;/style&gt;
</code></pre>
<p>在<code>layout/components/Sidebar/SidebarMenu.vue</code>中添加控制 el-menu 的<code>collapse</code>属性</p>
<pre><code class="html">&lt;el-menu
    :collapse=&quot;!$store.getters.sidebarOpened&quot;
    ...
</code></pre>
<p>在<code>layout/index.vue</code>中指定侧边栏的宽度和缩放动画</p>
<pre><code class="html">&lt;div
  class=&quot;app-wrapper&quot;
  :class=&quot;[$store.getters.sidebarOpened ? &#39;openSidebar&#39; : &#39;hideSidebar&#39;]&quot;
&gt;
  ...
&lt;/div&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
  ... .fixed-header &#123;
    position: fixed;
    top: 0;
    right: 0;
    z-index: 9;
    width: calc(100% - #&#123;$sideBarWidth&#125;);
    transition: width 0.28s;
  &#125;

  .hideSidebar .fixed-header &#123;
    width: calc(100% - #&#123;$hideSideBarWidth&#125;);
  &#125;
&lt;/style&gt;

&lt;style&gt;
  // 在 `styles/variables.scss` 中指定 `hideSideBarWidth`
  $hideSideBarWidth: 54px;
&lt;/style&gt;
</code></pre>
<h4 id="22、SidebarHeader-处理"><a href="#22、SidebarHeader-处理" class="headerlink" title="22、SidebarHeader 处理"></a>22、SidebarHeader 处理</h4><details>
<summary>显示详细代码</summary>

<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;&quot;&gt;
    &lt;div class=&quot;logo-container&quot;&gt;
      &lt;el-avatar size=&quot;44&quot; shape=&quot;square&quot; src=&quot;http://xxxxx.com&quot; /&gt;
      &lt;h1 class=&quot;logo-title&quot; v-if=&quot;$store.getters.sidebarOpened&quot;&gt;Admin&lt;/h1&gt;
    &lt;/div&gt;
    ...
  &lt;/div&gt;
&lt;/template&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
  .logo-container &#123;
    height: 44px;
    padding: 10px 0 22px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    .logo-title &#123;
      margin-left: 10px;
      color: #fff;
      font-weight: 600;
      line-height: 50px;
      font-size: 16px;
      white-space: nowrap;
    &#125;
  &#125;
&lt;/style&gt;
</code></pre>
</details>

<blockquote>
<p>处理 el-avatar 的图片背景问题</p>
</blockquote>
<p>创建 <code>styles/element.scss</code>,然后将其导入到<code>style/index.scss</code></p>
<pre><code class="css">.el-avatar &#123;
  --el-avatar-background-color: none;
&#125;
</code></pre>
<blockquote>
<p>处理动画问题</p>
</blockquote>
<p>在 <code>styles/variables.scss</code> 中，加入以下变量</p>
<pre><code class="css">$sideBarDuration: 0.28s;
</code></pre>
<p><code>styles/sidebar.scss</code> 修改时长</p>
<pre><code class="css">  .main-container &#123;
    transition: margin-left #&#123;$sideBarDuration&#125;;
   ...
  &#125;

  .sidebar-container &#123;
    transition: width #&#123;$sideBarDuration&#125;;
      ...
  &#125;
</code></pre>
<p><code>layout/index</code> 修改样式</p>
<pre><code class="css">.fixed-header &#123;
  ...
  transition: width #&#123;$sideBarDuration&#125;;
&#125;
</code></pre>
<h4 id="23、组件状态驱动的动态-CSS-值"><a href="#23、组件状态驱动的动态-CSS-值" class="headerlink" title="23、组件状态驱动的动态 CSS 值"></a>23、组件状态驱动的动态 CSS 值</h4><pre><code class="html">&lt;template&gt; ... &lt;el-avatar :size=&quot;logoHeight&quot; ... &lt;/template&gt;

&lt;script setup&gt;
  ...
  const logoHeight = 44
&lt;/script&gt;

&lt;style lang=&quot;scss&quot; scoped&gt;
  .logo-container &#123;
    height: v-bind(logoHeight) + &#39;px&#39;;
  ...
  &#125;
&lt;/style&gt;
</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2022/11/21/95-v-deep/" title="95、vue3.0使用sass预处理器使用::v-deep深度选择器抛出警告"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: 95、vue3.0使用sass预处理器使用::v-deep深度选择器抛出警告</span></a><a class="button is-default" href="/2022/11/10/93-vue3-ele-plus-admin/" title="93、使用vue3+element-plus写后台管理系统：（三）"><span class="has-text-weight-semibold">下一页: 93、使用vue3+element-plus写后台管理系统：（三）</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Jude"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><a title="zhihu" target="_blank" rel="noopener nofollow" href="//zhihu.com/https://www.zhihu.com/hot"><i class="iconfont icon-zhihu"></i></a><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Jude 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span>记住昨日的美好，过好今日的生活，憧憬明天的到来</span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>