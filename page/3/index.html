<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;issummer.cn&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta property="og:type" content="website">
<meta property="og:title" content="Jude">
<meta property="og:url" content="http://issummer.cn/page/3/index.html">
<meta property="og:site_name" content="Jude">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://issummer.cn/page/3/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<title>Jude</title><script data-pjax src="/js/load-config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Jude</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/18/116-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/18/116-react/" class="post-title-link" itemprop="url">116、稀土掘金小册-记账本（七）新增账单弹窗封装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-18 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-18T20:00:00+08:00">2023-01-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:55:36" itemprop="dateModified" datetime="2023-08-15T10:55:36+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>回顾一下上一章节学习的内容。无限滚动列表、弹窗组件的内部控制显隐、工具方法以及常量的提取。若是你开发项目时，在潜意识里，有对这些内容进行封装的思想，那么你已经有模块化、组件化的开发理念了。在大量的工程中得出的实践，将会根深蒂固在你的开发理念里。</p>
<p>之前，我们是对一个小组件，如时间筛选、类型筛选等小组件进行封装。本章节，我们对一个添加模块进行封装，好处就是你在任何地方，都能使用这个添加组件，对账单进行增加操作。</p>
<p>我们先来看看本章节要绘制的页面和逻辑：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/349d2f897ff84498a7016596b2e11882~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>如上图所示，本章节要实现的需求逻辑，基本上已经绘制在图中。所有的努力，都是为了凑出这几个参数：</p>
<ul>
<li>账单类型</li>
<li>账单金额</li>
<li>账单日期</li>
<li>账单种类</li>
<li>备注</li>
</ul>
<p>然后将这些数据，提交给服务端进行处理，然后存储到数据库，完事。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>上述需求整理清楚之后，我们开始本章节的制作环节。</p>
<h3 id="弹窗组件实现"><a href="#弹窗组件实现" class="headerlink" title="弹窗组件实现"></a>弹窗组件实现</h3><p>先实现点击新增按钮，调出弹窗的功能。首先，在 <code>Home/index.jsx</code> 文件中添加 「新增按钮」，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/CustomIcon&#x27;</span><br>...<br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> addToggle = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// do something</span><br>  &#125;<br>  ...<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.add&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;addToggle&#125;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;tianjia&#x27;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>样式中，注意我给 <code>border</code> 设置的是 <code>1PX</code>，大写的单位，因为这样写的话，<code>postcss-pxtorem</code> 插件就不会将其转化为 <code>rem</code> 单位。</p>
<p>重启项目之后，刷新浏览器，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/acf8cf59aeed4061b36a5b7359fb42b9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>根据之前实现的弹窗组件，我们再实现一套类似的，在弹窗内控制弹窗组件的显示隐藏，在 <code>components</code> 下新建 <code>PopupAddBill</code> 文件夹，再新建 <code>index.jsx</code> 和 <code>style.module.less</code>，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// PopupAddBill/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; forwardRef, useEffect, useRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;prop-types&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Popup &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">const</span> PopupAddBill = forwardRef(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = useState(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 内部控制弹窗显示隐藏。</span><br>  <span class="hljs-comment">// 通过 forwardRef 拿到外部传入的 ref，并添加属性，使得父组件可以通过 ref 控制子组件。</span><br>  <span class="hljs-keyword">if</span> (ref) &#123;<br>    ref.current = &#123;<br>      <span class="hljs-attr">show</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">true</span>);<br>      &#125;,<br>      <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">false</span>);<br>      &#125;,<br>    &#125;;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Popup</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;show&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">direction</span>=<span class="hljs-string">&quot;bottom&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">onMaskClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">      destroy=&#123;false&#125;</span><br><span class="xml">      mountContainer=&#123;() =&gt; document.body&#125;</span><br><span class="xml">    &gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">200</span>, <span class="hljs-attr">background:</span> &quot;#<span class="hljs-attr">fff</span>&quot; &#125;&#125;&gt;</span>弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Popup</span>&gt;</span></span><br>  );<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> PopupAddBill;<br></code></pre></td></tr></table></figure>

<p>写完弹窗组件，当然就得去 <code>Home/index.jsx</code> 中调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Home/index.jsx</span><br><span class="hljs-keyword">import</span> PopupAddBill <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/PopupAddBill&#x27;</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> addRef = useRef(); <span class="hljs-comment">// 添加账单 ref</span><br>  ...<br>  <span class="hljs-comment">// 添加账单弹窗</span><br>  <span class="hljs-keyword">const</span> addToggle = <span class="hljs-function">() =&gt;</span> &#123;<br>    addRef.current &amp;&amp; addRef.current.show()<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">PopupAddBill</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;addRef&#125;</span> /&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>重启浏览器，效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7025a89978114333bdf7cbdb20139482~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时我们的“地基”已经打好了，接下来我们要在这个基础上给新增账单弹窗“添砖加瓦”。</p>
<h3 id="账单类型和账单时间"><a href="#账单类型和账单时间" class="headerlink" title="账单类型和账单时间"></a>账单类型和账单时间</h3><p>我们先实现弹窗头部左侧的「支出」和「收入」账单类型切换功能，添加代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// components/PopupAddBill/index.jsx</span><br>...<br><span class="hljs-keyword">import</span> cx <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;classnames&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; Popup, Icon  &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zarm&#x27;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./style.module.less&#x27;</span>;<br><br><span class="hljs-keyword">const</span> PopupAddBill = forwardRef(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> [payType, setPayType] = useState(<span class="hljs-string">&#x27;expense&#x27;</span>); <span class="hljs-comment">// 支出或收入类型</span><br>  ...<br>  <span class="hljs-comment">// 切换收入还是支出</span><br>  <span class="hljs-keyword">const</span> changeType = <span class="hljs-function">(<span class="hljs-params">type</span>) =&gt;</span> &#123;<br>    setPayType(type);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Popup</span></span></span><br><span class="hljs-tag"><span class="xml">    <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;show&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">    <span class="hljs-attr">direction</span>=<span class="hljs-string">&quot;bottom&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">    <span class="hljs-attr">onMaskClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">    destroy=&#123;false&#125;</span><br><span class="xml">    mountContainer=&#123;() =&gt; document.body&#125;</span><br><span class="xml">  &gt;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.addWrap&#125;</span>&gt;</span></span><br><span class="xml">      &#123;/* 右上角关闭弹窗 */&#125;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.close&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;wrong&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="xml">       &#123;/* 「收入」和「支出」类型切换 */&#125;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.filter&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.type&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> changeType(&#x27;expense&#x27;)&#125; className=&#123;cx(&#123; [s.expense]: true, [s.active]: payType == &#x27;expense&#x27; &#125;)&#125;&gt;支出<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> changeType(&#x27;income&#x27;)&#125; className=&#123;cx(&#123; [s.income]: true, [s.active]: payType == &#x27;income&#x27; &#125;)&#125;&gt;收入<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Popup</span>&gt;</span></span><br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> PopupAddBill<br></code></pre></td></tr></table></figure>

<p>为了减少代码的重复，上述代码只展示了需要添加的部分，尽量不让大家混淆视听。</p>
<p>我们定义 <code>expense</code> 为支出，<code>income</code> 为收入，代码中通过 <code>payType</code> 变量，来控制「收入」和「支出」按钮的切换。上述代码视图效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd1f72d07dff4f69af0848e8d2f0696f~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>接下来在类型边上添加时间筛选弹窗，此时你将体会到之前提取时间筛选组件是多么的明智。我们继续添加代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; forwardRef, useEffect, useRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br>...<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dayjs&#x27;</span>;<br><span class="hljs-keyword">import</span> PopupDate <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../PopupDate&#x27;</span><br>...<br><br><span class="hljs-keyword">const</span> PopupAddBill = forwardRef(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> dateRef = useRef();<br>  <span class="hljs-keyword">const</span> [date, setDate] = useState(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()); <span class="hljs-comment">// 日期</span><br>  ...<br>  <span class="hljs-comment">// 日期选择回调</span><br>  <span class="hljs-keyword">const</span> selectDate = <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> &#123;<br>    setDate(val);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Popup</span></span></span><br><span class="hljs-tag"><span class="xml">    <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;show&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">    <span class="hljs-attr">direction</span>=<span class="hljs-string">&quot;bottom&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">    <span class="hljs-attr">onMaskClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">    destroy=&#123;false&#125;</span><br><span class="xml">    mountContainer=&#123;() =&gt; document.body&#125;</span><br><span class="xml">  &gt;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.addWrap&#125;</span>&gt;</span></span><br><span class="xml">       &#123;/* 「收入」和「支出」类型切换 */&#125;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.filter&#125;</span>&gt;</span></span><br><span class="xml">        ...</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> dateRef.current &amp;&amp; dateRef.current.show()&#125;</span><br><span class="xml">        &gt;&#123;dayjs(date).format(&#x27;MM-DD&#x27;)&#125; <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">PopupDate</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;dateRef&#125;</span> <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;selectDate&#125;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Popup</span>&gt;</span></span><br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> PopupAddBill<br></code></pre></td></tr></table></figure>

<p>我们引入了公共组件 <code>PopupDate</code>，传入 <code>ref</code> 控制弹窗的显示隐藏，传入 <code>onSelect</code> 获取日期组件选择后回调的值，并通过 <code>setDate</code> 重制 <code>date</code>，触发视图的更新，我们来看浏览器展示效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee3fa326b74f41ddb0d211e886ca5ccb~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>我们通过上述代码，已经创造出了两个值，分别是「账单类型」和「账单日期」，还差「账单金额」 「账单种类」、「备注」。</p>
<h3 id="账单金额"><a href="#账单金额" class="headerlink" title="账单金额"></a>账单金额</h3><p>本章开头大家也应该看到了，金额输入框是模拟的，也就是说当下面模拟数字键盘点击的时候，我们将返回的数据渲染到进入输入框的位置，下面我们先将金额输入框搭建出来，添加代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div className=&#123;s.money&#125;&gt;<br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.sufix&#125;</span>&gt;</span>¥<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(s.amount,</span> <span class="hljs-attr">s.animation</span>)&#125;&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/15dc48f98c4f42eb9310619510603506~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>我们将金额动态化，引入 <code>Zarm</code> 为我们提供的模拟数字键盘组件 <code>Keyboard</code>，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-comment">// 监听输入框改变值</span><br>  <span class="hljs-keyword">const</span> handleMoney = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;<br>    value = <span class="hljs-built_in">String</span>(value)<br>    <span class="hljs-comment">// 点击是删除按钮时</span><br>    <span class="hljs-keyword">if</span> (value == <span class="hljs-string">&#x27;delete&#x27;</span>) &#123;<br>      <span class="hljs-keyword">let</span> _amount = amount.slice(<span class="hljs-number">0</span>, amount.length - <span class="hljs-number">1</span>)<br>      setAmount(_amount)<br>      <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// 点击确认按钮时</span><br>    <span class="hljs-keyword">if</span> (value == <span class="hljs-string">&#x27;ok&#x27;</span>) &#123;<br>      <span class="hljs-comment">// 这里后续将处理添加账单逻辑</span><br>      <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// 当输入的值为 &#x27;.&#x27; 且 已经存在 &#x27;.&#x27;，则不让其继续字符串相加。</span><br>    <span class="hljs-keyword">if</span> (value == <span class="hljs-string">&#x27;.&#x27;</span> &amp;&amp; amount.includes(<span class="hljs-string">&#x27;.&#x27;</span>)) <span class="hljs-keyword">return</span><br>    <span class="hljs-comment">// 小数点后保留两位，当超过两位时，不让其字符串继续相加。</span><br>    <span class="hljs-keyword">if</span> (value != <span class="hljs-string">&#x27;.&#x27;</span> &amp;&amp; amount.includes(<span class="hljs-string">&#x27;.&#x27;</span>) &amp;&amp; amount &amp;&amp; amount.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>].length &gt;= <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span><br>    <span class="hljs-comment">// amount += value</span><br>    setAmount(amount + value)<br>  &#125;<br>...<br><br>&lt;div className=&#123;s.money&#125;&gt;<br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.sufix&#125;</span>&gt;</span>¥<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(s.amount,</span> <span class="hljs-attr">s.animation</span>)&#125;&gt;</span>&#123;amount&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>&lt;/div&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Keyboard</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;price&quot;</span> <span class="hljs-attr">onKeyClick</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> handleMoney(value)&#125; /&gt;</span><br></code></pre></td></tr></table></figure>

<p>重启项目，浏览器展示如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fc90561f73d4b2c921864ebefc2cd2c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<blockquote>
<p>这里一个小提示，我在制作项目的过程中，发现一个 Zarm 2.9.0 版本的 bug，Keyboard 组件在点击删除按钮的时候，onKeyClick 方法会反复被执行，于是我降级为 2.8.2 版本，并且去他们的官网提了 issue。</p>
</blockquote>
<p>此时「账单金额」也被安排上了。</p>
<h3 id="账单种类"><a href="#账单种类" class="headerlink" title="账单种类"></a>账单种类</h3><p>账单种类的作用是表示该笔账单的大致用途，我们通过接口从数据库回去账单种类列表，以横向滚动的形式，展示在金额的下面，接下来我们看具体的代码实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../CustomIcon&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; get, typeMap &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils&#x27;</span>;<br><br>...<br><span class="hljs-keyword">const</span> [currentType, setCurrentType] = useState(&#123;&#125;); <span class="hljs-comment">// 当前选中账单类型</span><br><span class="hljs-keyword">const</span> [expense, setExpense] = useState([]); <span class="hljs-comment">// 支出类型数组</span><br><span class="hljs-keyword">const</span> [income, setIncome] = useState([]); <span class="hljs-comment">// 收入类型数组</span><br><br>useEffect(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">data</span>: &#123; list &#125; &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">&#x27;/api/type/list&#x27;</span>);<br>  <span class="hljs-keyword">const</span> _expense = list.filter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.type == <span class="hljs-number">1</span>); <span class="hljs-comment">// 支出类型</span><br>  <span class="hljs-keyword">const</span> _income = list.filter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.type == <span class="hljs-number">2</span>); <span class="hljs-comment">// 收入类型</span><br>  setExpense(_expense);<br>  setIncome(_income);<br>  setCurrentType(_expense[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 新建账单，类型默认是支出类型数组的第一项</span><br>&#125;, [])<br><br><br>...<br>&lt;div className=&#123;s.typeWarp&#125;&gt;<br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.typeBody&#125;</span>&gt;</span></span><br><span class="xml">    &#123;/* 通过 payType 判断，是展示收入账单类型，还是支出账单类型 */&#125;</span><br><span class="xml">    &#123;</span><br><span class="xml">      (payType == &#x27;expense&#x27; ? expense : income).map(item =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCurrentType(item)&#125; key=&#123;item.id&#125; className=&#123;s.typeItem&#125;&gt;</span><br><span class="xml">        &#123;/* 收入和支出的字体颜色，以及背景颜色通过 payType 区分，并且设置高亮 */&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(&#123;[s.iconfontWrap]:</span> <span class="hljs-attr">true</span>, [<span class="hljs-attr">s.expense</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">payType</span> == <span class="hljs-string">&#x27;expense&#x27;</span>, [<span class="hljs-attr">s.income</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">payType</span> == <span class="hljs-string">&#x27;income&#x27;</span>, [<span class="hljs-attr">s.active</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">currentType.id</span> == <span class="hljs-string">item.id&#125;)&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.iconfont&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#123;typeMap[item.id].icon&#125;</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;item.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)</span><br><span class="xml">    &#125;</span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<p>注意，在 <code>h5</code> 界面实现横向滚动，和在网页端相比，多了如下属性：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123;<br>  touch-action: pan-x;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>CSS 属性 touch-action 用于设置触摸屏用户如何操纵元素的区域(例如，浏览器内置的缩放功能)。</p>
</blockquote>
<p>如果不设置它，只是通过 <code>overflow-x: auto</code>，无法实现 <code>h5</code> 端的横向滚动的，并且你要在一个 <code>div</code> 容器内设置全局 <code>*</code> 为 <code>touch-action: pan-x;</code>，如果后续遇到类似的问题，大家可以参考我上述做法，这是经过实践验证过的方法。</p>
<p>我们来看看浏览器的展示效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9047dbf8d2d44f09ab66fce10dc1ee89~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="备注弹窗"><a href="#备注弹窗" class="headerlink" title="备注弹窗"></a>备注弹窗</h3><p>备注虽然不起眼，但是别小看它，它可以在账单类型不足以概括账单时，加以一定的文字描述。</p>
<p>我们直接将其放置于「账单种类」的下面，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> &#123;  Input  &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zarm&#x27;</span>;<br><br>...<br><span class="hljs-keyword">const</span> [remark, setRemark] = useState(<span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// 备注</span><br><span class="hljs-keyword">const</span> [showRemark, setShowRemark] = useState(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 备注输入框展示控制</span><br><br>...<br>&lt;div className=&#123;s.remark&#125;&gt;<br>  &#123;<br>    showRemark ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">autoHeight</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">showLength</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">maxLength</span>=<span class="hljs-string">&#123;50&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">rows</span>=<span class="hljs-string">&#123;3&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;remark&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入备注信息&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;(val)</span> =&gt;</span> setRemark(val)&#125;</span><br><span class="xml">      onBlur=&#123;() =&gt; setShowRemark(false)&#125;</span><br><span class="xml">    /&gt;</span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShowRemark(true)&#125;&gt;&#123;remark || &#x27;添加备注&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>  &#125;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<p><strong>CSS 样式部分</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.remark</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">24px</span>;<br>  <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">12px</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4b67e2</span>;<br>  :global &#123;<br>    .za-input--textarea &#123;<br>      border: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e9e9e9</span>;<br>      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>:global</code> 的使用之前已经有描述过，这里再提醒大家一句，目前项目使用的是 <code>css module</code> 的形式，所以样式名都会被打上 <code>hash</code> 值，我们需要修改没有打 <code>hash</code> 值的 <code>zarm</code> 内部样式，需要通过 <code>:global</code> 方法。</p>
<p>浏览器展示效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28bec13e3c9444cb8a4fd3779290193f~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="调用上传账单接口"><a href="#调用上传账单接口" class="headerlink" title="调用上传账单接口"></a>调用上传账单接口</h3><p>此时我们集齐了五大参数：</p>
<ul>
<li>账单类型：payType</li>
<li>账单金额：amount</li>
<li>账单日期：date</li>
<li>账单种类：currentType</li>
<li>备注：remark</li>
</ul>
<p>我们给 <code>Keyboard</code> 的「确定」按钮回调添加方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; Toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; post &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><span class="hljs-comment">// 监听输入框改变值</span><br><span class="hljs-keyword">const</span> handleMoney = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;<br>  value = <span class="hljs-built_in">String</span>(value);<br>  <span class="hljs-comment">// 点击是删除按钮时</span><br>  <span class="hljs-keyword">if</span> (value == <span class="hljs-string">&quot;delete&quot;</span>) &#123;<br>    <span class="hljs-keyword">let</span> _amount = amount.slice(<span class="hljs-number">0</span>, amount.length - <span class="hljs-number">1</span>);<br>    setAmount(_amount);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">// 点击确认按钮时</span><br>  <span class="hljs-keyword">if</span> (value == <span class="hljs-string">&quot;ok&quot;</span>) &#123;<br>    addBill();<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">// 当输入的值为 &#x27;.&#x27; 且 已经存在 &#x27;.&#x27;，则不让其继续字符串相加。</span><br>  <span class="hljs-keyword">if</span> (value == <span class="hljs-string">&quot;.&quot;</span> &amp;&amp; amount.includes(<span class="hljs-string">&quot;.&quot;</span>)) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-comment">// 小数点后保留两位，当超过两位时，不让其字符串继续相加。</span><br>  <span class="hljs-keyword">if</span> (<br>    value != <span class="hljs-string">&quot;.&quot;</span> &amp;&amp;<br>    amount.includes(<span class="hljs-string">&quot;.&quot;</span>) &amp;&amp;<br>    amount &amp;&amp;<br>    amount.split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">1</span>].length &gt;= <span class="hljs-number">2</span><br>  )<br>    <span class="hljs-keyword">return</span>;<br>  <span class="hljs-comment">// amount += value</span><br>  setAmount(amount + value);<br>&#125;;<br><br><span class="hljs-comment">// 添加账单</span><br><span class="hljs-keyword">const</span> addBill = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!amount) &#123;<br>    Toast.show(<span class="hljs-string">&quot;请输入具体金额&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> params = &#123;<br>    <span class="hljs-attr">amount</span>: <span class="hljs-built_in">Number</span>(amount).toFixed(<span class="hljs-number">2</span>), <span class="hljs-comment">// 账单金额小数点后保留两位</span><br>    <span class="hljs-attr">type_id</span>: currentType.id, <span class="hljs-comment">// 账单种类id</span><br>    <span class="hljs-attr">type_name</span>: currentType.name, <span class="hljs-comment">// 账单种类名称</span><br>    <span class="hljs-attr">date</span>: dayjs(date).unix() * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 日期传时间戳</span><br>    <span class="hljs-attr">pay_type</span>: payType == <span class="hljs-string">&quot;expense&quot;</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">2</span>, <span class="hljs-comment">// 账单类型传 1 或 2</span><br>    <span class="hljs-attr">remark</span>: remark || <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 备注</span><br>  &#125;;<br>  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&quot;/api/bill/add&quot;</span>, params);<br>  <span class="hljs-comment">// 重制数据</span><br>  setAmount(<span class="hljs-string">&quot;&quot;</span>);<br>  setPayType(<span class="hljs-string">&quot;expense&quot;</span>);<br>  setCurrentType(expense[<span class="hljs-number">0</span>]);<br>  setDate(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<br>  setRemark(<span class="hljs-string">&quot;&quot;</span>);<br>  Toast.show(<span class="hljs-string">&quot;添加成功&quot;</span>);<br>  setShow(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">if</span> (props.onReload) props.onReload();<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><code>onReload</code> 方法为首页账单列表传进来的函数，当添加完账单的时候，执行 <code>onReload</code> 重新获取首页列表数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;PopupAddBill ref=&#123;addRef&#125; onReload=&#123;refreshData&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p>浏览器展示如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c3fd021a8f8497d8b14ff0c81a53367~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>如果如上图所示，恭喜你，你已经成功完成了添加账单的 工作，此时再回头甚至之前写的代码，马上改正一些变量及一些方法的命名，规范化一下代码。</p>
<p>千万别在后面再去完善，因为很大程度上，到后面你会懒得翻前面写的代码，除非实在是逻辑问题导致的 bug。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本章节的内容也是非常丰富，我们的所有的努力，就是为了集齐「添加账单」所需要的五大参数。这是很多需求的一个索引，试问前端在调用接口的过程中，不都是做各种努力为了凑齐那几个参数呢？过程很重要，只要流程做得完善，结果自然水到渠成。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/11/115-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/11/115-react/" class="post-title-link" itemprop="url">115、稀土掘金小册-记账本（六）账单列表</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-11 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-11T20:00:00+08:00">2023-01-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:55:50" itemprop="dateModified" datetime="2023-08-15T10:55:50+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>上一章节介绍的登录注册是整个项目的根基，没有拿到 <code>token</code>，将无法进行后续的各种操作，如账单的增删改查。所以务必将上一章节好好地阅读与揣摩，为后面的学习做好铺垫。我们直接进入本次前端实战项目的主题，账单的增删改查之列表页。</p>
<blockquote>
<p>本教程已有线上地址<a href="https://link.juejin.cn/?target=http://cost.chennick.wang">在线地址</a>，同学们可以在实战部分，对照着线上页面进行学习。</p>
</blockquote>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>单项组件抽离</li>
<li>列表页无限滚动</li>
<li>下拉刷新列表</li>
<li>弹窗组件封装</li>
</ul>
<p>我们先来欣赏一下最终的页面效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fc0196a649c41cb8fe73dafe50233b0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="列表页编写（静态部分）"><a href="#列表页编写（静态部分）" class="headerlink" title="列表页编写（静态部分）"></a>列表页编写（静态部分）</h2><p>按照正常的开发流程，我们先将静态页面切出来，再填入数据使其动态化。在此之前，我们已经新建好了 <code>Home</code> 目录，该目录便是用于放置账单列表，所以我们直接在 <code>Home/index.jsx</code> 新增代码。</p>
<h3 id="头部统计实现"><a href="#头部统计实现" class="headerlink" title="头部统计实现"></a>头部统计实现</h3><p>列表的头部展示的内容为当月的收入和支出汇总，并且有两个列表条件过滤项，分别是类型过滤和时间过滤。</p>
<p>我们新增代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.dataWrap&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.expense&#125;</span>&gt;</span></span><br><span class="xml">            总支出：<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>¥ 200<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.income&#125;</span>&gt;</span></span><br><span class="xml">            总收入：<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>¥ 500<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.typeWrap&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.left&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span></span><br><span class="xml">              类型 <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.right&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span>&gt;</span></span><br><span class="xml">              2022-06</span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Home;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>代码分析：</p>
<p><code>header</code> 采用 <code>fixed</code> 固定定位，将整个汇总信息固定在页面的顶部位置，这样后续列表滚动的时候，你可以方便查看当月的收入汇总，以及筛选当月消费类型和时间段的筛选。每个列表展示的是当月的收入与支出明细，比如 <code>2021-06</code> 的收入明细。</p>
<p>本次项目全程采用的是 <code>Flex</code> 弹性布局，这种布局形式在当下的开发生产环境已经非常成熟，同学们如果还有不熟悉的，请实现对 <code>Flex</code> 布局做一个简单的学习，这边推荐一个学习网站：</p>
<blockquote>
<p><a href="https://link.juejin.cn/?target=http://flexboxfroggy.com/%23zh-cn">flexboxfroggy.com/#zh-cn</a></p>
</blockquote>
<p>笔者当初也是通过这个网站的学习，入门的 <code>Flex</code>。</p>
<p>完成上述布局之后，页面如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b4da908ba7d412ea25d6b925006f163~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="列表页面实现"><a href="#列表页面实现" class="headerlink" title="列表页面实现"></a>列表页面实现</h3><p>列表页面会用到 <code>Zarm</code> 组件库为我们提供的 <a href="https://link.juejin.cn/?target=https://zarm.gitee.io/%23/components/pull">Pull</a> 组件，来实现下拉刷新以及无限滚动，我们先来将基础布局实现，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Home/index.jsx</span><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [list, setList] = useState([<br>    &#123;<br>      <span class="hljs-attr">bills</span>: [<br>        &#123;<br>          <span class="hljs-attr">amount</span>: <span class="hljs-string">&quot;25.00&quot;</span>,<br>          <span class="hljs-attr">date</span>: <span class="hljs-string">&quot;1623390740000&quot;</span>,<br>          <span class="hljs-attr">id</span>: <span class="hljs-number">911</span>,<br>          <span class="hljs-attr">pay_type</span>: <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">remark</span>: <span class="hljs-string">&quot;&quot;</span>,<br>          <span class="hljs-attr">type_id</span>: <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">type_name</span>: <span class="hljs-string">&quot;餐饮&quot;</span>,<br>        &#125;,<br>      ],<br>      <span class="hljs-attr">date</span>: <span class="hljs-string">&quot;2021-06-11&quot;</span>,<br>    &#125;,<br>  ]); <span class="hljs-comment">// 账单列表</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.contentWrap&#125;</span>&gt;</span></span><br><span class="xml">        &#123;list.map((item, index) =&gt; (</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">BillItem</span> /&gt;</span></span><br><span class="xml">        ))&#125;</span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>上述我们添加 <code>list</code> 为列表假数据，<code>BillItem</code> 组件为账单单项组件，我们将其抽离到 <code>components</code> 组件库，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// components/BillItem/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;prop-types&quot;</span>;<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dayjs&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Cell &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../CustomIcon&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; typeMap &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> BillItem = <span class="hljs-function">(<span class="hljs-params">&#123; bill &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [income, setIncome] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 收入</span><br>  <span class="hljs-keyword">const</span> [expense, setExpense] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 支出</span><br>  <span class="hljs-keyword">const</span> navigateTo = useNavigate(); <span class="hljs-comment">// 路由实例</span><br><br>  <span class="hljs-comment">// 当添加账单是，bill.bills 长度变化，触发当日收支总和计算。</span><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 初始化将传入的 bill 内的 bills 数组内数据项，过滤出支出和收入。</span><br>    <span class="hljs-comment">// pay_type：1 为支出；2 为收入</span><br>    <span class="hljs-comment">// 通过 reduce 累加</span><br>    <span class="hljs-keyword">const</span> _income = bill.bills<br>      .filter(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.pay_type == <span class="hljs-number">2</span>)<br>      .reduce(<span class="hljs-function">(<span class="hljs-params">curr, item</span>) =&gt;</span> &#123;<br>        curr += <span class="hljs-built_in">Number</span>(item.amount);<br>        <span class="hljs-keyword">return</span> curr;<br>      &#125;, <span class="hljs-number">0</span>);<br>    setIncome(_income);<br>    <span class="hljs-keyword">const</span> _expense = bill.bills<br>      .filter(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.pay_type == <span class="hljs-number">1</span>)<br>      .reduce(<span class="hljs-function">(<span class="hljs-params">curr, item</span>) =&gt;</span> &#123;<br>        curr += <span class="hljs-built_in">Number</span>(item.amount);<br>        <span class="hljs-keyword">return</span> curr;<br>      &#125;, <span class="hljs-number">0</span>);<br>    setExpense(_expense);<br>  &#125;, [bill.bills]);<br><br>  <span class="hljs-comment">// 前往账单详情</span><br>  <span class="hljs-keyword">const</span> goToDetail = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    navigateTo(<span class="hljs-string">`/detail?id=<span class="hljs-subst">$&#123;item.id&#125;</span>`</span>);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.item&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.headerDate&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.date&#125;</span>&gt;</span>&#123;bill.date&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.money&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615953405599/zhi%402x.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;支&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>¥&#123;expense.toFixed(2)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615953405599/shou%402x.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;收&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>¥&#123;income.toFixed(2)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      &#123;bill &amp;&amp;</span><br><span class="xml">        bill.bills.map((item) =&gt; (</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.bill&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> goToDetail(item)&#125;</span><br><span class="xml">            title=&#123;</span><br><span class="xml">              <span class="hljs-tag">&lt;&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span></span></span><br><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.itemIcon&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">type</span>=<span class="hljs-string">&#123;item.type_id</span> ? <span class="hljs-attr">typeMap</span>[<span class="hljs-attr">item.type_id</span>]<span class="hljs-attr">.icon</span> <span class="hljs-attr">:</span> <span class="hljs-attr">1</span>&#125;</span></span><br><span class="hljs-tag"><span class="xml">                /&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;item.type_name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;/&gt;</span></span><br><span class="xml">            &#125;</span><br><span class="xml">            description=&#123;</span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">color:</span> <span class="hljs-attr">item.pay_type</span> == <span class="hljs-string">2</span> ? &quot;<span class="hljs-attr">red</span>&quot; <span class="hljs-attr">:</span> &quot;#<span class="hljs-attr">39be77</span>&quot; &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">              &gt;</span>&#123;`$&#123;item.pay_type == 1 ? &quot;-&quot; : &quot;+&quot;&#125;$&#123;item.amount&#125;`&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            &#125;</span><br><span class="xml">            help=&#123;</span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">                &#123;dayjs(Number(item.date)).format(&quot;HH:mm&quot;)&#125;&#123;&quot; &quot;&#125;</span><br><span class="xml">                &#123;item.remark ? `| $&#123;item.remark&#125;` : &quot;&quot;&#125;</span><br><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            &#125;</span><br><span class="xml">          &gt;<span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br>        ))&#125;<br>    &lt;/div&gt;<br>  );<br>&#125;;<br><br>BillItem.propTypes = &#123;<br>  <span class="hljs-attr">bill</span>: PropTypes.object,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> BillItem;<br></code></pre></td></tr></table></figure>

<p>通过 <code>npm i dayjs -S</code> 添加日期操作工具，移动端建议使用 <code>dayjs</code>，因为它相比 <code>moment</code>，体积小很多。</p>
<p>上述代码中，<code>typeMap</code> 为我们自定义的属性，它是一个简直对，<code>key</code> 为消费类型 <code>icon</code> 的 <code>id</code>，<code>value</code> 为消费类型的 <code>iconfont</code> 的值，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// utils/index.js</span><br>...<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> typeMap = &#123;<br>  <span class="hljs-number">1</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;canyin&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">2</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;fushi&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">3</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;jiaotong&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">4</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;riyong&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">5</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;gouwu&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">6</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;xuexi&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">7</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;yiliao&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">8</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;lvxing&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">9</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;renqing&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">10</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;qita&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">11</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;gongzi&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">12</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;jiangjin&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">13</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;zhuanzhang&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">14</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;licai&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">15</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;tuikuang&#x27;</span><br>  &#125;,<br>  <span class="hljs-number">16</span>: &#123;<br>    <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;qita&#x27;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>完成上述操作之后，我们重启浏览器，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2eb308feee24749a7ce4cd0d00a9645~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>样式部分大家可以根据自己的喜好进行微调，不一定要一模一样，仁者见仁。</p>
<h3 id="下拉刷新、上滑无限加载"><a href="#下拉刷新、上滑无限加载" class="headerlink" title="下拉刷新、上滑无限加载"></a>下拉刷新、上滑无限加载</h3><p>我们修改 <code>Home/index.jsx</code> 如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> &#123; Icon, Pull &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zarm&#x27;</span><br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dayjs&#x27;</span><br><span class="hljs-keyword">import</span> BillItem <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/BillItem&#x27;</span><br><span class="hljs-keyword">import</span> &#123; get, REFRESH_STATE, LOAD_STATE &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils&#x27;</span> <span class="hljs-comment">// Pull 组件需要的一些常量</span><br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./style.module.less&#x27;</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [currentTime, setCurrentTime] = useState(dayjs().format(<span class="hljs-string">&#x27;YYYY-MM&#x27;</span>)); <span class="hljs-comment">// 当前筛选时间</span><br>  <span class="hljs-keyword">const</span> [page, setPage] = useState(<span class="hljs-number">1</span>); <span class="hljs-comment">// 分页</span><br>  <span class="hljs-keyword">const</span> [list, setList] = useState([]); <span class="hljs-comment">// 账单列表</span><br>  <span class="hljs-keyword">const</span> [totalPage, setTotalPage] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 分页总数</span><br>  <span class="hljs-keyword">const</span> [refreshing, setRefreshing] = useState(REFRESH_STATE.normal); <span class="hljs-comment">// 下拉刷新状态</span><br>  <span class="hljs-keyword">const</span> [loading, setLoading] = useState(LOAD_STATE.normal); <span class="hljs-comment">// 上拉加载状态</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getBillList() <span class="hljs-comment">// 初始化</span><br>  &#125;, [page])<br><br>  <span class="hljs-comment">// 获取账单方法</span><br>  <span class="hljs-keyword">const</span> getBillList = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">`/api/bill/list?page=<span class="hljs-subst">$&#123;page&#125;</span>&amp;page_size=5&amp;date=<span class="hljs-subst">$&#123;currentTime&#125;</span>`</span>);<br>    <span class="hljs-comment">// 下拉刷新，重制数据</span><br>    <span class="hljs-keyword">if</span> (page == <span class="hljs-number">1</span>) &#123;<br>      setList(data.list);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      setList(list.concat(data.list));<br>    &#125;<br>    setTotalPage(data.totalPage);<br>    <span class="hljs-comment">// 上滑加载状态</span><br>    setLoading(LOAD_STATE.success);<br>    setRefreshing(REFRESH_STATE.success);<br>  &#125;<br><br>  <span class="hljs-comment">// 请求列表数据</span><br>  <span class="hljs-keyword">const</span> refreshData = <span class="hljs-function">() =&gt;</span> &#123;<br>    setRefreshing(REFRESH_STATE.loading);<br>    <span class="hljs-keyword">if</span> (page != <span class="hljs-number">1</span>) &#123;<br>      setPage(<span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      getBillList();<br>    &#125;;<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> loadData = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (page &lt; totalPage) &#123;<br>      setLoading(LOAD_STATE.loading);<br>      setPage(page + <span class="hljs-number">1</span>);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.dataWrap&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.expense&#125;</span>&gt;</span>总支出：<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>¥ 200<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.income&#125;</span>&gt;</span>总收入：<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>¥ 500<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.typeWrap&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.left&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>类型 <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.right&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span>&gt;</span>2022-06<span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.contentWrap&#125;</span>&gt;</span></span><br><span class="xml">      &#123;</span><br><span class="xml">        list.length ? <span class="hljs-tag">&lt;<span class="hljs-name">Pull</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">animationDuration</span>=<span class="hljs-string">&#123;200&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">stayTime</span>=<span class="hljs-string">&#123;400&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">refresh</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">state:</span> <span class="hljs-attr">refreshing</span>,</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">handler:</span> <span class="hljs-attr">refreshData</span></span></span><br><span class="hljs-tag"><span class="xml">          &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">load</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">state:</span> <span class="hljs-attr">loading</span>,</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">distance:</span> <span class="hljs-attr">200</span>,</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">handler:</span> <span class="hljs-attr">loadData</span></span></span><br><span class="hljs-tag"><span class="xml">          &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">        &gt;</span></span><br><span class="xml">          &#123;</span><br><span class="xml">            list.map((item, index) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">BillItem</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">bill</span>=<span class="hljs-string">&#123;item&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span>)</span><br><span class="xml">          &#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Pull</span>&gt;</span> : null</span><br><span class="xml">      &#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Home<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在 <code>utils/index.js</code> 中添加一些 <code>Pull</code> 组件需要用到的常量，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// utils/index.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> REFRESH_STATE = &#123;<br>  <span class="hljs-attr">normal</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 普通</span><br>  <span class="hljs-attr">pull</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 下拉刷新（未满足刷新条件）</span><br>  <span class="hljs-attr">drop</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 释放立即刷新（满足刷新条件）</span><br>  <span class="hljs-attr">loading</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// 加载中</span><br>  <span class="hljs-attr">success</span>: <span class="hljs-number">4</span>, <span class="hljs-comment">// 加载成功</span><br>  <span class="hljs-attr">failure</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 加载失败</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> LOAD_STATE = &#123;<br>  <span class="hljs-attr">normal</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 普通</span><br>  <span class="hljs-attr">abort</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 中止</span><br>  <span class="hljs-attr">loading</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 加载中</span><br>  <span class="hljs-attr">success</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// 加载成功</span><br>  <span class="hljs-attr">failure</span>: <span class="hljs-number">4</span>, <span class="hljs-comment">// 加载失败</span><br>  <span class="hljs-attr">complete</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 加载完成（无新数据）</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>代码中，已经为大家整理了详细的注释。无限滚动在移动端的应用随处可见，所以这块内容大家尽量能做到烂熟于心。如果有可能的话，希望你也能将其二次封装，便于多个地方的复用。我们打开浏览器查看效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b1408791dbd457f9a68abd898f6bb74~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>同学们注意一下上述动图中的细节，滑到底部的时候，有一部分内容被遮挡住了，此时我们需要添加下列样式，进行修复：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.home</span> &#123;<br>  ... <span class="hljs-selector-class">.content-wrap</span> &#123;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(~<span class="hljs-string">&quot;(100% - 50px)&quot;</span>);<br>    <span class="hljs-attribute">overflow</span>: hidden;<br>    <span class="hljs-attribute">overflow-y</span>: scroll;<br>    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>    :global &#123;<br>      .za-pull &#123;<br>        overflow: unset;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>给 <code>content-wrap</code> 对应的标签一个高度，并且减去 <code>50px</code> 的高度，这样就不会被遮挡住下面一点的部分。</p>
<p>还有一个很关键的步骤，给 <code>src</code> 目录下的的 <code>index.css</code> 添加初始化高度和样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">&quot;Segoe UI&quot;</span>, <span class="hljs-string">&quot;Roboto&quot;</span>,<br>    <span class="hljs-string">&quot;Oxygen&quot;</span>, <span class="hljs-string">&quot;Ubuntu&quot;</span>, <span class="hljs-string">&quot;Cantarell&quot;</span>, <span class="hljs-string">&quot;Fira Sans&quot;</span>, <span class="hljs-string">&quot;Droid Sans&quot;</span>,<br>    <span class="hljs-string">&quot;Helvetica Neue&quot;</span>, sans-serif;<br>  -webkit-<span class="hljs-attribute">font-smoothing</span>: antialiased;<br>  -moz-osx-<span class="hljs-attribute">font-smoothing</span>: grayscale;<br>&#125;<br><br><span class="hljs-selector-tag">body</span>,<br><span class="hljs-selector-tag">html</span>,<br><span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><br>* &#123;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br><br><span class="hljs-selector-id">#root</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><br><span class="hljs-selector-class">.text-deep</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.9</span>);<br>&#125;<br><br><span class="hljs-selector-class">.text-light</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.6</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>至此，滚动加载基本上就完成了。</p>
<h3 id="添加筛选条件"><a href="#添加筛选条件" class="headerlink" title="添加筛选条件"></a>添加筛选条件</h3><p>最后我们需要添加两个筛选条件，类型选择和日期选择。</p>
<p>我们先来实现类型选择弹窗，我们采用的形式如下，底部弹出的弹窗形式，大致如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a334aa0eee1451fbb268f3b2e70a67c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>想要实现上述形式，我们需要借助 <code>Zarm</code> 组件库为我们提供的 <a href="https://link.juejin.cn/?target=https://zarm.gitee.io/%23/components/popup">Popup</a> 组件，它的作用就是从不同方向弹出一个脱离文档流的弹出层。同样，我们使用组件的形式将其放置于 <code>components</code> 文件夹内实现，这样便于后续其他地方的使用。</p>
<p>新建 <code>components/PopupType</code>，在其内部新建 <code>index.jsx</code> 和 <code>style.module.less</code> 内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// PopupType/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; forwardRef, useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;prop-types&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Popup, Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> cx <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;classnames&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; get &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-comment">// forwardRef 用于拿到父组件传入的 ref 属性，这样在父组件便能通过 ref 控制子组件。</span><br><span class="hljs-keyword">const</span> PopupType = forwardRef(<span class="hljs-function">(<span class="hljs-params">&#123; onSelect &#125;, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = useState(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 组件的显示和隐藏</span><br>  <span class="hljs-keyword">const</span> [active, setActive] = useState(<span class="hljs-string">&quot;all&quot;</span>); <span class="hljs-comment">// 激活的 type</span><br>  <span class="hljs-keyword">const</span> [expense, setExpense] = useState([]); <span class="hljs-comment">// 支出类型标签</span><br>  <span class="hljs-keyword">const</span> [income, setIncome] = useState([]); <span class="hljs-comment">// 收入类型标签</span><br><br>  useEffect(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-comment">// 请求标签接口放在弹窗内，这个弹窗可能会被复用，所以请求如果放在外面，会造成代码冗余。</span><br>    <span class="hljs-keyword">const</span> &#123;<br>      <span class="hljs-attr">data</span>: &#123; list &#125;,<br>    &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">&quot;/api/type/list&quot;</span>);<br>    setExpense(list.filter(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.type == <span class="hljs-number">1</span>));<br>    setIncome(list.filter(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.type == <span class="hljs-number">2</span>));<br>  &#125;, []);<br><br>  <span class="hljs-keyword">if</span> (ref) &#123;<br>    ref.current = &#123;<br>      <span class="hljs-comment">// 外部可以通过 ref.current.show 来控制组件的显示</span><br>      <span class="hljs-attr">show</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">true</span>);<br>      &#125;,<br>      <span class="hljs-comment">// 外部可以通过 ref.current.close 来控制组件的显示</span><br>      <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">false</span>);<br>      &#125;,<br>    &#125;;<br>  &#125;<br><br>  <span class="hljs-comment">// 选择类型回调</span><br>  <span class="hljs-keyword">const</span> choseType = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setActive(item.id);<br>    setShow(<span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">// 父组件传入的 onSelect，为了获取类型</span><br>    onSelect(item);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Popup</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;show&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">direction</span>=<span class="hljs-string">&quot;bottom&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">onMaskClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">      destroy=&#123;false&#125;</span><br><span class="xml">      mountContainer=&#123;() =&gt; document.body&#125;</span><br><span class="xml">    &gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.popupType&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span>&gt;</span></span><br><span class="xml">          请选择类型</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;wrong&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.cross&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">          /&gt;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.content&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> choseType(&#123; id: &quot;all&quot; &#125;)&#125;</span><br><span class="xml">            className=&#123;cx(&#123; [s.all]: true, [s.active]: active == &quot;all&quot; &#125;)&#125;</span><br><span class="xml">          &gt;</span><br><span class="xml">            全部类型</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>支出<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.expenseWrap&#125;</span>&gt;</span></span><br><span class="xml">            &#123;expense.map((item, index) =&gt; (</span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">p</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> choseType(item)&#125;</span><br><span class="xml">                className=&#123;cx(&#123; [s.active]: active == item.id &#125;)&#125;</span><br><span class="xml">              &gt;</span><br><span class="xml">                &#123;item.name&#125;</span><br><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">            ))&#125;</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>收入<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.incomeWrap&#125;</span>&gt;</span></span><br><span class="xml">            &#123;income.map((item, index) =&gt; (</span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">p</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> choseType(item)&#125;</span><br><span class="xml">                className=&#123;cx(&#123; [s.active]: active == item.id &#125;)&#125;</span><br><span class="xml">              &gt;</span><br><span class="xml">                &#123;item.name&#125;</span><br><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">            ))&#125;</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Popup</span>&gt;</span></span><br>  );<br>&#125;);<br><br>PopupType.propTypes = &#123;<br>  <span class="hljs-attr">onSelect</span>: PropTypes.func,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> PopupType;<br></code></pre></td></tr></table></figure>

<p>老规矩，代码逻辑注释我都写在代码中，我坚持不把注释和逻辑分开，是因为我自己在看其他教程的时候，遇到代码中没写逻辑的文章，来回看下边的注释和上边的代码，有点乱，如果同学们有疑问，可以进群截图咨询，我在群里看到的话，随时进行解答。</p>
<p>类型弹窗组件写完之后，我们在 <code>Home/index.jsx</code> 内尝试调用它，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> PopupType <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/PopupType&#x27;</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> typeRef = useRef(); <span class="hljs-comment">// 账单类型 ref</span><br>  <span class="hljs-keyword">const</span> [currentSelect, setCurrentSelect] = useState(&#123;&#125;); <span class="hljs-comment">// 当前筛选类型</span><br>  ...<br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getBillList() <span class="hljs-comment">// 初始化</span><br>  &#125;, [page, currentSelect])<br><br>  <span class="hljs-keyword">const</span> getBillList = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">`/api/bill/list?page=<span class="hljs-subst">$&#123;page&#125;</span>&amp;page_size=5&amp;date=<span class="hljs-subst">$&#123;currentTime&#125;</span>&amp;type_id=<span class="hljs-subst">$&#123;currentSelect.id || <span class="hljs-string">&#x27;all&#x27;</span>&#125;</span>`</span>);<br>    <span class="hljs-comment">// 下拉刷新，重制数据</span><br>    <span class="hljs-keyword">if</span> (page == <span class="hljs-number">1</span>) &#123;<br>      setList(data.list);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      setList(list.concat(data.list));<br>    &#125;<br>    setTotalPage(data.totalPage);<br>    <span class="hljs-comment">// 上滑加载状态</span><br>    setLoading(LOAD_STATE.success);<br>    setRefreshing(REFRESH_STATE.success);<br>  &#125;<br><br>  ...<br><br>  <span class="hljs-comment">// 添加账单弹窗</span><br>  <span class="hljs-keyword">const</span> toggle = <span class="hljs-function">() =&gt;</span> &#123;<br>    typeRef.current &amp;&amp; typeRef.current.show()<br>  &#125;;<br><br>  <span class="hljs-comment">// 筛选类型</span><br>  <span class="hljs-keyword">const</span> select = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setRefreshing(REFRESH_STATE.loading);<br>    <span class="hljs-comment">// 触发刷新列表，将分页重制为 1</span><br>    setPage(<span class="hljs-number">1</span>);<br>    setCurrentSelect(item)<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.dataWrap&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.expense&#125;</span>&gt;</span>总支出：<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>¥ 200<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.income&#125;</span>&gt;</span>总收入：<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>¥ 500<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.typeWrap&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.left&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toggle&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>&#123; currentSelect.name || &#x27;全部类型&#x27; &#125; <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.right&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span>&gt;</span>2022-06<span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.contentWrap&#125;</span>&gt;</span></span><br><span class="xml">      &#123;</span><br><span class="xml">        list.length ? <span class="hljs-tag">&lt;<span class="hljs-name">Pull</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">animationDuration</span>=<span class="hljs-string">&#123;200&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">stayTime</span>=<span class="hljs-string">&#123;400&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">refresh</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">state:</span> <span class="hljs-attr">refreshing</span>,</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">handler:</span> <span class="hljs-attr">refreshData</span></span></span><br><span class="hljs-tag"><span class="xml">          &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">load</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">state:</span> <span class="hljs-attr">loading</span>,</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">distance:</span> <span class="hljs-attr">200</span>,</span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">handler:</span> <span class="hljs-attr">loadData</span></span></span><br><span class="hljs-tag"><span class="xml">          &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">        &gt;</span></span><br><span class="xml">          &#123;</span><br><span class="xml">            list.map((item, index) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">BillItem</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">bill</span>=<span class="hljs-string">&#123;item&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span>)</span><br><span class="xml">          &#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Pull</span>&gt;</span> : null</span><br><span class="xml">      &#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">PopupType</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;typeRef&#125;</span> <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;select&#125;</span> /&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>添加类型选择弹窗注意几个点：</p>
<p>1、使用 <code>useState</code> 声明好类型字段。 2、通过 <code>useRef</code> 声明的 ref 给到 <code>PopupType</code> 组件，便于控制内部的方法。 3、传递 <code>onSelect</code> 方法，获取到弹窗内部选择的类型。 4、<code>useEffect</code> 第二个参数，添加一个 <code>currentSelect</code> 以来，便于修改的时候，触发列表的重新渲染。</p>
<p>有一个有趣的知识点，这里和大家分享一下，你尝试去打印 <code>typeRef</code> 变量，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c7b0f79094c436d8ee0d089b35acc46~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>可以看到，在 <code>PopupType</code> 组件内挂载的方法，可以在父组件内获取到，那么我们便可以直接把弹窗的显示隐藏参数放在子组件内维护，而不用每次都去在父组件声明 <code>show</code> 或 <code>hide</code>。</p>
<p>加完类型筛选之后，我们再将时间筛选加上，同样将时间筛选添加至 <code>components</code> 目录下，便于后续数据页面的时间筛选。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// PopupDate/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; forwardRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;prop-types&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Popup, DatePicker &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dayjs&quot;</span>;<br><br><span class="hljs-keyword">const</span> PopupDate = forwardRef(<span class="hljs-function">(<span class="hljs-params">&#123; onSelect, mode = <span class="hljs-string">&quot;date&quot;</span> &#125;, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = useState(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [now, setNow] = useState(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<br><br>  <span class="hljs-keyword">const</span> choseMonth = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setNow(item);<br>    setShow(<span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">if</span> (mode == <span class="hljs-string">&quot;month&quot;</span>) &#123;<br>      onSelect(dayjs(item).format(<span class="hljs-string">&quot;YYYY-MM&quot;</span>));<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mode == <span class="hljs-string">&quot;date&quot;</span>) &#123;<br>      onSelect(dayjs(item).format(<span class="hljs-string">&quot;YYYY-MM-DD&quot;</span>));<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-keyword">if</span> (ref) &#123;<br>    ref.current = &#123;<br>      <span class="hljs-attr">show</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">true</span>);<br>      &#125;,<br>      <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        setShow(<span class="hljs-literal">false</span>);<br>      &#125;,<br>    &#125;;<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Popup</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;show&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">direction</span>=<span class="hljs-string">&quot;bottom&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">onMaskClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">      destroy=&#123;false&#125;</span><br><span class="xml">      mountContainer=&#123;() =&gt; document.body&#125;</span><br><span class="xml">    &gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">DatePicker</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;show&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;now&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">mode</span>=<span class="hljs-string">&#123;mode&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">onOk</span>=<span class="hljs-string">&#123;choseMonth&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">onCancel</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(false)&#125;</span><br><span class="xml">        /&gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Popup</span>&gt;</span></span><br>  );<br>&#125;);<br><br>PopupDate.propTypes = &#123;<br>  <span class="hljs-attr">mode</span>: PropTypes.string, <span class="hljs-comment">// 日期模式</span><br>  <span class="hljs-attr">onSelect</span>: PropTypes.func, <span class="hljs-comment">// 选择后的回调</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> PopupDate;<br></code></pre></td></tr></table></figure>

<p>底部时间弹窗逻辑和类型选择的逻辑相似，这里不做赘述，直接在 <code>Home/index.jsx</code> 中引入时间筛选框：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Home/index.jsx</span><br>...<br><span class="hljs-keyword">import</span> PopupDate <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/PopupDate&#x27;</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> monthRef = useRef(); <span class="hljs-comment">// 月份筛选 ref</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getBillList() <span class="hljs-comment">// 初始化</span><br>  &#125;, [page, currentSelect, currentTime])<br><br>  ...<br><br>  <span class="hljs-comment">// 选择月份弹窗</span><br>  <span class="hljs-keyword">const</span> monthToggle = <span class="hljs-function">() =&gt;</span> &#123;<br>    monthRef.current &amp;&amp; monthRef.current.show()<br>  &#125;;<br><br>  <span class="hljs-comment">// 筛选月份</span><br>  <span class="hljs-keyword">const</span> selectMonth = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setRefreshing(REFRESH_STATE.loading);<br>    setPage(<span class="hljs-number">1</span>);<br>    setCurrentTime(item)<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.home&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.right&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;monthToggle&#125;</span>&gt;</span>&#123; currentTime &#125;<span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.arrow&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-bottom&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml"></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">PopupDate</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;monthRef&#125;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;month&quot;</span> <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;selectMonth&#125;</span> /&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>刷新浏览器如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/847ab58538134cdcb8d819d61823a5a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>最后不要忘记计算当前月份的收入和支出汇总数据，放置于头部，修改 <code>Home/index.jsx</code> 内的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> [totalExpense, setTotalExpense] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 总支出</span><br>  <span class="hljs-keyword">const</span> [totalIncome, setTotalIncome] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 总收入</span><br><br>  <span class="hljs-keyword">const</span> getBillList = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">`/api/bill/list?page=<span class="hljs-subst">$&#123;page&#125;</span>&amp;page_size=5&amp;date=<span class="hljs-subst">$&#123;currentTime&#125;</span>&amp;type_id=<span class="hljs-subst">$&#123;currentSelect.id || <span class="hljs-string">&#x27;all&#x27;</span>&#125;</span>`</span>);<br>    <span class="hljs-comment">// 下拉刷新，重制数据</span><br>    <span class="hljs-keyword">if</span> (page == <span class="hljs-number">1</span>) &#123;<br>      setList(data.list);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      setList(list.concat(data.list));<br>    &#125;<br>    setTotalExpense(data.totalExpense.toFixed(<span class="hljs-number">2</span>));<br>    setTotalIncome(data.totalIncome.toFixed(<span class="hljs-number">2</span>));<br>    setTotalPage(data.totalPage);<br>    <span class="hljs-comment">// 上滑加载状态</span><br>    setLoading(LOAD_STATE.success);<br>    setRefreshing(REFRESH_STATE.success);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> &lt;div className=&#123;s.home&#125;&gt;<br>    ...<br>    &lt;div className=&#123;s.dataWrap&#125;&gt;<br>      &lt;span className=&#123;s.expense&#125;&gt;总支出：&lt;b&gt;¥ &#123; totalExpense &#125;&lt;/b&gt;&lt;/span&gt;<br>      &lt;span className=&#123;s.income&#125;&gt;总收入：&lt;b&gt;¥ &#123; totalIncome &#125;&lt;/b&gt;&lt;/span&gt;<br>    &lt;/div&gt;<br>    ...<br>  &lt;div&gt;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最终展示效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17747f5d0d7b41eabcbe47e8dc633de7~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本章节的内容，偏向实战，而实战部分代码在文章的重复率不可避免，这里大家把握好本章节两个重要知识点：</p>
<p>1、无限加载、下拉刷新。</p>
<p>2、公用组件提取，如弹窗组件、账单组件。</p>
<p>这两个知识点在实战中，用到的非常多，希望同学们能重视。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/08/114-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/08/114-react/" class="post-title-link" itemprop="url">114、稀土掘金小册-记账本（五）登录注册</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-08 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-08T20:00:00+08:00">2023-01-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:56:04" itemprop="dateModified" datetime="2023-08-15T10:56:04+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>上一章节我们实现了底部导航栏，并且创建了三个主页面，这三个页面是需要展示底部导航栏，而我们本章节要制作的「登录注册页面」便是不需要底部导航栏的单独页面。</p>
<blockquote>
<p>本教程已有线上地址<a href="https://link.juejin.cn/?target=http://cost.chennick.wang">在线地址</a>，同学们可以在实战部分，对照着线上页面进行学习。</p>
</blockquote>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p>组件：<code>Cell</code>、<code>Input</code>、<code>Button</code>、<code>CheckBox</code>。</p>
<h2 id="注册页面"><a href="#注册页面" class="headerlink" title="注册页面"></a>注册页面</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ff7150ab666463faf49a280bded1d9b~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>我们的系统是面向多用户的，换句话说也就是一个纯正的 C 端项目，任何人都可以通过网站，注册一个新的账号。接下来开始注册页面的编写。</p>
<p>首先新建 <code>Login</code> 文件夹，在文件夹内添加两个文件 <code>index.jsx</code> 和 <code>style.module.less</code>，我们先把注册页面的静态页面切出来，首先给 <code>index.jsx</code> 添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Login = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.auth&#125;</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Login;<br></code></pre></td></tr></table></figure>

<p>为它添加一个路由配置，打开 <code>router/index.js</code> 添加如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Login <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/container/Login&#x27;</span><br>...<br>&#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/login&quot;</span>,<br>  <span class="hljs-attr">component</span>: Login<br>&#125;<br></code></pre></td></tr></table></figure>

<p>重启项目，如下所示代表登录注册页面创建成功了：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70072a5101314b52a83e7675deb6a205~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>接下来为 <code>Login/index.jsx</code> 添加静态页面代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Cell, Input, Button, Checkbox &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/CustomIcon&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Login = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.auth&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.head&#125;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.tab&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.form&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;zhanghao&quot;</span> /&gt;</span>&#125;&gt;</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">clearable</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入账号&quot;</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mima&quot;</span> /&gt;</span>&#125;&gt;</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">clearable</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入密码&quot;</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mima&quot;</span> /&gt;</span>&#125;&gt;</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">clearable</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入验证码&quot;</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.operation&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.agree&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Checkbox</span> /&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-light&quot;</span>&gt;</span></span><br><span class="xml">            阅读并同意<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>《掘掘手札条款》<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">block</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span>&gt;</span></span><br><span class="xml">          注册</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Login;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>上述代码中，关键部分是账号输入、密码输入、验证码输入，这三个输入框是需要获取数据作为接口的参数提交上去的。</p>
<p>很多时候，服务端没有开发好接口的时候，我们前端要做的任务就是先还原 <code>UI</code> 稿，把该切的页面都切出来，并且预留好需要给接口提交的数据交互，比如上述三个输入框。</p>
<p>样式编写部分，要注意的一点是 <code>:global</code> 这个关键词。由于我们采用的是 <code>CSS Module</code> 的形式进行开发，也就是你在页面中声明的类名都会根据当前页面，打一个唯一的 <code>hash</code> 值，比如我们页面中声明的 <code>className=&#123;s.form&#125;</code>，最终在浏览器中显示的是这样的：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bab558e802d84ccd8c0b4273fe1e6174~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p><code>_form_kpur3_30</code> 是已经被编译过的样式，这样做的目的是避免和别的页面的样式重名，这是目前样式管理的一个诟病，当多人参与项目开发的时候，很难做到不污染全局样式名称，除非很小心的命名样式名称。</p>
<p>所以经过编译之后，想要修改 <code>.form</code> 下的 <code>.za-cell</code>，如下写法，将无法修改成功：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.form</span> &#123;<br>  <span class="hljs-selector-class">.za-cell</span> &#123;<br>    <span class="hljs-attribute">color</span>: red;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>原因是，上述写法，<code>.za-cell</code> 会被编译加上 <code>hash</code>，组件库 <code>Zarm</code> 内的 <code>dom</code> 类名还是叫 <code>za-cell</code>，如上图所示。所以为了不加 <code>hash</code>，就需要这样操作：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.form</span> &#123;<br>  :global &#123;<br>    .za-cell &#123;<br>      color: red;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这样 <code>.za-cell</code> 就不会被加上 <code>hash</code>，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/580f03ce2daf4f4488edd73c9a1efae6~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>完成上述页面布局之后，你会看到这样一个效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2933714025354b66ac111139397aa2d0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>少了一个验证码，我们使用插件 <code>react-captcha-code</code>，我们通过 <code>npm</code> 下载它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i react-captcha-code -S<br></code></pre></td></tr></table></figure>

<p>在代码中引入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> Captcha <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-captcha-code&quot;</span><br>...<br>&lt;Input<br>  clearable<br>  type=<span class="hljs-string">&quot;text&quot;</span><br>  placeholder=<span class="hljs-string">&quot;请输入验证码&quot;</span><br>  onChange=&#123;<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> setVerify(value)&#125;<br>/&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Captcha</span> <span class="hljs-attr">charNum</span>=<span class="hljs-string">&#123;4&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>浏览器展示如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa07ed8b505a421bb3d9120ba8741cac~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时我们已经切完注册页面需要的内容。</p>
<p>我们给页面加上相应的逻辑，首先是账号、密码、验证码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">const</span> [username, setUsername] = useState(<span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// 账号</span><br><span class="hljs-keyword">const</span> [password, setPassword] = useState(<span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// 密码</span><br><span class="hljs-keyword">const</span> [verify, setVerify] = useState(<span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// 验证码</span><br>...<br>&lt;Input<br>  clearable<br>  type=<span class="hljs-string">&quot;text&quot;</span><br>  placeholder=<span class="hljs-string">&quot;请输入账号&quot;</span><br>  onChange=&#123;<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> setUsername(value)&#125;<br>/&gt;<br>...<br>&lt;Input<br>  clearable<br>  type=<span class="hljs-string">&quot;password&quot;</span><br>  placeholder=<span class="hljs-string">&quot;请输入密码&quot;</span><br>  onChange=&#123;<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> setPassword(value)&#125;<br>/&gt;<br>...<br>&lt;Input<br>  clearable<br>  type=<span class="hljs-string">&quot;text&quot;</span><br>  placeholder=<span class="hljs-string">&quot;请输入验证码&quot;</span><br>  onChange=&#123;<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> setVerify(value)&#125;<br>/&gt;<br></code></pre></td></tr></table></figure>

<p>当输入框内容修改的时候，<code>onChange</code> 会被触发，接受的回调函数参数，便是变化的输入值，此时我们将其保存在声明的变量中。</p>
<p>我们输入的验证码是需要和验证码图片里的验证码匹配的，所以我们还需要拿到图片里的验证码，我们作如下操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useCallback &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br>...<br><span class="hljs-keyword">const</span> [captcha, setCaptcha] = useState(<span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// 验证码变化后存储值</span><br><span class="hljs-comment">//  验证码变化，回调方法</span><br><span class="hljs-keyword">const</span> handleChange = useCallback(<span class="hljs-function">(<span class="hljs-params">captcha</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;captcha&#x27;</span>, captcha)<br>  setCaptcha(captcha)<br>&#125;, []);<br>...<br>&lt;Captcha charNum=&#123;<span class="hljs-number">4</span>&#125; onChange=&#123;handleChange&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p>当验证码变化的时候，便能获取到相应的值。修改完上述代码，我们不妨测试一下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68459ab851c941ee92f3fcdaf6f758a6~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>到此，注册需要的参数都有了，我们开始编写注册方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; Cell, Input, Button, Checkbox, Toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zarm&#x27;</span><br><span class="hljs-keyword">import</span> &#123; post &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils&#x27;</span><br>...<br><span class="hljs-keyword">const</span> onSubmit = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!username) &#123;<br>    Toast.show(<span class="hljs-string">&#x27;请输入账号&#x27;</span>)<br>    <span class="hljs-keyword">return</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (!password) &#123;<br>    Toast.show(<span class="hljs-string">&#x27;请输入密码&#x27;</span>)<br>    <span class="hljs-keyword">return</span><br>  &#125;<br>  <span class="hljs-keyword">if</span> (!verify) &#123;<br>    Toast.show(<span class="hljs-string">&#x27;请输入验证码&#x27;</span>)<br>    <span class="hljs-keyword">return</span><br>  &#125;;<br>  <span class="hljs-keyword">if</span> (verify != captcha) &#123;<br>    Toast.show(<span class="hljs-string">&#x27;验证码错误&#x27;</span>)<br>    <span class="hljs-keyword">return</span><br>  &#125;;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&#x27;/api/user/register&#x27;</span>, &#123;<br>      username,<br>      password<br>    &#125;);<br>    Toast.show(<span class="hljs-string">&#x27;注册成功&#x27;</span>);<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    Toast.show(<span class="hljs-string">&#x27;系统错误&#x27;</span>);<br>  &#125;<br>&#125;;<br>...<br>&lt;Button onClick=&#123;onSubmit&#125; block theme=<span class="hljs-string">&quot;primary&quot;</span>&gt;注册&lt;/Button&gt;<br></code></pre></td></tr></table></figure>

<p>上述代码中，因为我们使用的是 <code>async await</code> 做异步处理，所以需要通过 <code>try catch</code> 来捕获异步处理过程中出现的错误，如果使用 <code>Promise</code> 的回调函数，则无需使用 <code>try catch</code>，改动如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">post(<span class="hljs-string">&quot;/api/user/register&quot;</span>, &#123;<br>  username,<br>  password,<br>&#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// do something</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p>尝试使用之前注册过的用户名，注册一个账号：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4e36ba2f6724445a821b444dda9643f~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>服务端给出正确的报错，我们再用一个未注册过的用户名：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6eb9d6a0ade945589835a6add7c87e99~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时我们大致将注册功能实现了。这里我不再展开讲样式部分，因为这样会使得文章中出现过多的重复代码，不以阅读，大家尽量根据标签的类名去查找 <code>css</code> 样式部分。</p>
<h2 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h2><p>登录页面的逻辑我们直接做到同一个页面中，通过一个 <code>type</code> 参数作为判断条件，判断当前状态是登录页面或是注册页面。</p>
<p>话不多说我们添加代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> cx <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;classnames&#x27;</span><br>...<br><br><span class="hljs-keyword">const</span> Login = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> [type, setType] = useState(<span class="hljs-string">&#x27;login&#x27;</span>); <span class="hljs-comment">// 登录注册类型</span><br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.auth&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.tab&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(&#123;</span> [<span class="hljs-attr">s.avtive</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">type</span> == <span class="hljs-string">&#x27;login&#x27;</span> &#125;)&#125; <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setType(&#x27;login&#x27;)&#125;&gt;登录<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(&#123;</span> [<span class="hljs-attr">s.avtive</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">type</span> == <span class="hljs-string">&#x27;register&#x27;</span> &#125;)&#125; <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setType(&#x27;register&#x27;)&#125;&gt;注册<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.form&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    &#123;</span><br><span class="xml">      type == &#x27;register&#x27; ? <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;mima&quot;</span> /&gt;</span>&#125;&gt;</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">clearable</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入验证码&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> setVerify(value)&#125;</span><br><span class="xml">        /&gt;</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Captcha</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;captchaRef&#125;</span> <span class="hljs-attr">charNum</span>=<span class="hljs-string">&#123;4&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span> : null</span><br><span class="xml">    &#125;</span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.operation&#125;</span>&gt;</span></span><br><span class="xml">    &#123;</span><br><span class="xml">      type == &#x27;register&#x27; ? <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.agree&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Checkbox</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;text-light&quot;</span>&gt;</span>阅读并同意<span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>《掘掘手札条款》<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> : null</span><br><span class="xml">    &#125;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onSubmit&#125;</span> <span class="hljs-attr">block</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span>&gt;</span>&#123;type == &#x27;login&#x27; ? &#x27;登录&#x27; : &#x27;注册&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果引入了新的工具包，请自行安装，如上述代码就需要安装 classnames。可以通过 npm i classnames -S 指令</p>
</blockquote>
<p>代码分析：</p>
<p>上述代码中，通过 <code>type</code> 属性区分注册和登录。</p>
<p>首先是 <code>tab</code> 切换，通过 <code>classname</code> 来判断是否是当前高亮，用于样式控制。</p>
<p>其次，当 <code>type == &#39;register&#39;</code> 的时候，才把验证码展示出来，因为登录这边咱们就不设置验证码，只在注册的时候显示。</p>
<p>最后是事件的判断，如果 <code>type == &#39;login&#39;</code>，则按钮文案显示为 <code>登录</code>，否则为 <code>注册</code>。</p>
<p>此时点击触发的 <code>onSubmit</code> 事件也很关键，同样需要通过 <code>type</code> 判断是登录还是注册，修改代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> onSubmit = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!username) &#123;<br>    Toast.show(<span class="hljs-string">&quot;请输入账号&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!password) &#123;<br>    Toast.show(<span class="hljs-string">&quot;请输入密码&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// 判断是否是登录状态</span><br>    <span class="hljs-keyword">if</span> (type == <span class="hljs-string">&quot;login&quot;</span>) &#123;<br>      <span class="hljs-comment">// 执行登录接口，获取 token</span><br>      <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&quot;/api/user/login&quot;</span>, &#123;<br>        username,<br>        password,<br>      &#125;);<br>      <span class="hljs-comment">// 将 token 写入 localStorage</span><br>      <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&quot;token&quot;</span>, data.token);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">if</span> (!verify) &#123;<br>        Toast.show(<span class="hljs-string">&quot;请输入验证码&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (verify != captcha) &#123;<br>        Toast.show(<span class="hljs-string">&quot;验证码错误&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&quot;/api/user/register&quot;</span>, &#123;<br>        username,<br>        password,<br>      &#125;);<br>      Toast.show(<span class="hljs-string">&quot;注册成功&quot;</span>);<br>      <span class="hljs-comment">// 注册成功，自动将 tab 切换到 login 状态</span><br>      setType(<span class="hljs-string">&quot;login&quot;</span>);<br>    &#125;<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    Toast.show(<span class="hljs-string">&quot;系统错误&quot;</span>);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>由于登录注册的账号和密码是同一参数，我们这边就直接复用了逻辑，并通过 <code>type</code> 判断调用哪一个接口。</p>
<p>重启项目，验证登录接口是否成功，如果成功则会返回 <code>token</code> 信息，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79260001863b4fcc9f9d52522a7732fb~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时，我们本地的 <code>localStorage</code> 里，已经存下了 <code>token</code>，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cac2dd5459b4fab8ccb7bb476719944~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>保存 <code>token</code> 的形式有很多，你可以引入状态管理插件来对这些数据进行存储，但是这里我们对其进行简单处理，减少项目多余的负担，保证课程的完成度。有时候，成功的将课程完成，也是一种成就感。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>到此，我们的登录注册页面算是完成了，我们拿到的 <code>token</code> 是有时效性的，我在后台设置的是 24 小时的时效，如果过期了，请求其他接口时，就会报错，从而通过逻辑判断重新回到登录页面。下一章节，我会详细分析这块内容。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/05/113-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/05/113-react/" class="post-title-link" itemprop="url">113、稀土掘金小册-记账本（四）底部导航栏</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-05 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-05T20:00:00+08:00">2023-01-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:56:18" itemprop="dateModified" datetime="2023-08-15T10:56:18+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>上一章节，我们从 0 开始搭建出一套以 <code>React</code> 技术栈为基础的前端开发环境，过程中肯定会遇到各种奇奇怪怪的问题，比如 <code>Node</code> 版本问题，工具包的版本问题，插件下载完之后，无法得到自己想要的效果等等，为了大家能顺畅地进行开发，请大家尽量将项目中用到的 <code>node_module</code> 包版本和我提供给大家的项目中的版本，保持一致。</p>
<p>倘若你学会了这一套搭建流程，我希望你能举一反三，根据项目需求，灵活的切换组件库、PC 版、甚至是主框架。这对提升自己的知识广度很有帮助，因为相比每次都看教程，自己手动实现一遍，印象会更深刻，遇到问题也能通过自己的认知，去解决它。</p>
<p>扯得有点远了，本章节我们将正式进入前端实战环节。</p>
<blockquote>
<p>本教程已有线上地址<a href="https://link.juejin.cn/?target=http://cost.chennick.wang">在线地址</a>，同学们可以在实战部分，对照着线上页面。</p>
</blockquote>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>编写底部导航栏</li>
<li>创建图标公用组件</li>
<li>路由控制底部导航栏的显隐</li>
</ul>
<h2 id="编写底部导航栏"><a href="#编写底部导航栏" class="headerlink" title="编写底部导航栏"></a>编写底部导航栏</h2><p>我们先观察我们今天要实现的底部导航长啥样，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88b876655d1d4cc98bc64701893070f4~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>上图红框中的底部导航栏，在很多业务场景下都是需要的，三个导航栏对应着三个不同的三个页面组件，分别是「账单」、「统计」、「我的」。这三个页面组件是需要导航栏的。如果我们点击内页如账单详情页，则底部的导航栏会被隐藏，这就需要我们在导航栏的控制上，下一些功夫。</p>
<p>话不多说，我们在上一章的代码基础上添加导航栏组件，在 <code>src</code> 目录下新建 <code>components</code> 目录，专门用于放置一些公用组件，我们再在 <code>components</code> 目录下新建 <code>NavBar</code> 目录，用于编写底部导航栏，代码如下所示：</p>
<p><strong>Nav/index.jsx</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;prop-types&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; TabBar &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> NavBar = <span class="hljs-function">(<span class="hljs-params">&#123; showNav &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [activeKey, setActiveKey] = useState(<span class="hljs-string">&quot;/&quot;</span>);<br>  <span class="hljs-keyword">const</span> navigateTo = useNavigate();<br><br>  <span class="hljs-keyword">const</span> changeTab = <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> &#123;<br>    setActiveKey(path);<br>    navigateTo(path);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TabBar</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">visible</span>=<span class="hljs-string">&#123;showNav&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.tab&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">activeKey</span>=<span class="hljs-string">&#123;activeKey&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;changeTab&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">    &gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TabBar.Item</span> <span class="hljs-attr">itemKey</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;账单&quot;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TabBar.Item</span> <span class="hljs-attr">itemKey</span>=<span class="hljs-string">&quot;/data&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;统计&quot;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TabBar.Item</span> <span class="hljs-attr">itemKey</span>=<span class="hljs-string">&quot;/user&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;我的&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">TabBar</span>&gt;</span></span><br>  );<br>&#125;;<br><br>NavBar.propTypes = &#123;<br>  <span class="hljs-attr">showNav</span>: PropTypes.bool,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> NavBar;<br></code></pre></td></tr></table></figure>

<p>代码解析：</p>
<p>首先是声明 <code>NavBar</code> 函数组件，它接收一个外部传入的 <code>showNav</code> 属性，用于控制导航栏的显示隐藏。</p>
<p>通过 <code>useNavigate</code> 钩子方法，拿到路由实例 <code>navigateTo</code>，它内部含有很多路由的方法，在上述代码中，我们使用到的是 <code>navigateTo</code> 进行路由跳转。</p>
<p>在页面中，引入 <code>TabBar</code> 组件，它接受几个属性：</p>
<ul>
<li>visible：用于控制导航栏的显示隐藏。</li>
<li>activeKey：当前被点击的导航栏。</li>
<li>onChange：点击导航栏之后的回调方法，<code>path</code> 参数为 <code>TabBar.Item</code> 的 <code>itemKey</code> 属性。</li>
</ul>
<blockquote>
<p>TabBar 官方文档：<a href="https://link.juejin.cn/?target=https://zarm.gitee.io/%23/components/tab-bar">zarm.gitee.io/#/component…</a></p>
</blockquote>
<p>所以当你点击导航栏的时候，<code>changeTab</code> 方法便会被触发，执行内部的 <code>setActiveKey</code> 和 <code>navigateTo</code>，他们的作用分别是设置当前点击的高亮和让页面跳转到对应的页面组件。</p>
<p>说到跳转到对应的组件，’/‘、’/data’、’/user’ 这三个路由对应的三个组件我们还未编写，这里我们在 <code>container</code> 目录下新建这三个页面组件，作为占位。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Home/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Home<br><br><span class="hljs-comment">// Data/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">const</span> Data = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>数据<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Data<br><br><span class="hljs-comment">// User/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">const</span> User = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>个人中心<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> User<br></code></pre></td></tr></table></figure>

<p>别忘了，前往 <code>router/index.js</code> 添加路由配置，如果不添加这个配置，调用 <code>navigateTo</code> 这个方法，就无法匹配到对应的页面组件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// router/index.js</span><br><span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/container/Home&quot;</span>;<br><span class="hljs-keyword">import</span> Data <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/container/Data&quot;</span>;<br><span class="hljs-keyword">import</span> User <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/container/User&quot;</span>;<br><br><span class="hljs-keyword">const</span> routes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>    <span class="hljs-attr">component</span>: Home,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/data&quot;</span>,<br>    <span class="hljs-attr">component</span>: Data,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/user&quot;</span>,<br>    <span class="hljs-attr">component</span>: User,<br>  &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> routes;<br></code></pre></td></tr></table></figure>

<p>这时，我们还缺少一步，将导航栏组件引入 <code>App.jsx</code> 入口页面，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// App.jsx</span><br>...<br><span class="hljs-keyword">import</span> NavBar <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/NavBar&#x27;</span>;<br>...<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span> <span class="hljs-attr">primaryColor</span>=<span class="hljs-string">&#123;</span>&#x27;#<span class="hljs-attr">007fff</span>&#x27;&#125;&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;&gt;</span></span><br><span class="xml">       <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="xml">        &#123;routes.map(route =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;route.path&#125;</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#123;route.path&#125;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">route.component</span> /&gt;</span>&#125; /&gt;)&#125;</span><br><span class="xml">       <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span> <span class="hljs-attr">showNav</span>=<span class="hljs-string">&#123;showNav&#125;</span> /&gt;</span></span><br><span class="xml">     <span class="hljs-tag">&lt;/&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span><br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span> <span class="hljs-attr">showNav</span>=<span class="hljs-string">&#123;true&#125;</span> /&gt;</span></span><br>  &lt;/Router&gt;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>通过 <code>npm run dev</code> 启动项目，浏览器展示效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39ce0d3387fd41df97db10b054a6ae0a~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>上图效果所示，注意地址栏的变化，点击相应的 <code>Tab</code>，调用的 <code>navigateTo</code> 方法，将地址栏的 <code>pathname</code> 改变，随之而来的是页面组件的改变。这个就应证了我们第 10 章给大家解释的单页面路由控制的原理。<code>navigateTo</code> 做的事情就是改变地址栏，地址栏一旦改变，就会触发地址所对应的组件渲染，如 <code>/data</code>，渲染的就是 <code>Data</code> 页面组件。</p>
<p>你会问为什么导航栏会一直显示在底部，我们来分析以下代码：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/13d46f4c1f214b4bae40240bccff4fbe~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>红色框是组件展示的区域，每个路径对应着一个组件，这个在 <code>router/index.js</code> 文件中也有所体现。</p>
<p>绿色框则代表导航栏的位置，也就是说，无论上面的组件怎么变化，底部的导航栏一直都是存在的。</p>
<h3 id="添加底部导航图标"><a href="#添加底部导航图标" class="headerlink" title="添加底部导航图标"></a>添加底部导航图标</h3><p>我们将图标写成公共组件，这样便于后面各个页面方便引入，我们新建 <code>components/CustomIcon/index.jsx</code>，添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Icon.createFromIconfont(<br>  <span class="hljs-string">&quot;//at.alicdn.com/t/font_2236655_w1mpqp7n1ni.js&quot;</span><br>);<br></code></pre></td></tr></table></figure>

<p>上述代码，我们引入 <code>Icon</code>，执行它的自定义图标方法 <code>createFromIconfont</code>，它接收一个参数，为 <code>iconfont</code> 生产的静态脚本路径，你可以自己去 <a href="https://link.juejin.cn/?target=https://www.iconfont.cn/">官网</a> 配置，也可以直接用我提供的：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fe4857973a74a78a2cc2d2110e49c34~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>这里我已经为大家添加好了各个图标，地址就是上述代码的地址。</p>
<p>接着我们将其引入到代码中使用，打开 <code>components/NavBar/index.jsx</code> ，添加如下属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../CustomIcon&#x27;</span>;<br>...<br>&lt;TabBar.Item<br>  itemKey=<span class="hljs-string">&quot;/&quot;</span><br>  title=<span class="hljs-string">&quot;账单&quot;</span><br>  icon=&#123;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;zhangdan&quot;</span> /&gt;</span></span>&#125;<br>/&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TabBar.Item</span></span></span><br><span class="hljs-tag"><span class="xml">  <span class="hljs-attr">itemKey</span>=<span class="hljs-string">&quot;/data&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">  <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;统计&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">  <span class="hljs-attr">icon</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;tongji&quot;</span> /&gt;</span>&#125;</span><br><span class="xml">/&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TabBar.Item</span></span></span><br><span class="hljs-tag"><span class="xml">  <span class="hljs-attr">itemKey</span>=<span class="hljs-string">&quot;/user&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">  <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;我的&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">  <span class="hljs-attr">icon</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;wode&quot;</span> /&gt;</span>&#125;</span><br><span class="xml">/&gt;</span><br></code></pre></td></tr></table></figure>

<p>查看浏览器展示效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f7b75bd787a402795887b4893924916~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="底部导航栏的显示隐藏"><a href="#底部导航栏的显示隐藏" class="headerlink" title="底部导航栏的显示隐藏"></a>底部导航栏的显示隐藏</h2><p>我们在之前引入 <code>NavBar</code> 的代码中，将 <code>showNav</code> 属性写死为 <code>true</code>。此时，我们需要将其盘活，打开 <code>App.jsx</code>，添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<br>  BrowserRouter <span class="hljs-keyword">as</span> Router,<br>  Routes,<br>  Route,<br>  useLocation,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><br><span class="hljs-keyword">import</span> NavBar <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/NavBar&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; ConfigProvider &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">import</span> routes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/router&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> location = useLocation(); <span class="hljs-comment">// 拿到 location 实例</span><br>  <span class="hljs-keyword">const</span> &#123; pathname &#125; = location; <span class="hljs-comment">// 获取当前路径</span><br>  <span class="hljs-keyword">const</span> needNav = [<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/data&quot;</span>, <span class="hljs-string">&quot;/user&quot;</span>]; <span class="hljs-comment">// 需要底部导航栏的路径</span><br>  <span class="hljs-keyword">const</span> [showNav, setShowNav] = useState(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 是否展示 Nav</span><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    setShowNav(needNav.includes(pathname));<br>  &#125;, [pathname]); <span class="hljs-comment">// [] 内的参数若是变化，便会执行上述回调函数=</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span> <span class="hljs-attr">primaryColor</span>=<span class="hljs-string">&#123;</span>&quot;#<span class="hljs-attr">007fff</span>&quot;&#125;&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Switch</span>&gt;</span></span><br><span class="xml">          &#123;routes.map((route) =&gt; (</span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;route.path&#125;</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#123;route.path&#125;</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">route.component</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br><span class="xml">          ))&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Switch</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span> <span class="hljs-attr">showNav</span>=<span class="hljs-string">&#123;true&#125;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;<br></code></pre></td></tr></table></figure>

<p>当你刷新浏览器，控制台应该会报下面的错误：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3a8e99d9b4346ada136f513486912e6~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>执行 <code>useLocation</code> 时，报错 <code>location of undefined</code>。这是因为想要在函数组件内执行 <code>useLocation</code>，该组件必须被 <code>Router</code> 高阶组件包裹，我们做如下改动，将 <code>App.jsx</code> 的 <code>Router</code> 组件，前移到 <code>main.jsx</code> 内，如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b13889ca74b84460bb6205555cbc75fd~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>逻辑分析：</p>
<p>我们拿到 <code>pathname</code>，将其设置为 <code>useEffect</code> 钩子函数的第二个参数，监听它的变化，一旦 <code>pathname</code> 变化，便会触发回调函数执行 <code>setShowNav(needNav.includes(pathname))</code>，结果会传递给 <code>NavBar</code> 组件，从而控制组件的显示隐藏。<code>needNav</code> 为需要底部导航的路径值。</p>
<p>我们不妨做个测试，在 <code>container</code> 目录下新建一个测试页面组件 <code>Detail</code>，并且添加路由配置。</p>
<p>别忘记把组件属性修改成动态变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;NavBar showNav=&#123;showNav&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p>查看浏览器的展示效果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c659b2430bab4985a86c2519eac7d62e~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>导航栏可以用在很多地方，映射到 <code>PC</code> 网页就是左侧侧边导航，道理都是相通的。移动端放在下面控制，<code>PC</code> 端放在左边或者右边控制罢了。所以再次强调不要学完了一个知识点，就思维定势地认为只能用在某一个需求上，能做到融会贯通，才是判断一个好程序员的标准。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/04/112-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/04/112-react/" class="post-title-link" itemprop="url">112、稀土掘金小册-记账本（三）react vite2.0 ZarmUI搭建开发环境</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-04 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-04T20:00:00+08:00">2023-01-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:56:33" itemprop="dateModified" datetime="2023-08-15T10:56:33+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>React</code> 技术栈的 <code>UI</code> 组件库相比 <code>Vue</code>，会少一些。我们耳熟能详的便是 <code>Antd</code>，但是它针对的是 <code>PC</code> 端的，我们的项目目前是一个 <code>H5</code> 的网页（不排除后期做一个 PC 端）。所以我选择了 <a href="https://link.juejin.cn/?target=https:https://zarm.gitee.io/%23/">Zarm</a>。</p>
<p>这里再次强调，不是 <code>Zarm</code> 就比别的移动端组件库好，只是目前我开发的这款记账本项目，<code>Zarm</code> 比较适合。</p>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>构架工具 <code>Vite</code>。</li>
<li>前端框架 <code>React</code> 和路由 <code>react-router-dom</code>。</li>
<li><code>CSS</code> 预加载器 <code>Less</code>。</li>
<li><code>HTTP</code> 请求库 <code>axios</code>。</li>
<li>移动端分辨率适配 <code>flexible</code>。</li>
<li>跨域代理。</li>
</ul>
<h2 id="初始化-Vite-React-项目"><a href="#初始化-Vite-React-项目" class="headerlink" title="初始化 Vite + React 项目"></a>初始化 Vite + React 项目</h2><p><code>Vite</code> 官方提供两种初始化项目的方式，一种是如下所示，可以自由选择需要的前端框架。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm init @vitejs/app<br></code></pre></td></tr></table></figure>

<p>另一种则是直接用官方提供的模板，一键生成项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># npm 6.x</span><br>npm init @vitejs/app react-vite-h5 --template react<br><br><span class="hljs-comment"># npm 7+, 需要额外的双横线：</span><br>npm init @vitejs/app react-vite-h5 -- --template react<br></code></pre></td></tr></table></figure>

<p>我们使用第二种方式初始化项目，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32661c92fce54016949d56b5a57399ba~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>安装完 <code>node_modules</code> 之后，通过 <code>npm run dev</code> 启动项目，如下所示代表成功了：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/874d34fcf2394af585b2c42a11cef607~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="引入路由插件-react-router-dom"><a href="#引入路由插件-react-router-dom" class="headerlink" title="引入路由插件 react-router-dom"></a>引入路由插件 react-router-dom</h2><p>没有路由的项目，那就不是一个完整项目，而是一个页面而已。真实项目都是存在各种模块之间的切换，各个模块的功能组合在一起才能叫做一个项目。</p>
<p>首选安装 <code>react-router-dom</code>，指令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i react-router-dom -S<br></code></pre></td></tr></table></figure>

<p>在项目 <code>src</code> 目录下新增 <code>container</code> 目录用于放置页面组件，再在 <code>container</code> 下新增两个目录分别是 <code>Index</code> 和 <code>About</code> ，添加如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Index/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Index</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    Index</span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-comment">// About/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">About</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    About</span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>再来新建 <code>src/router/index.js</code> 配置路由数组，添加如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// router/index.js</span><br><span class="hljs-keyword">import</span> Index <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../container/Index&quot;</span>;<br><span class="hljs-keyword">import</span> About <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../container/About&quot;</span>;<br><br><span class="hljs-keyword">const</span> routes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>    <span class="hljs-attr">component</span>: Index,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/about&quot;</span>,<br>    <span class="hljs-attr">component</span>: About,<br>  &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> routes;<br></code></pre></td></tr></table></figure>

<p>在 <code>App.jsx</code> 引入路由配置，实现切换浏览器路径，显示相应的组件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// App.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; BrowserRouter <span class="hljs-keyword">as</span> Router, Routes, Route &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> routes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../src/router&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="xml">        &#123;routes.map((route) =&gt; (</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">exact</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;route.path&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">path</span>=<span class="hljs-string">&#123;route.path&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">route.component</span> /&gt;</span>&#125;</span><br><span class="xml">          /&gt;</span><br><span class="xml">        ))&#125;</span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;<br></code></pre></td></tr></table></figure>

<p>启动项目 <code>npm run dev</code>，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d67090d0f61641539e3fcd9061d27474~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="引入-Zarm-UI-组件库"><a href="#引入-Zarm-UI-组件库" class="headerlink" title="引入 Zarm UI 组件库"></a>引入 Zarm UI 组件库</h2><p>首先通过如下指令安装它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install zarm -S<br></code></pre></td></tr></table></figure>

<p>修改 <code>App.jsx</code> 的代码，全局引入样式和中文包：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; BrowserRouter <span class="hljs-keyword">as</span> Router, Routes, Route &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; ConfigProvider &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> zhCN <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm/lib/config-provider/locale/zh_CN&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;zarm/dist/zarm.css&quot;</span>;<br><br><span class="hljs-keyword">import</span> routes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../src/router&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span> <span class="hljs-attr">primaryColor</span>=<span class="hljs-string">&#123;</span>&quot;#<span class="hljs-attr">007fff</span>&quot;&#125; <span class="hljs-attr">locale</span>=<span class="hljs-string">&#123;zhCN&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="xml">            &#123;routes.map((route) =&gt; (</span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">Route</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">exact</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;route.path&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">path</span>=<span class="hljs-string">&#123;route.path&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">route.component</span> /&gt;</span>&#125;</span><br><span class="xml">              /&gt;</span><br><span class="xml">            ))&#125;</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span><br>    &lt;/Router&gt;<br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> App;<br></code></pre></td></tr></table></figure>

<p>此时 <code>zarm</code> 的样式，已经全局引入了，我们先查看在 <code>/container/Index/index.jsx</code> 添加一个按钮是否生效：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Index/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Button &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Index</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      Index</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span>&gt;</span>按钮<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p>重启项目，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5196fda769074ec387a085af87b6bb92~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时恭喜你 🎉，你已经成功将组件引入项目中。</p>
<h3 id="小优化"><a href="#小优化" class="headerlink" title="小优化"></a>小优化</h3><p>组件虽然引入成功了，但是有一个问题，我不希望所有的组件样式都被一次性的引入，因为这样代码会比较冗余，我只需要引入我使用到的组件样式，实现「按需引入」。</p>
<p>我们先看看，就目前现在这个情况，打完包之后，静态资源有多大。运行指令 <code>npm run build</code> ，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba361939748e48499cab35833093c012~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>腚眼一看，全局引入样式的形式，直接打完包， <code>css</code> 静态资源就 <code>168.22kb</code> 了，我们尝试配置「按需引入」。</p>
<p>首先我们安装一个插件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i vite-plugin-style-import -D<br></code></pre></td></tr></table></figure>

<p>然后在 <code>vite.config.js</code> 配置文件内添加如下内容：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd0314c0446e4654bfcc73e3dee44291~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bcf00b0cb0c4293a2daf92bef93f451~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>打完包之后，肉眼可见，<code>css</code> 提及从 <code>168.22kb</code> -&gt; <code>35.22kb</code>。这种方式也是前端性能优化的其中一种。</p>
<h2 id="配置-CSS-预处理器-Less"><a href="#配置-CSS-预处理器-Less" class="headerlink" title="配置 CSS 预处理器 Less"></a>配置 CSS 预处理器 Less</h2><p>项目中采用的 <code>Less</code> 作为 <code>CSS</code> 预处理器，它能设置变量以及一些嵌套逻辑，便于项目的样式编写。</p>
<p>安装 <code>less</code> 插件包，<code>npm i less -D</code>，因为上述配置我们使用的是 <code>less</code>，并且我们需要配置 <code>javascriptEnabled 为 true</code>，支持 <code>less</code> 内联 <code>JS</code>。</p>
<p>修改 <code>vite.config.js</code>，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">plugins</span>: [...]<br>  <span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">modules</span>: &#123;<br>      <span class="hljs-attr">localsConvention</span>: <span class="hljs-string">&#x27;dashesOnly&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">preprocessorOptions</span>: &#123;<br>      <span class="hljs-attr">less</span>: &#123;<br>        <span class="hljs-comment">// 支持内联 JavaScript</span><br>        <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>,<br>      &#125;<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p>并且添加了 <code>css modules</code> 配置，这样我们就不用担心在项目中，自定义的样式重名的风险，我们尝试在 <code>/container/Index</code> 目录下添加样式文件 <code>style.module.less</code>，并且在 <code>/container/Index/index.jsx</code> 中引入它，如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.index</span> &#123;<br>  <span class="hljs-selector-tag">span</span> &#123;<br>    <span class="hljs-attribute">color</span>: red;<br>  &#125;<br>&#125;<br>// Index/index<span class="hljs-selector-class">.jsx</span><br>import React <span class="hljs-selector-tag">from</span> &#x27;react&#x27;<br>import &#123; <span class="hljs-selector-tag">Button</span> &#125; <span class="hljs-selector-tag">from</span> &#x27;zarm&#x27;<br><br>import s <span class="hljs-selector-tag">from</span> &#x27;./style<span class="hljs-selector-class">.module</span><span class="hljs-selector-class">.less</span>&#x27;<br><br>export default function Index() &#123;<br>  return &lt;<span class="hljs-selector-tag">div</span> className=&#123;s<span class="hljs-selector-class">.index</span>&#125;&gt;<br>    &lt;<span class="hljs-selector-tag">span</span>&gt;样式&lt;/<span class="hljs-selector-tag">span</span>&gt;<br>    &lt;<span class="hljs-selector-tag">Button</span> theme=&#x27;primary&#x27;&gt;按钮&lt;/<span class="hljs-selector-tag">Button</span>&gt;<br>  &lt;/<span class="hljs-selector-tag">div</span>&gt;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8866be0be4824492b94297eea2eb4ca3~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时我只能再次恭喜你，<code>Less</code> 成功被引入。</p>
<h2 id="移动端项目适配-rem"><a href="#移动端项目适配-rem" class="headerlink" title="移动端项目适配 rem"></a>移动端项目适配 rem</h2><p>移动端项目，肯定是需要适配各种分辨率屏幕的，就比如你 10px 的宽度，在每个屏幕上的占比都是不一样的，我们这里不对分辨率做深入的探讨，我们目前的首要目的是完成项目移动端的分辨率适配。</p>
<p>首先我们需要安装 <code>lib-flexible</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i lib-flexible -S<br></code></pre></td></tr></table></figure>

<p>并在 <code>main.jsx</code> 中引入它：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;lib-flexible/flexible&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;./index.css&quot;</span>;<br><span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App&quot;</span>;<br><br>ReactDOM.render(<br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.StrictMode</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">React.StrictMode</span>&gt;</span></span>,<br>  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;root&quot;</span>)<br>);<br></code></pre></td></tr></table></figure>

<p>然后再安装一个 <code>postcss-pxtorem</code>，它的作用是在你编写完 <code>css</code> 后，将你的单位自动转化为 <code>rem</code> 单位。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i postcss-pxtorem<br></code></pre></td></tr></table></figure>

<p>在项目根目录新建 <code>postcss.config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// postcss.config.js</span><br><span class="hljs-comment">// 用 vite 创建项目，配置 postcss 需要使用 post.config.js，之前使用的 .postcssrc.js 已经被抛弃</span><br><span class="hljs-comment">// 具体配置可以去 postcss-pxtorem 仓库看看文档</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;postcss-pxtorem&quot;</span>)(&#123;<br>      <span class="hljs-attr">rootValue</span>: <span class="hljs-number">37.5</span>,<br>      <span class="hljs-attr">propList</span>: [<span class="hljs-string">&quot;*&quot;</span>],<br>      <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">&quot;.norem&quot;</span>], <span class="hljs-comment">// 过滤掉.norem-开头的class，不进行rem转换</span><br>    &#125;),<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>修改 <code>Index/style.module.less</code>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.index</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;<br>  <span class="hljs-attribute">background</span>: green;<br>  <span class="hljs-selector-tag">span</span> &#123;<br>    <span class="hljs-attribute">color</span>: red;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>重启项目 <code>npm run dev</code>，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28c6f12ba2c446ef9f374f878636c1f0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>可以看到，<code>200px</code> 已经被转化为 <code>5.3333rem</code>，我们设置的 <code>rootValue</code> 是 <code>37.5</code>，你可以换算一下 <code>5.33333 * 37.5 = 200</code>。</p>
<p>我们目前把浏览器调整成的是 <code>iphone 6</code>，<code>html</code> 的 <code>font-size</code> 为 <code>37.5px</code>，当我们手机变成其他尺寸的时候，这个 <code>font-size</code> 的值也会变化，这是 <code>flexible</code> 起到的作用，动态的变化 <code>html</code> 的 <code>font-size</code> 的值，从而让 <code>1rem</code> 所对应的 <code>px</code> 值一直都是动态适应变化的。</p>
<p>当我切换成 <code>iphone 6 plus</code> 时：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b787a8e1e96d4db58622c23d89592954~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>变成了 <code>41.4px</code>，而相应的，我们 <code>div</code> 还是 <code>5.33333rem</code>，所以此时 <code>div</code> 宽度就变大了，但是手机的屏幕宽度也变大了，这就不会影响视觉上的比例误差太大。</p>
<h2 id="二次封装-axios"><a href="#二次封装-axios" class="headerlink" title="二次封装 axios"></a>二次封装 axios</h2><p>说到这里，那就要涉及到项目的服务端 <code>API</code> 接口，我们在前面的章节里，已经完成了服务端的代码编写，但是此时我们的服务端项目是跑在 <code>http://127.0.0.1/7001</code> 端口上的。</p>
<p>此时你是可以在后续的请求中，使用 <code>http://127.0.0.1/7001</code> 作为项目的 <code>baseURL</code>。但是照顾到有些同学没有启动服务端项目，直奔前端项目来的。这里我已经将接口提前部署到了线上环境，供大家使用。接口地址是 <code>http://api.chennick.wang</code>。</p>
<p>所以在后续的封装过程中，我会提醒大家两种使用。</p>
<p>首先我们安装 <code>npm i axios -S</code>，在 <code>src</code> 目录下新建 <code>utils</code> 目录，并新建 <code>axios.js</code> 脚本：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/utils/axios.js</span><br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">const</span> MODE = <span class="hljs-keyword">import</span>.meta.env.MODE; <span class="hljs-comment">// 环境变量</span><br><br>axios.defaults.baseURL =<br>  MODE == <span class="hljs-string">&quot;development&quot;</span> ? <span class="hljs-string">&quot;/api&quot;</span> : <span class="hljs-string">&quot;http://api.chennick.wang&quot;</span>;<br>axios.defaults.withCredentials = <span class="hljs-literal">true</span>;<br>axios.defaults.headers[<span class="hljs-string">&quot;X-Requested-With&quot;</span>] = <span class="hljs-string">&quot;XMLHttpRequest&quot;</span>;<br>axios.defaults.headers[<span class="hljs-string">&quot;Authorization&quot;</span>] = <span class="hljs-string">`<span class="hljs-subst">$&#123;</span></span><br><span class="hljs-subst"><span class="hljs-string">  <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&quot;token&quot;</span>) || <span class="hljs-literal">null</span></span></span><br><span class="hljs-subst"><span class="hljs-string">&#125;</span>`</span>;<br>axios.defaults.headers.post[<span class="hljs-string">&quot;Content-Type&quot;</span>] = <span class="hljs-string">&quot;application/json&quot;</span>;<br><br>axios.interceptors.response.use(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> res.data !== <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>    Toast.show(<span class="hljs-string">&quot;服务端异常！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(res);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (res.data.code != <span class="hljs-number">200</span>) &#123;<br>    <span class="hljs-keyword">if</span> (res.data.msg) Toast.show(res.data.msg);<br>    <span class="hljs-keyword">if</span> (res.data.code == <span class="hljs-number">401</span>) &#123;<br>      <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">&quot;/login&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(res.data);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> res.data;<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> axios;<br></code></pre></td></tr></table></figure>

<p>我逐行为大家分析上述代码的情况情况。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> MODE = <span class="hljs-keyword">import</span>.meta.env.MODE;<br></code></pre></td></tr></table></figure>

<p><code>MODE</code> 是一个环境变量，通过 <code>Vite</code> 构建的项目中，环境变量在项目中，可以通过 <code>import.meta.env.MODE</code> 获取，环境变量的作用就是判断当前代码运行在开发环境还是生产环境。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.defaults.baseURL = <span class="hljs-string">&quot;development&quot;</span> ? <span class="hljs-string">&quot;/api&quot;</span> : <span class="hljs-string">&quot;http://api.chennick.wang&quot;</span>;<br></code></pre></td></tr></table></figure>

<p><code>baseURL</code> 是 <code>axios</code> 的配置项，它的作用就是设置请求的基础路径，后续我们会在项目实战中有所体现。配置基础路径的好处就是，当请求地址修改的时候，可以在此统一配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.defaults.headers[<span class="hljs-string">&quot;X-Requested-With&quot;</span>] = <span class="hljs-string">&quot;XMLHttpRequest&quot;</span>;<br>axios.defaults.headers[<span class="hljs-string">&quot;Authorization&quot;</span>] = <span class="hljs-string">`<span class="hljs-subst">$&#123;</span></span><br><span class="hljs-subst"><span class="hljs-string">  <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&quot;token&quot;</span>) || <span class="hljs-literal">null</span></span></span><br><span class="hljs-subst"><span class="hljs-string">&#125;</span>`</span>;<br>axios.defaults.headers.post[<span class="hljs-string">&quot;Content-Type&quot;</span>] = <span class="hljs-string">&quot;application/json&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>上述三个配置是用于请求头的设置，<code>Authorization</code> 是我们在服务端鉴权的时候用到的，我们在前端设置好 <code>token</code>，服务端通过获取请求头中的 <code>token</code> 去验证每一次请求是否合法。</p>
<p>最后一行是配置 <code>post</code> 请求是，使用的请求体，这里默认设置成 <code>application/json</code> 的形式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">axios.interceptors.response.use(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> res.data !== <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>    Toast.show(<span class="hljs-string">&quot;服务端异常！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(res);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (res.data.code != <span class="hljs-number">200</span>) &#123;<br>    <span class="hljs-keyword">if</span> (res.data.msg) Toast.show(res.data.msg);<br>    <span class="hljs-keyword">if</span> (res.data.code == <span class="hljs-number">401</span>) &#123;<br>      <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">&quot;/login&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(res.data);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> res.data;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><code>interceptors</code> 为拦截器，拦截器的作用是帮你拦截每一次请求，你可以在回调函数中做一些“手脚”，再将数据 <code>return</code> 回去。上述代码就是拦截了响应内容，统一判断请求内容，如果非 200，则提示错误信息，<code>401</code> 的话，就是没有登录的用户，默认跳到 <code>/login</code> 页面。如果是正常的响应，则 <code>retrun res.data</code>。</p>
<p>最后我们将这个 <code>axios</code> 抛出，供页面组件请求使用。</p>
<p>在 <code>utils</code> 下新建一个 <code>index.js</code>，内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./axios&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> get = axios.get;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> post = axios.post;<br></code></pre></td></tr></table></figure>

<p>这样获取的时候，能少写几行代码，能少写点就少写点。</p>
<h2 id="代理配置"><a href="#代理配置" class="headerlink" title="代理配置"></a>代理配置</h2><p><code>baseURL</code> 为什么在 <code>development</code> 环境下，用 <code>/api</code> 这样的请求地址。其实它就是为了代理请求而配置的。</p>
<p>这样配置完后，在请求接口的时候，请求地址大概长这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">/api/userInfo<br></code></pre></td></tr></table></figure>

<p>于是我们需要去配置代理，打开 <code>vite.config.js</code>，添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">server: &#123;<br>  <span class="hljs-attr">proxy</span>: &#123;<br>    <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>      <span class="hljs-comment">// 当遇到 /api 路径时，将其转换成 target 的值</span><br>      <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://api.chennick.wang/api/&#x27;</span>,<br>      <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">rewrite</span>: <span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span> path.replace(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-comment">// 将 /api 重写为空</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这样配置完之后，开发环境下，<code>/api/userInfo</code> -&gt; <code>http://api.chennick.wang/api/userInfo</code>。这样就解决了大家老大难的跨域问题。</p>
<p>但是其实服务端只要设置好白名单，就不会有这样那样的跨域问题。</p>
<h2 id="resolve-alias-别名设置"><a href="#resolve-alias-别名设置" class="headerlink" title="resolve.alias 别名设置"></a>resolve.alias 别名设置</h2><p>这里我们必须得设置好别名，否则在页面中，你会写出很长一串类似这样的代码 <code>../../../</code>。</p>
<p>打开 <code>vite.config.js</code>，添加配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defineConfig(&#123;<br>  ...<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@&#x27;</span>: path.resolve(__dirname, <span class="hljs-string">&#x27;src&#x27;</span>), <span class="hljs-comment">// src 路径</span><br>      <span class="hljs-string">&#x27;utils&#x27;</span>: path.resolve(__dirname, <span class="hljs-string">&#x27;src/utils&#x27;</span>) <span class="hljs-comment">// src 路径</span><br>    &#125;<br>  &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>此时我们便可以修改之前的代码如下：</p>
<p><strong>router/index.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Index <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/container/Index&quot;</span>;<br><span class="hljs-keyword">import</span> About <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/container/About&quot;</span>;<br></code></pre></td></tr></table></figure>

<p><strong>App.jsx</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> routes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/router&quot;</span>;<br></code></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>行文至此，我们的基础开发环境已经搭建完毕，涉及构建工具、前端框架、<code>UI</code> 组件库、<code>HTTP</code> 请求库、<code>CSS</code> 预加载器、跨域代理、移动端分辨率适配，这些知识都是一个合格的前端工程师应该具备的，所以请大家加油，将他们都通通拿下。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
