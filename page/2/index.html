<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;issummer.cn&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Muse&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}">
<meta property="og:type" content="website">
<meta property="og:title" content="Jude">
<meta property="og:url" content="http://issummer.cn/page/2/index.html">
<meta property="og:site_name" content="Jude">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://issummer.cn/page/2/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;}">
<meta name="hexo-config-calendar" content="">
<title>Jude</title><script data-pjax src="/js/load-config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Jude</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/02/08/121-proTable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/08/121-proTable/" class="post-title-link" itemprop="url">121、ProTable</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-08 20:00:00" itemprop="dateCreated datePublished" datetime="2023-02-08T20:00:00+08:00">2023-02-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:52:53" itemprop="dateModified" datetime="2023-08-15T10:52:53+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ProTable 是基于 Vue3.2 + Element-Plus 二次封装 el-table,首先我们在封装 ProTable 组件的时候，在不影响 el-table 原有的属性、事件、方法的前提下，然后在其基础上做二次封装。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/02/08/121-proTable/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/02/03/120-github/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/03/120-github/" class="post-title-link" itemprop="url">120、git提交代码终端出现“Enter passphrase for key ‘/Users/yq/.ssh/id_rsa”</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-03 20:00:00" itemprop="dateCreated datePublished" datetime="2023-02-03T20:00:00+08:00">2023-02-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-07 16:17:55" itemprop="dateModified" datetime="2023-08-07T16:17:55+08:00">2023-08-07</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><p>1、打开终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ssh">ssh-add -K /Users/yq/.ssh/id_rsa<br></code></pre></td></tr></table></figure>

<p>根据终端提示，输入电脑开机密码；</p>
<p>成功后会提示： Identity added: /Users/yq/.ssh/id_rsa (<a href="mailto:&#x31;&#51;&#51;&#52;&#x33;&#x35;&#50;&#56;&#x30;&#x38;&#64;&#x71;&#x71;&#x2e;&#99;&#x6f;&#x6d;">&#x31;&#51;&#51;&#52;&#x33;&#x35;&#50;&#56;&#x30;&#x38;&#64;&#x71;&#x71;&#x2e;&#99;&#x6f;&#x6d;</a>)</p>
<p>之后在提交代码的时候，不会需要 enter 以下提交代码</p>
<p>更改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ssh">ssh-add --apple-use-keychain /Users/yq/.ssh/id_rsa<br>ssh-add --apple-load-keychain /Users/yq/.ssh/id_rsa<br></code></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/31/119-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/31/119-react/" class="post-title-link" itemprop="url">119、稀土掘金小册-记账本（十） 个人中心 （完结）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-31 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-31T20:00:00+08:00">2023-01-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:53:56" itemprop="dateModified" datetime="2023-08-15T10:53:56+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>行文至此，万里长征已经快要走到头了。本章节带同学们来编写最后一个模块 —— 个人中心。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7faa8d9d5851499ba78625108b2ddea1~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>个人中心模块分几个功能点，首先是头部的用户信息展示，包括头像、用户昵称、个人签名。其次是一些账号相关的操作，如用户信息修改、密码重置等。最后是退出登录，将其放置于页面底部，并且设置二次确认弹窗，避免误触。</p>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>图片资源上传格式处理。</li>
<li>原生表单插件 <code>rc-form</code> 的使用。</li>
<li>底部导航栏定位。</li>
</ul>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="头部信息展示"><a href="#头部信息展示" class="headerlink" title="头部信息展示"></a>头部信息展示</h3><p>修改 <code>container/User/index.jsx</code> 代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> User = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.user&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.head&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.info&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>昵称：测试<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">30</span>, <span class="hljs-attr">height:</span> <span class="hljs-attr">30</span>, <span class="hljs-attr">verticalAlign:</span> &quot;<span class="hljs-attr">-10px</span>&quot; &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615973630132/geqian.png&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>个性签名<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.avatar&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">60</span>, <span class="hljs-attr">height:</span> <span class="hljs-attr">60</span>, <span class="hljs-attr">borderRadius:</span> <span class="hljs-attr">8</span> &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;</span>&quot;//<span class="hljs-attr">s.yezgea02.com</span>/<span class="hljs-attr">1624959897466</span>/<span class="hljs-attr">avatar.jpeg</span>&quot;&#125;</span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">        /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> User;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>这里给 <code>.head</code> 一个背景图片，介绍一下顶部的布局思路，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7140a83118464d419c020dd84616954f~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>在 <code>.head</code> 内通过 <code>flex</code> 实现左右布局，在 <code>.info</code> 内通过 <code>flex</code> 的 <code>flex-direction</code> 设置为 <code>column</code> 实现上下布局。</p>
<p><code>.head</code> 底部留出的位置，用于放置后续的操作。</p>
<p>完成布局之后，将数据填上，通过 <code>/api/user/get_userinfo</code> 接口，获取用户信息，添加代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; get &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> User = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> [user, setUser] = useState(&#123;&#125;);<br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getUserInfo();<br>  &#125;, []);<br><br>  <span class="hljs-comment">// 获取用户信息</span><br>  <span class="hljs-keyword">const</span> getUserInfo = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">&quot;/api/user/get_userinfo&quot;</span>);<br>    setUser(data);<br>    setAvatar(data.avatar);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.user&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.head&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.info&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>昵称：&#123;user.username || &quot;--&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">30</span>, <span class="hljs-attr">height:</span> <span class="hljs-attr">30</span>, <span class="hljs-attr">verticalAlign:</span> &quot;<span class="hljs-attr">-10px</span>&quot; &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615973630132/geqian.png&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>&#123;user.signature || &quot;暂无个签&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.avatar&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">60</span>, <span class="hljs-attr">height:</span> <span class="hljs-attr">60</span>, <span class="hljs-attr">borderRadius:</span> <span class="hljs-attr">8</span> &#125;&#125;</span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;user.avatar</span> || &quot;&quot;&#125;</span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">        /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> User;<br></code></pre></td></tr></table></figure>

<p><code>/api/user/get_userinfo</code> 接口返回字段分析：</p>
<ul>
<li>avatar：头像地址，这里要注意，我目前采用的线上接口，如果是本地开发的情况，需要修改你的 <code>host</code>。</li>
<li>signature：个性签名。</li>
<li>username：用户登录名称。</li>
</ul>
<p>浏览器展示如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38d7bc9820bb40af9b3c0a587ea44c2d~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="用户信息相关操作"><a href="#用户信息相关操作" class="headerlink" title="用户信息相关操作"></a>用户信息相关操作</h3><p>紧接着，我们需要布局用户相关操作的内容，在上述基础上添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js">...<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; Cell,  &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zarm&#x27;</span>;<br><br><span class="hljs-keyword">const</span> User = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> navigateTo = useNavigate();<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.user&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.content&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">hasArrow</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;用户信息修改&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> navigateTo(&#x27;/userinfo&#x27;)&#125;</span><br><span class="xml">        icon=&#123;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">20</span>, <span class="hljs-attr">verticalAlign:</span> &#x27;<span class="hljs-attr">-7px</span>&#x27; &#125;&#125; <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615974766264/gxqm.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span>&#125;</span><br><span class="xml">      /&gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">hasArrow</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;重制密码&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> navigateTo(&#x27;/account&#x27;)&#125;</span><br><span class="xml">        icon=&#123;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">20</span>, <span class="hljs-attr">verticalAlign:</span> &#x27;<span class="hljs-attr">-7px</span>&#x27; &#125;&#125; <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615974766264/zhaq.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span>&#125;</span><br><span class="xml">      /&gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">hasArrow</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;关于我们&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> navigateTo(&#x27;/about&#x27;)&#125;</span><br><span class="xml">        icon=&#123;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">20</span>, <span class="hljs-attr">verticalAlign:</span> &#x27;<span class="hljs-attr">-7px</span>&#x27; &#125;&#125; <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1615975178434/lianxi.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span>&#125;</span><br><span class="xml">      /&gt;</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>添加样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css">... <span class="hljs-selector-class">.content</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">120px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>);<br>  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">3px</span> <span class="hljs-number">2px</span> <span class="hljs-number">20px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>代码部分，直接采用 <code>Zarm</code> 组件库提供的 <code>Cell</code> 组件，它适用于列表布局，<a href="https://link.juejin.cn/?target=https://zarm.gitee.io/%23/components/cell">官方文档</a>提供了很多列表布局的例子，可以直接在内部拷贝代码进行二次加工。能不用自己写样式，尽量就不要写。用组件库的目的，就是减少工作量，提高布局的效率。</p>
<p>浏览器展示效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efc9a9ee5b794140b0da572a651b67f3~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>这里有三个列表跳转项，分别是 <code>userinfo</code>、<code>account</code>、<code>about</code>。我们逐一击破。</p>
<p>首先我们在 <code>container</code> 目录下新建一个 <code>UserInfo</code> 目录，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/508f67feaa5745689513b1c3a4037bbb~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>添加 <code>index.js</code> 和 <code>style.module.less</code>，并且在 <code>router/index.js</code> 内添加相对应的路由配置项。</p>
<p>于是我们尝试点击「修改用户信息」，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be3e4fe43b5f48afa0e627a53efcdada~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>成功之后，我们便可在 <code>UserInfo</code> 中编写编辑用户相关信息的操作，在编写正式代码之前，我们先对 <code>Zarm</code> 的上传组件进行分析，我们尝试编写如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; FilePicker, Button &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> UserInfo = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> handleSelect = <span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;file&quot;</span>, file);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.userinfo&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">FilePicker</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleSelect&#125;</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">&quot;image/*&quot;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;xs&quot;</span>&gt;</span></span><br><span class="xml">          点击上传</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">FilePicker</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> UserInfo;<br></code></pre></td></tr></table></figure>

<p>点击按钮，上传一张图片，我们查看回调函数 <code>handleSelect</code> 的执行结果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5668a3d8c3ac48fc9c793060570ddf8a~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>此时，我们需要的是上传资源的原始文件，在上述返回对象中，<code>file</code> 属性为 <code>File</code> 文件类型，它是浏览器返回的原生对象，我们需要通过下列代码，将其改造成一个 <code>form-data</code> 对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> handleSelect = <span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;file&quot;</span>, file);<br>  <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> FormData();<br>  formData.append(<span class="hljs-string">&quot;file&quot;</span>, file.file);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>再将 <code>formData</code> 通过 <code>axios</code> 上传到服务器，服务端通过 <code>ctx.request.files[0]</code> 获取到前端上传的 文件原始对象，并将其读取，存入服务器内部。这样就完成了一套前端上传资源，服务端存储并返回路径的一个过程。</p>
<p>接下来进行完整代码的编写，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Button, FilePicker, Input, Toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/Header&quot;</span>; <span class="hljs-comment">// 由于是内页，使用到公用头部</span><br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>; <span class="hljs-comment">// // 由于采用 form-data 传递参数，所以直接只用 axios 进行请求</span><br><span class="hljs-keyword">import</span> &#123; get, post &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; baseUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;config&quot;</span>; <span class="hljs-comment">// 由于直接使用 axios 进行请求，统一封装了请求 baseUrl</span><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> UserInfo = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> navigateTo = useNavigate(); <span class="hljs-comment">// 路由实例</span><br>  <span class="hljs-keyword">const</span> [user, setUser] = useState(&#123;&#125;); <span class="hljs-comment">// 用户</span><br>  <span class="hljs-keyword">const</span> [avatar, setAvatar] = useState(<span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// 头像</span><br>  <span class="hljs-keyword">const</span> [signature, setSignature] = useState(<span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// 个签</span><br>  <span class="hljs-keyword">const</span> token = <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&quot;token&quot;</span>); <span class="hljs-comment">// 登录令牌</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getUserInfo(); <span class="hljs-comment">// 初始化请求</span><br>  &#125;, []);<br><br>  <span class="hljs-comment">// 获取用户信息</span><br>  <span class="hljs-keyword">const</span> getUserInfo = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">&quot;/api/user/get_userinfo&quot;</span>);<br>    setUser(data);<br>    setAvatar(data.avatar);<br>    setSignature(data.signature);<br>  &#125;;<br><br>  <span class="hljs-comment">// 获取图片回调</span><br>  <span class="hljs-keyword">const</span> handleSelect = <span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;file.file&quot;</span>, file.file);<br>    <span class="hljs-keyword">if</span> (file &amp;&amp; file.file.size &gt; <span class="hljs-number">200</span> * <span class="hljs-number">1024</span>) &#123;<br>      Toast.show(<span class="hljs-string">&quot;上传头像不得超过 200 KB！！&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> FormData();<br>    <span class="hljs-comment">// 生成 form-data 数据类型</span><br>    formData.append(<span class="hljs-string">&quot;file&quot;</span>, file.file);<br>    <span class="hljs-comment">// 通过 axios 设置  &#x27;Content-Type&#x27;: &#x27;multipart/form-data&#x27;, 进行文件上传</span><br>    axios(&#123;<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;baseUrl&#125;</span>/upload`</span>,<br>      <span class="hljs-attr">data</span>: formData,<br>      <span class="hljs-attr">headers</span>: &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;multipart/form-data&quot;</span>,<br>        <span class="hljs-attr">Authorization</span>: token,<br>      &#125;,<br>    &#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 返回图片地址</span><br>      setAvatar(res.data);<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-comment">// 编辑用户信息方法</span><br>  <span class="hljs-keyword">const</span> save = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&quot;/api/user/edit_userinfo&quot;</span>, &#123;<br>      signature,<br>      avatar,<br>    &#125;);<br><br>    Toast.show(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>    <span class="hljs-comment">// 成功后回到个人中心页面</span><br>    navigateTo(-<span class="hljs-number">1</span>);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;用户信息&quot;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.userinfo&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>个人资料<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.item&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>头像<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.avatar&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.avatarUrl&#125;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;avatar&#125;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.desc&#125;</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>支持 jpg、png、jpeg 格式大小 200KB 以内的图片<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">FilePicker</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.filePicker&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleSelect&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">                <span class="hljs-attr">accept</span>=<span class="hljs-string">&quot;image/*&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              &gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.upload&#125;</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;xs&quot;</span>&gt;</span></span><br><span class="xml">                  点击上传</span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">FilePicker</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.item&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>个性签名<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.signature&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">clearable</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;signature&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入个性签名&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> setSignature(value)&#125;</span><br><span class="xml">            /&gt;</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;save&#125;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">marginTop:</span> <span class="hljs-attr">50</span> &#125;&#125; <span class="hljs-attr">block</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span>&gt;</span></span><br><span class="xml">          保存</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> UserInfo;<br></code></pre></td></tr></table></figure>

<p>详细的注释信息，已经在上述代码中表明，需要注意的是，本次请求直接使用了 <code>axios</code> 方法，所以我们需要将 <code>baseUrl</code> 单独封装到一个配置文件中，便于后续使用，在 <code>src</code> 目录下新建 <code>config/index.js</code>，添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> MODE = <span class="hljs-keyword">import</span>.meta.env.MODE; <span class="hljs-comment">// 环境变量</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> baseUrl =<br>  MODE == <span class="hljs-string">&quot;development&quot;</span> ? <span class="hljs-string">&quot;/api&quot;</span> : <span class="hljs-string">&quot;http://api.chennick.wang&quot;</span>;<br></code></pre></td></tr></table></figure>

<p><code>MODE</code> 作为 <code>vite</code> 运行时的环境变量，可以通过它来配置开发环境和生成环境的一些变量差异。</p>
<p>然后需要在 <code>vite.config.js</code> 中修改如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">resolve: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@&#x27;</span>: path.resolve(__dirname, <span class="hljs-string">&#x27;src&#x27;</span>), <span class="hljs-comment">// src 路径</span><br>      <span class="hljs-string">&#x27;utils&#x27;</span>: path.resolve(__dirname, <span class="hljs-string">&#x27;src/utils&#x27;</span>), <span class="hljs-comment">// src 路径</span><br>      <span class="hljs-string">&#x27;config&#x27;</span>: path.resolve(__dirname, <span class="hljs-string">&#x27;src/config&#x27;</span>) <span class="hljs-comment">// src 路径</span><br>    &#125;<br>  &#125;,<br></code></pre></td></tr></table></figure>

<p>配置好 <code>config</code> ，便可以直接在代码中通过：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; baseUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;config&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>上述形式来获取 <code>config</code> 中的变量信息。</p>
<p>重启项目，浏览器展示效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8155a0c93fbe47d1a5c061ffb57d91fd~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>通过请求，得到的路径是这样的，因为我们在服务端返回的地址就是一个相对路径，所以我们需要给路径加上 <code>host</code>，要注意如果你是本地启动的服务端代码，这里的 <code>host</code> 就是你的服务端代码启动的 <code>host</code>，如 <code>locahost:7001</code>，而我目前使用的是在线接口，所以我们在 <code>utils/index.js</code> 下新增一个图片地址转换的方法，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// utils/index.js</span><br><span class="hljs-keyword">import</span> &#123; baseUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;config&#x27;</span><br><span class="hljs-keyword">const</span> MODE = <span class="hljs-keyword">import</span>.meta.env.MODE <span class="hljs-comment">// 环境变量</span><br>...<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> imgUrlTrans = <span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (url &amp;&amp; url.startsWith(<span class="hljs-string">&#x27;http&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> url<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    url = <span class="hljs-string">`<span class="hljs-subst">$&#123;MODE == <span class="hljs-string">&#x27;development&#x27;</span> ? <span class="hljs-string">&#x27;http://api.chennick.wang&#x27;</span> : baseUrl&#125;</span><span class="hljs-subst">$&#123;url&#125;</span>`</span><br>    <span class="hljs-keyword">return</span> url<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后在 <code>UserInfo/index.jsx</code> 中引入 <code>imgUrlTrans</code> 并如下使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 获取用户信息</span><br><span class="hljs-keyword">const</span> getUserInfo = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">&#x27;/api/user/get_userinfo&#x27;</span>);<br>  setUser(data);<br>  setAvatar(imgUrlTrans(data.avatar))<br>  setSignature(data.signature)<br>&#125;;<br><br>...<br><br><span class="hljs-comment">// 返回图片地址</span><br>setAvatar(imgUrlTrans(res.data))<br></code></pre></td></tr></table></figure>

<p>再次打开浏览器，点击选择图片如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/806c25af2a8c4622a7286a1b68f0bcf9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>保存后，数据成功修改，我们如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3260506bed5945fa94fb872358850ad8~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h3><p>完成用户信息编辑之后，接下来实现重置密码部分，我们在 <code>container</code> 目录下新建 <code>Account</code> 目录，在内部分别新建 <code>index.jsx</code> 和 <code>style.module.less</code>。</p>
<p>首先我们需要安装 <code>rc-form</code> 作为本次页面的表单组件，因为 <code>Zarm</code> 没有提供表单组件，包括 <code>Antd Mobile</code> 这样的组件，也没有提供表单相关的组件，所以这里我们需要使用 <code>rc-form</code> 自己编写表单相关验证方法，它也是 <code>antd</code> 官方使用的表单组件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i rc-form -S<br></code></pre></td></tr></table></figure>

<p>我们为 <code>Account/index.jsx</code> 添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Account/index.jsx</span><br><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Cell, Input, Button, Toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; createForm &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;rc-form&quot;</span>;<br><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/Header&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; post &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Account = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// Account 通过 createForm 高阶组件包裹之后，可以在 props 中获取到 form 属性</span><br>  <span class="hljs-keyword">const</span> &#123; getFieldProps, getFieldError &#125; = props.form;<br><br>  <span class="hljs-comment">// 提交修改方法</span><br>  <span class="hljs-keyword">const</span> submit = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// validateFields 获取表单属性元素</span><br>    props.form.validateFields(<span class="hljs-keyword">async</span> (error, value) =&gt; &#123;<br>      <span class="hljs-comment">// error 表单验证全部通过，为 false，否则为 true</span><br>      <span class="hljs-keyword">if</span> (!error) &#123;<br>        <span class="hljs-built_in">console</span>.log(value);<br>        <span class="hljs-keyword">if</span> (value.newpass != value.newpass2) &#123;<br>          Toast.show(<span class="hljs-string">&quot;新密码输入不一致&quot;</span>);<br>          <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">await</span> post(<span class="hljs-string">&quot;/api/user/modify_pass&quot;</span>, &#123;<br>          <span class="hljs-attr">old_pass</span>: value.oldpass,<br>          <span class="hljs-attr">new_pass</span>: value.newpass,<br>          <span class="hljs-attr">new_pass2</span>: value.newpass2,<br>        &#125;);<br>        Toast.show(<span class="hljs-string">&quot;修改成功&quot;</span>);<br>      &#125;<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;重制密码&quot;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.account&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.form&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;原密码&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">clearable</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入原密码&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              &#123;<span class="hljs-attr">...getFieldProps</span>(&quot;<span class="hljs-attr">oldpass</span>&quot;, &#123; <span class="hljs-attr">rules:</span> [&#123; <span class="hljs-attr">required:</span> <span class="hljs-attr">true</span> &#125;] &#125;)&#125;</span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;新密码&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">clearable</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入新密码&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              &#123;<span class="hljs-attr">...getFieldProps</span>(&quot;<span class="hljs-attr">newpass</span>&quot;, &#123; <span class="hljs-attr">rules:</span> [&#123; <span class="hljs-attr">required:</span> <span class="hljs-attr">true</span> &#125;] &#125;)&#125;</span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Cell</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;确认密码&quot;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">clearable</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请再此输入新密码确认&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              &#123;<span class="hljs-attr">...getFieldProps</span>(&quot;<span class="hljs-attr">newpass2</span>&quot;, &#123; <span class="hljs-attr">rules:</span> [&#123; <span class="hljs-attr">required:</span> <span class="hljs-attr">true</span> &#125;] &#125;)&#125;</span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Cell</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.btn&#125;</span> <span class="hljs-attr">block</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;submit&#125;</span>&gt;</span></span><br><span class="xml">          提交</span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createForm()(Account);<br></code></pre></td></tr></table></figure>

<p>样式代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.account</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">12px</span>;<br>  <span class="hljs-selector-class">.form</span> &#123;<br>    :global &#123;<br>      .za-cell:after &#123;<br>        left: unset;<br>        <span class="hljs-attribute">border-top</span>: unset;<br>        <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e9e9e9</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-selector-class">.btn</span> &#123;<br>    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">50px</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里要注意，<code>Account</code> 在抛出去的时候，需要用 <code>createForm()</code> 高阶组件进行包裹，这样在 <code>Account</code> 的内部能接收到 <code>form</code> 属性，它的内部提供了 <code>getFieldProps</code> 方法，对 <code>Input</code> 组件进行表单设置，<code>Input</code> 的 <code>onChange</code> 方法会被代理，最终可以通过 <code>form.validateFields</code> 以回到函数的形式拿到 <code>Input</code> 内的值，并且可以加以验证。</p>
<p>别忘记在路由配置项中添加相应的路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// router/index.js</span><br>...<br><span class="hljs-keyword">import</span> Account <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/container/Account&#x27;</span><br><br>...<br>&#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/account&quot;</span>,<br>  <span class="hljs-attr">component</span>: Account<br>&#125;<br></code></pre></td></tr></table></figure>

<p>页面展示如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/219b6798b5bc4e6ca78b6db0165af6b8~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>这里为了方便查看效果，输入框就不以密码的形式隐藏输入了，点击「提交」按钮之后，接口调用成功，但是我为 <code>admin</code> 账户在服务端设置了不能修改密码的权限，这里方便大家测试页面方便，不能随意修改密码。</p>
<blockquote>
<p>测试账号：admin，密码：111111</p>
</blockquote>
<h3 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h3><p>退出登录操作，我的处理方式是将本地的 <code>token</code> 清除，并且回到登录页面，简单粗暴了一些，但也不失为一个解决方案。</p>
<p>在 <code>User/index.jsx</code> 下添加代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> User = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 退出登录</span><br>  <span class="hljs-keyword">const</span> logout = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-built_in">localStorage</span>.removeItem(<span class="hljs-string">&quot;token&quot;</span>);<br>    navigateTo(<span class="hljs-string">&quot;/login&quot;</span>);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.user&#125;</span>&gt;</span></span><br><span class="xml">      ...</span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.logout&#125;</span> <span class="hljs-attr">block</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;danger&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;logout&#125;</span>&gt;</span></span><br><span class="xml">        退出登录</span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>样式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.logout</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">70px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>通过绝对定位将按钮定位在底部，我们尝试点击它，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/502235db11294dad90861694845e5241~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>再次点击登录，发现没有自动前往首页，我们这里对登录页面进行修改，打开 <code>Login/index.jsx</code>，做如下修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&quot;/api/user/login&quot;</span>, &#123;<br>  username,<br>  password,<br>&#125;);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;data&quot;</span>, data);<br><span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&quot;token&quot;</span>, data.token);<br><span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">&quot;/&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>这里之所以用 <code>window.location.href</code> 的原因是，<code>utils/axios.js</code> 内部需要再次被执行，才能通过 <code>localStorage.getItem</code> 拿到最新的 <code>token</code>。如果只是用 <code>navigateTo</code> 跳转页面的话，页面是不会被刷新，那么 <code>axios.js</code> 的 <code>token</code> 就无法设置。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/28/118-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/28/118-react/" class="post-title-link" itemprop="url">118、稀土掘金小册-记账本（九） 账单可视化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-28 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-28T20:00:00+08:00">2023-01-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:54:46" itemprop="dateModified" datetime="2023-08-15T10:54:46+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>账单的操作部分在之前的章节已经结束了，本章节我们学习如何将账单列表，以可视化数据的新形势展示，本章节我们会通过 <code>Echart</code> 插件，对数据进行可视化展示。</p>
<p>页面布局和分析如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af9e832e388940eeade66dcf304a4eeb~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>Echart 引入和使用。</li>
<li>进度条组件 <code>Progress</code> 的使用。</li>
</ul>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="头部筛选和数据实现"><a href="#头部筛选和数据实现" class="headerlink" title="头部筛选和数据实现"></a>头部筛选和数据实现</h3><p>当你看到顶部的时间筛选项的时候，你会再一次体会到当初把时间筛选功能封装成公用组件的好处，于是我们打开 <code>Data/index.jsx</code>，添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useEffect, useRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; Icon, Progress &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><span class="hljs-keyword">import</span> cx <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;classnames&quot;</span>;<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dayjs&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; get, typeMap &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/CustomIcon&quot;</span>;<br><span class="hljs-keyword">import</span> PopupDate <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/PopupDate&quot;</span>;<br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Data = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.data&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.total&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>2021-06<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.date&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;date&quot;</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>共支出<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.expense&#125;</span>&gt;</span>¥1000<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.income&#125;</span>&gt;</span>共收入¥200<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Data;<br></code></pre></td></tr></table></figure>

<p>头部的一些引入是为后面的代码所用，在这里事先引入，避免后面重复出现。</p>
<p>上述代码为头部统计的页面布局，同样采用的 <code>flex</code> 布局，样式部分如下：</p>
<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>样式部分有一个小技巧需要注意，日期后面的小竖线，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c98a98ee5aee44af8f5361ce8f144eda~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>在业务中，类似这样的需求非常多，这里我们可以使用伪类 <code>::before</code> 或 <code>::after</code> 去实现，减少在页面中再添加一些多余的标签。上述代码实现的逻辑是在日期的 <code>span</code> 上加上 <code>::after</code>，如下所示：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">span</span><span class="hljs-selector-pseudo">:nth-of-type</span>(<span class="hljs-number">1</span>)<span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">9px</span>;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">8px</span>;<br>  <span class="hljs-attribute">right</span>: <span class="hljs-number">28px</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">1px</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>给一个空的 <code>content</code>，再给上 <code>1px</code> 的宽度，颜色和上下距离可以根据需求调整。</p>
<p>苦口婆心的我再次强调，<code>flex</code> 布局的重要性，一定要把它吃透，至少在布局的时候，你可以灵活的运用横竖布局。</p>
<p>点击如期按钮，弹出底部弹窗，这里使用到了之前写好的 <code>PopupDate</code> 组件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> Data = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> monthRef = useRef();<br>  <span class="hljs-keyword">const</span> [currentMonth, setCurrentMonth] = useState(dayjs().format(<span class="hljs-string">&quot;YYYY-MM&quot;</span>));<br><br>  <span class="hljs-comment">// 月份弹窗开关</span><br>  <span class="hljs-keyword">const</span> monthShow = <span class="hljs-function">() =&gt;</span> &#123;<br>    monthRef.current &amp;&amp; monthRef.current.show();<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> selectMonth = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    setCurrentMonth(item);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.data&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.total&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;monthShow&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;currentMonth&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.date&#125;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;date&quot;</span> /&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>共支出<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.expense&#125;</span>&gt;</span>¥1000<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.income&#125;</span>&gt;</span>共收入¥200<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">PopupDate</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;monthRef&#125;</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;month&quot;</span> <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;selectMonth&#125;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>给日期按钮添加 <code>monthShow</code> 点击事件，调出 <code>PopupDate</code> 弹窗。并且，通过 <code>selectMonth</code> 方法，设置好选择的月份，展示于页面之上。效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34f85185a5934aaba55e13a58d3bdfdd~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="账单单项排名制作"><a href="#账单单项排名制作" class="headerlink" title="账单单项排名制作"></a>账单单项排名制作</h3><p>我们将账单排名部分的结构搭建出来，通过请求数据接口，将数据展示在页面上，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> Data = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> [totalType, setTotalType] = useState(<span class="hljs-string">&#x27;expense&#x27;</span>); <span class="hljs-comment">// 收入或支出类型</span><br>  <span class="hljs-keyword">const</span> [totalExpense, setTotalExpense] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 总支出</span><br>  <span class="hljs-keyword">const</span> [totalIncome, setTotalIncome] = useState(<span class="hljs-number">0</span>); <span class="hljs-comment">// 总收入</span><br>  <span class="hljs-keyword">const</span> [expenseData, setExpenseData] = useState([]); <span class="hljs-comment">// 支出数据</span><br>  <span class="hljs-keyword">const</span> [incomeData, setIncomeData] = useState([]); <span class="hljs-comment">// 收入数据</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getData()<br>  &#125;, [currentMonth]);<br><br>  <span class="hljs-comment">// 获取数据详情</span><br>  <span class="hljs-keyword">const</span> getData = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">`/api/bill/data?date=<span class="hljs-subst">$&#123;currentMonth&#125;</span>`</span>);<br><br>    <span class="hljs-comment">// 总收支</span><br>    setTotalExpense(data.total_expense);<br>    setTotalIncome(data.total_income);<br><br>    <span class="hljs-comment">// 过滤支出和收入</span><br>    <span class="hljs-keyword">const</span> expense_data = data.total_data.filter(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.pay_type == <span class="hljs-number">1</span>).sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.number - a.number); <span class="hljs-comment">// 过滤出账单类型为支出的项</span><br>    <span class="hljs-keyword">const</span> income_data = data.total_data.filter(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.pay_type == <span class="hljs-number">2</span>).sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.number - a.number); <span class="hljs-comment">// 过滤出账单类型为收入的项</span><br>    setExpenseData(expense_data);<br>    setIncomeData(income_data);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.data&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.structure&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.head&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>收支构成<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.tab&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> changeTotalType(&#x27;expense&#x27;)&#125; className=&#123;cx(&#123; [s.expense]: true, [s.active]: totalType == &#x27;expense&#x27; &#125;)&#125;&gt;支出<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> changeTotalType(&#x27;income&#x27;)&#125; className=&#123;cx(&#123; [s.income]: true, [s.active]: totalType == &#x27;income&#x27; &#125;)&#125;&gt;收入<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.content&#125;</span>&gt;</span></span><br><span class="xml">        &#123;</span><br><span class="xml">          (totalType == &#x27;expense&#x27; ? expenseData : incomeData).map(item =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.type_id&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.item&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.left&#125;</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.type&#125;</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(&#123;</span> [<span class="hljs-attr">s.expense</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">totalType</span> == <span class="hljs-string">&#x27;expense&#x27;</span>, [<span class="hljs-attr">s.income</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">totalType</span> == <span class="hljs-string">&#x27;income&#x27;</span> &#125;)&#125;&gt;</span></span><br><span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span></span></span><br><span class="hljs-tag"><span class="xml">                    <span class="hljs-attr">type</span>=<span class="hljs-string">&#123;item.type_id</span> ? <span class="hljs-attr">typeMap</span>[<span class="hljs-attr">item.type_id</span>]<span class="hljs-attr">.icon</span> <span class="hljs-attr">:</span> <span class="hljs-attr">1</span>&#125;</span></span><br><span class="hljs-tag"><span class="xml">                  /&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.name&#125;</span>&gt;</span>&#123; item.type_name &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.progress&#125;</span>&gt;</span>¥&#123; Number(item.number).toFixed(2) || 0 &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.right&#125;</span>&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.percent&#125;</span>&gt;</span></span><br><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Progress</span></span></span><br><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">shape</span>=<span class="hljs-string">&quot;line&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">percent</span>=<span class="hljs-string">&#123;Number((item.number</span> / <span class="hljs-attr">Number</span>(<span class="hljs-attr">totalType</span> == <span class="hljs-string">&#x27;expense&#x27;</span> ? <span class="hljs-attr">totalExpense</span> <span class="hljs-attr">:</span> <span class="hljs-attr">totalIncome</span>)) * <span class="hljs-attr">100</span>)<span class="hljs-attr">.toFixed</span>(<span class="hljs-attr">2</span>)&#125;</span></span><br><span class="hljs-tag"><span class="xml">                  <span class="hljs-attr">theme</span>=<span class="hljs-string">&#x27;primary&#x27;</span></span></span><br><span class="hljs-tag"><span class="xml">                /&gt;</span></span><br><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)</span><br><span class="xml">        &#125;</span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>上述是账单排名部分的代码部分，通过 <code>getData</code> 方法获取账单数据，接口字段分析：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/139ab1e147bb4fd2a30d543b7e445b82~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>首先我们需要传递日期参数 <code>date</code>，才能正常获取该月份的数据。</p>
<ul>
<li>number: 账单金额。</li>
<li>pay_type：账单类型，1 为支出，2 为收入。</li>
<li>type_id：账单种类 id。</li>
<li>type_name：账单种类名称，如购物、交通、医疗等。</li>
</ul>
<p>并将数据进行二次处理，将「收入」和「支出」分成两个数组保存。</p>
<p>通过 <code>changeTotalType</code> 方法，切换展示「收入」或「支出」。</p>
<p>通过对 <code>Progress</code> 组件的样式二次修改，样式代码如下：</p>
<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>将组件展示效果改成如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d660fe020efb419394c6951253775124~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="饼图制作"><a href="#饼图制作" class="headerlink" title="饼图制作"></a>饼图制作</h3><p>接下来我们尝试引入 <code>Echart</code>，我们不通过 <code>npm</code> 引入它，我们尝试引入它的静态资源，找到根目录下的 <code>index.html</code>，添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!DOCTYPE html&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">sizes</span>=<span class="hljs-string">&quot;32x32&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/favicons/v2/favicon-32x32.png~tplv-t2oaga2asx-image.image&quot;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>掘掘手札<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//s.yezgea02.com/1609305532675/echarts.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/src/main.jsx&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>这种引入方式，不会将 <code>echart</code> 打包到最终的入口脚本里。有同学会说可以按需引入，但是就算是按需引入，脚本也会变得很大，本身 <code>echart</code> 这类可视化工具库就非常大，因为内部使用了大量绘制图形的代码。</p>
<p>完成上述操作之后，我们尝试在 <code>/Data/index.jsx</code> 添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> proportionChart = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 用于存放 echart 初始化返回的实例</span><br><br><span class="hljs-keyword">const</span> Data = <span class="hljs-function">() =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> [pieType, setPieType] = useState(<span class="hljs-string">&#x27;expense&#x27;</span>); <span class="hljs-comment">// 饼图的「收入」和「支出」控制</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getData();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">// 每次组件卸载的时候，需要释放图表实例。clear 只是将其清空不会释放。</span><br>      proportionChart.dispose();<br>    &#125;;<br>  &#125;, [currentMonth]);<br><br>  <span class="hljs-comment">// 绘制饼图方法</span><br>  <span class="hljs-keyword">const</span> setPieChart = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.echarts) &#123;<br>      <span class="hljs-comment">// 初始化饼图，返回实例。</span><br>      proportionChart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;proportion&#x27;</span>));<br>      proportionChart.setOption(&#123;<br>          <span class="hljs-attr">tooltip</span>: &#123;<br>            <span class="hljs-attr">trigger</span>: <span class="hljs-string">&#x27;item&#x27;</span>,<br>            <span class="hljs-attr">formatter</span>: <span class="hljs-string">&#x27;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&#x27;</span><br>          &#125;,<br>          <span class="hljs-comment">// 图例</span><br>          <span class="hljs-attr">legend</span>: &#123;<br>              <span class="hljs-attr">data</span>: data.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.type_name)<br>          &#125;,<br>          <span class="hljs-attr">series</span>: [<br>            &#123;<br>              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;支出&#x27;</span>,<br>              <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;pie&#x27;</span>,<br>              <span class="hljs-attr">radius</span>: <span class="hljs-string">&#x27;55%&#x27;</span>,<br>              <span class="hljs-attr">data</span>: data.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>                <span class="hljs-keyword">return</span> &#123;<br>                  <span class="hljs-attr">value</span>: item.number,<br>                  <span class="hljs-attr">name</span>: item.type_name<br>                &#125;<br>              &#125;),<br>              <span class="hljs-attr">emphasis</span>: &#123;<br>                <span class="hljs-attr">itemStyle</span>: &#123;<br>                  <span class="hljs-attr">shadowBlur</span>: <span class="hljs-number">10</span>,<br>                  <span class="hljs-attr">shadowOffsetX</span>: <span class="hljs-number">0</span>,<br>                  <span class="hljs-attr">shadowColor</span>: <span class="hljs-string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span><br>                &#125;<br>              &#125;<br>            &#125;<br>          ]<br>      &#125;)<br>    &#125;;<br>  &#125;;<br><br>  <span class="hljs-comment">// 获取数据详情</span><br>  <span class="hljs-keyword">const</span> getData = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// 绘制饼图</span><br>    setPieChart(pieType == <span class="hljs-string">&#x27;expense&#x27;</span> ? expense_data : income_data);<br>  &#125;;<br><br>  <span class="hljs-comment">// 切换饼图收支类型</span><br>  <span class="hljs-keyword">const</span> changePieType = <span class="hljs-function">(<span class="hljs-params">type</span>) =&gt;</span> &#123;<br>    setPieType(type);<br>    <span class="hljs-comment">// 重绘饼图</span><br>    setPieChart(type == <span class="hljs-string">&#x27;expense&#x27;</span> ? expenseData : incomeData);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.data&#125;</span>&gt;</span></span><br><span class="xml">    ...</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.structure&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.proportion&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.head&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.title&#125;</span>&gt;</span>收支构成<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.tab&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> changePieType(&#x27;expense&#x27;)&#125; className=&#123;cx(&#123; [s.expense]: true, [s.active]: pieType == &#x27;expense&#x27;  &#125;)&#125;&gt;支出<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> changePieType(&#x27;income&#x27;)&#125; className=&#123;cx(&#123; [s.income]: true, [s.active]: pieType == &#x27;income&#x27;  &#125;)&#125;&gt;收入<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        &#123;/* 这是用于放置饼图的 DOM 节点 */&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;proportion&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>切换饼图「收入」和「支出」这里，我使用了一个小技巧，每次调用 <code>setPieChart</code> 的时候，会将数据重新传入，此时的数据是经过 <code>changePieType</code> 接收的参数进行筛选的，如果形参 <code>type</code> 的值为 <code>expense</code>，那么给 <code>setPieChart</code> 传的参数为 <code>expenseData</code>，反之则为 <code>incomeData</code>。</p>
<p>注意，在页面销毁前，需要将实例清除。在 <code>useEffect</code> 内 <code>return</code> 一个函数，该函数就是在组件销毁时执行，在函数内部执行 <code>proportionChart.dispose();</code> 对实例进行销毁操作。</p>
<p>最后，我们将头部的数据补上，如下所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;&#123;s.expense&#125;&quot;</span>&gt;</span>¥&#123; totalExpense &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;&#123;s.income&#125;&quot;</span>&gt;</span>共收入¥&#123; totalIncome &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>浏览器展示如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1509f4c80c0429ebcd09d5c91144631~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>可视化的形式还有很多，相关的可视化库有 three.js、d3.js、highchart.js 等等，这些内容都值得你去深入，但是在此之前，希望同学们能明确自己希望深入那一方面的知识，进行深度学习。比如张鑫旭大神，对 <code>CSS</code> 的研究，入骨三分，我相信业务无人出其右。所以找准方向，往前冲。</p>
<p><img src="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/img/jj_emoji_67.9ceed33.png" alt="[嘿哈]"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://issummer.cn/2023/01/21/117-react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jude">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/21/117-react/" class="post-title-link" itemprop="url">117、稀土掘金小册-记账本（八） 账单详情</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-21 20:00:00" itemprop="dateCreated datePublished" datetime="2023-01-21T20:00:00+08:00">2023-01-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-08-15 10:55:19" itemprop="dateModified" datetime="2023-08-15T10:55:19+08:00">2023-08-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>账单模块还剩最后一个小节，账单详情。账单详情页要做的事情有两个，一个是编辑当前账单操作，另一个是删除当前账单操作，我们先来观察完成后页面结构，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd8a2c4723fb4bbdbde0695d55e6bd92~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>这里是第一次涉及内页，所以我们需要制作一个公用的头部 <code>Header</code>，支持传参接收 <code>title</code> 信息。我们在上一章节提取的「添加账单弹窗组件」，在这里派上了用场，新增和编辑是一家，唯一的差别就是编辑的时候，需要传入当前账单的 <code>id</code> 给「添加账单组件」，组件内通过账单详情接口，获取账单详情，并将获取的参数用于各个字段初始化值，这就实现了组件的复用。</p>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ul>
<li>封装公用头部组件</li>
<li>复用添加账单弹窗组件</li>
</ul>
<h2 id="正文开始"><a href="#正文开始" class="headerlink" title="正文开始"></a>正文开始</h2><h3 id="公用头部"><a href="#公用头部" class="headerlink" title="公用头部"></a>公用头部</h3><p>在 <code>components</code> 目录下新建 <code>Header</code> 目录，老规矩，添加两个文件 <code>index.jsx</code> 和 <code>style.module.less</code>。</p>
<p>为 <code>Header/index.jsx</code> 添加代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;prop-types&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; NavBar, Icon &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zarm&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Header = <span class="hljs-function">(<span class="hljs-params">&#123; title = <span class="hljs-string">&quot;&quot;</span> &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> navigateTo = useNavigate();<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.headerWarp&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.block&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">NavBar</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.header&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">          <span class="hljs-attr">left</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="xml">            &lt;<span class="hljs-attr">Icon</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;arrow-left&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;primary&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> navigateTo(-1)&#125;</span><br><span class="xml">            /&gt;</span><br><span class="xml">          &#125;</span><br><span class="xml">          title=&#123;title&#125;</span><br><span class="xml">        /&gt;</span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br>Header.propTypes = &#123;<br>  <span class="hljs-attr">title</span>: PropTypes.string, <span class="hljs-comment">// 标题</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Header;<br></code></pre></td></tr></table></figure>

<p>我们采用 <code>Zarm</code> 组件库为我们提供的 <code>NavBar</code> 组件，实现头部的组件布局。为左边的返回箭头添加一个事件，<code>navigateTo(-1)</code> 的作用是路由返回事件，它不会触发浏览器的刷新，而是改变浏览器的地址栏，让组件匹配地址栏对应的地址组件。</p>
<p>还有一点要提醒大家，写公用组件一定要写 <code>PropTypes</code>，这是让其他使用该组件的同事知道，你这个组件接受的参数有哪些，以及每个参数的作用是什么，都要注释清楚，这才是一个好的公用组件。我见过很多同事写公用组件都不写 <code>PropTypes</code>，这让使用者非常头大。</p>
<p><strong>CSS 样式代码</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.header-warp</span> &#123;<br>  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e9e9e9</span>;<br>  <span class="hljs-selector-class">.block</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">46px</span>;<br>    :global &#123;<br>      .za-nav-bar__title &#123;<br>        font-size: <span class="hljs-number">14px</span>;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.9</span>);<br>      &#125;<br>      <span class="hljs-selector-class">.za-icon--arrow-left</span> &#123;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-selector-class">.header</span> &#123;<br>    <span class="hljs-attribute">position</span>: fixed;<br>    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>    <span class="hljs-selector-class">.more</span> &#123;<br>      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>完成上述代码之后，我们需要在 <code>container/Detail/index.jsx</code> 下引入这个公用头部，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/Header&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Detail = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.detail&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;账单详情&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Detail;<br></code></pre></td></tr></table></figure>

<p>效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4711827eba5141a2822bbde2237032d9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h3 id="账单明细"><a href="#账单明细" class="headerlink" title="账单明细"></a>账单明细</h3><p>接下来，我们通过列表页传入的浏览器查询字符串，通俗的将就是浏览器地址栏上的参数，来获取该笔账单的详情，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// container/Detail/index.jsx</span><br><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useLocation &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;query-string&quot;</span>;<br><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/Header&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; get &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Detail = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> location = useLocation(); <span class="hljs-comment">// 获取 locaton 实例，我们可以通过打印查看内部都有些什么内容。</span><br>  <span class="hljs-keyword">const</span> &#123; id &#125; = qs.parse(location.search);<br><br>  <span class="hljs-keyword">const</span> [detail, setDetail] = useState(&#123;&#125;);<br><br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;location&quot;</span>, location);<br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getDetail();<br>  &#125;, []);<br><br>  <span class="hljs-keyword">const</span> getDetail = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">`/api/bill/detail?id=<span class="hljs-subst">$&#123;id&#125;</span>`</span>);<br>    setDetail(data);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.detail&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;账单详情&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Detail;<br></code></pre></td></tr></table></figure>

<p>我们先来看看，浏览器控制台打印出的 <code>location</code> 如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ec916d9afd2477680bd98f0ac24a052~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>可以看到，我们想要的参数在 <code>search</code> 属性中，我想把 <code>?id=917</code> 转换成 <code>json</code> 键值对的形式，如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-number">917</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>所以我通过 <code>npm install query-string</code> 引入了查询字符串解析的一个插件，通过如下方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">qs.parse(location.search);<br></code></pre></td></tr></table></figure>

<p>可以将浏览器查询参数变成一个对象形式，所以我们在代码中可以通过 <code>const</code> 的解构，将 <code>id</code> 取出。最后通过 <code>get</code> 方法请求详情接口：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa5910c717994f729e744328c2cf2517~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>接下来，我们给账单明细部分布局，并且将数据接入，代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useLocation &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router-dom&quot;</span>;<br><span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;query-string&quot;</span>;<br><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dayjs&quot;</span>;<br><span class="hljs-keyword">import</span> cx <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;classnames&quot;</span>;<br><span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/Header&quot;</span>;<br><span class="hljs-keyword">import</span> CustomIcon <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/CustomIcon&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; get, typeMap &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils&quot;</span>;<br><br><span class="hljs-keyword">import</span> s <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./style.module.less&quot;</span>;<br><br><span class="hljs-keyword">const</span> Detail = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> location = useLocation(); <span class="hljs-comment">// 路由 location 实例</span><br>  <span class="hljs-keyword">const</span> &#123; id &#125; = qs.parse(location.search); <span class="hljs-comment">// 查询字符串反序列化</span><br><br>  <span class="hljs-keyword">const</span> [detail, setDetail] = useState(&#123;&#125;); <span class="hljs-comment">// 订单详情数据</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    getDetail();<br>  &#125;, []);<br><br>  <span class="hljs-keyword">const</span> getDetail = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">`/api/bill/detail?id=<span class="hljs-subst">$&#123;id&#125;</span>`</span>);<br>    setDetail(data);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.detail&#125;</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;账单详情&quot;</span> /&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.card&#125;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.type&#125;</span>&gt;</span></span><br><span class="xml">          &#123;/* 通过 pay_type 属性，判断是收入或指出，给出不同的颜色*/&#125;</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></span><br><span class="hljs-tag"><span class="xml">            <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(&#123;</span></span></span><br><span class="hljs-tag"><span class="xml">              [<span class="hljs-attr">s.expense</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">detail.pay_type</span> == <span class="hljs-string">1,</span></span></span><br><span class="hljs-tag"><span class="xml">              [<span class="hljs-attr">s.income</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">detail.pay_type</span> == <span class="hljs-string">2,</span></span></span><br><span class="hljs-tag"><span class="xml">            &#125;)&#125;</span></span><br><span class="hljs-tag"><span class="xml">          &gt;</span></span><br><span class="xml">            &#123;/* typeMap 是我们事先约定好的 icon 列表 */&#125;</span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.iconfont&#125;</span></span></span><br><span class="hljs-tag"><span class="xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&#123;detail.type_id</span> ? <span class="hljs-attr">typeMap</span>[<span class="hljs-attr">detail.type_id</span>]<span class="hljs-attr">.icon</span> <span class="hljs-attr">:</span> <span class="hljs-attr">1</span>&#125;</span></span><br><span class="hljs-tag"><span class="xml">            /&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;detail.type_name || &quot;&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        &#123;detail.pay_type == 1 ? (</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(s.amount,</span> <span class="hljs-attr">s.expense</span>)&#125;&gt;</span>-&#123;detail.amount&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        ) : (</span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;cx(s.amount,</span> <span class="hljs-attr">s.incom</span>)&#125;&gt;</span>+&#123;detail.amount&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        )&#125;</span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.info&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.time&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>记录时间<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;dayjs(Number(detail.date)).format(&quot;YYYY-MM-DD HH:mm&quot;)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.remark&#125;</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>备注<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;detail.remark || &quot;-&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;s.operation&#125;</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;shanchu&quot;</span> /&gt;</span></span><br><span class="xml">            删除</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;tianjia&quot;</span> /&gt;</span></span><br><span class="xml">            编辑</span><br><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Detail;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>文末已为同学们提供下本章节 demo 代码，样式部分不再详细说明。</p>
</blockquote>
<p>布局部分我都已经在代码中给了注释，还有不明白的同学可以在群里提问，再次强调一点，<code>flex</code> 布局请务必要掌握熟练，在日后的开发过程中，无论是小册还是公司的项目，都会大量的运用到它。甚至 <code>Flutter</code> 的布局也借鉴了 <code>flex</code> 的原理。</p>
<p>浏览器展示效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ccc8d4d2fb343878c22bb37f3949673~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>我们还需为底部的两个按钮添加事件。首先，为删除按钮添加删除事件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; useLocation, useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; get, post, typeMap &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; Modal, Toast &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zarm&#x27;</span>;<br>...<br><br><span class="hljs-keyword">const</span> navigateTo = useNavigate();<br><br><span class="hljs-comment">// 删除方法</span><br><span class="hljs-keyword">const</span> deleteDetail = <span class="hljs-function">() =&gt;</span> &#123;<br>  Modal.confirm(&#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;删除&#x27;</span>,<br>    <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;确认删除账单？&#x27;</span>,<br>    <span class="hljs-attr">onOk</span>: <span class="hljs-keyword">async</span> () =&gt; &#123;<br>      <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&#x27;/api/bill/delete&#x27;</span>, &#123; id &#125;)<br>      Toast.show(<span class="hljs-string">&#x27;删除成功&#x27;</span>)<br>      navigateTo(-<span class="hljs-number">1</span>)<br>    &#125;,<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里我们利用 <code>Zarm</code> 组件提供的 <code>Modal</code> 组件，该组件提供了调用方法的形式唤起弹窗，我们利用这个属性 为「删除」加一个二次确认的形式，避免误触按钮。</p>
<p>效果如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7f1edbbe9d147e39ffd28d9b0a0ab1c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>最麻烦的编辑事件处理，我们先来明确一下思路。在点击「编辑」按钮之后，我们会唤起之前写好的「添加账单天窗」，然后将账单 <code>detail</code> 参数通过 <code>props</code> 传递给弹窗组件，组件在接收到 <code>detail</code> 时，将信息初始化给弹窗给的相应参数。</p>
<p>我们来看代码的实现，首先在 <code>Detail/index.jsx</code> 内添加代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> React, &#123; useEffect, useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> PopupAddBill <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/PopupAddBill&#x27;</span>;<br>...<br><br><span class="hljs-keyword">const</span> editRef = useRef();<br>...<br>&lt;div className=&#123;s.operation&#125;&gt;<br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;deleteDetail&#125;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;shanchu&#x27;</span> /&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> editRef.current &amp;&amp; editRef.current.show()&#125;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">CustomIcon</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;tianjia&#x27;</span> /&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br>&lt;/div&gt;<br>...<br>&lt;PopupAddBill ref=&#123;editRef&#125; detail=&#123;detail&#125; onReload=&#123;getDetail&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p>尝试点击编辑按钮：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e946a44ae224128ae356abc36d990eb~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<p>紧接着，我们修改 <code>PopupAddBill</code> 组件，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> PopupAddBill = forwardRef(<span class="hljs-function">(<span class="hljs-params">&#123; detail = &#123;&#125;, onReload &#125;, ref</span>) =&gt;</span> &#123;<br>  ...<br>  <span class="hljs-keyword">const</span> id = detail &amp;&amp; detail.id <span class="hljs-comment">// 外部传进来的账单详情 id</span><br><br>  useEffect(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (detail.id) &#123;<br>      setPayType(detail.pay_type == <span class="hljs-number">1</span> ? <span class="hljs-string">&#x27;expense&#x27;</span> : <span class="hljs-string">&#x27;income&#x27;</span>)<br>      setCurrentType(&#123;<br>        <span class="hljs-attr">id</span>: detail.type_id,<br>        <span class="hljs-attr">name</span>: detail.type_name<br>      &#125;)<br>      setRemark(detail.remark)<br>      setAmount(detail.amount)<br>      setDate(dayjs(<span class="hljs-built_in">Number</span>(detail.date)).$d)<br>    &#125;<br>  &#125;, [detail])<br><br>  ...<br><br>  useEffect(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">data</span>: &#123; list &#125; &#125; = <span class="hljs-keyword">await</span> get(<span class="hljs-string">&#x27;/api/type/list&#x27;</span>);<br>    <span class="hljs-keyword">const</span> _expense = list.filter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.type == <span class="hljs-number">1</span>); <span class="hljs-comment">// 支出类型</span><br>    <span class="hljs-keyword">const</span> _income = list.filter(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.type == <span class="hljs-number">2</span>); <span class="hljs-comment">// 收入类型</span><br>    setExpense(_expense);<br>    setIncome(_income);<br>      <span class="hljs-comment">// 没有 id 的情况下，说明是新建账单。</span><br>    <span class="hljs-keyword">if</span> (!id) &#123;<br>      setCurrentType(_expense[<span class="hljs-number">0</span>]);<br>    &#125;;<br>  &#125;, []);<br><br>  ...<br><br>  <span class="hljs-comment">// 添加账单</span><br>  <span class="hljs-keyword">const</span> addBill = <span class="hljs-keyword">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (!amount) &#123;<br>      Toast.show(<span class="hljs-string">&#x27;请输入具体金额&#x27;</span>)<br>      <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">const</span> params = &#123;<br>      <span class="hljs-attr">amount</span>: <span class="hljs-built_in">Number</span>(amount).toFixed(<span class="hljs-number">2</span>),<br>      <span class="hljs-attr">type_id</span>: currentType.id,<br>      <span class="hljs-attr">type_name</span>: currentType.name,<br>      <span class="hljs-attr">date</span>: dayjs(date).unix() * <span class="hljs-number">1000</span>,<br>      <span class="hljs-attr">pay_type</span>: payType == <span class="hljs-string">&#x27;expense&#x27;</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">remark</span>: remark || <span class="hljs-string">&#x27;&#x27;</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (id) &#123;<br>      params.id = id;<br>      <span class="hljs-comment">// 如果有 id 需要调用详情更新接口</span><br>      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&#x27;/api/bill/update&#x27;</span>, params);<br>      Toast.show(<span class="hljs-string">&#x27;修改成功&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> post(<span class="hljs-string">&#x27;/api/bill/add&#x27;</span>, params);<br>      setAmount(<span class="hljs-string">&#x27;&#x27;</span>);<br>      setPayType(<span class="hljs-string">&#x27;expense&#x27;</span>);<br>      setCurrentType(expense[<span class="hljs-number">0</span>]);<br>      setDate(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());<br>      setRemark(<span class="hljs-string">&#x27;&#x27;</span>);<br>      Toast.show(<span class="hljs-string">&#x27;添加成功&#x27;</span>);<br>    &#125;<br>    setShow(<span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">if</span> (onReload) onReload();<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>首先，通过 <code>setXXX</code> 将 <code>detail</code> 的数据依次设置初始值；其次，账单种类需要判断是否是编辑或是新建；最后，修改添加账单按钮，如果是「编辑」操作，给 <code>params</code> 参数添加一个 <code>id</code>，并且调用的接口变成 <code>/api/bill/update</code>。</p>
<p>完成上述操作之后，我们查看浏览器操作情况如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c97d70e0092747cb8c78da25cf17c576~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本小节我们学习了如何封装内页的头部组件，以及如何将之前的「新增」复用给「编辑」操作，可以以这个为一个思考点，用发散的思维去复制这样的模式，是否其他的新增和编辑操作，也可以这么实现。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
